<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../displayToc.js"></script>
<script language="JavaScript" src="../tocParas.js"></script>
<script language="JavaScript" src="../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../scineplex.css">
<title>DBI - Database independent interface for Perl</title>
<link rel="stylesheet" href="../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',1);</script>
<h1><a>DBI - Database independent interface for Perl</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<ul>

		<li><a href="#getting_help">GETTING HELP</a></li>
		<li><a href="#notes">NOTES</a></li>
	</ul>

	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#architecture_of_a_dbi_application">Architecture of a DBI Application</a></li>
		<li><a href="#notation_and_conventions">Notation and Conventions</a></li>
		<li><a href="#outline_usage">Outline Usage</a></li>
		<li><a href="#general_interface_rules___caveats">General Interface Rules &amp; Caveats</a></li>
		<li><a href="#naming_conventions_and_name_space">Naming Conventions and Name Space</a></li>
		<li><a href="#sql___a_query_language">SQL - A Query Language</a></li>
		<li><a href="#placeholders_and_bind_values">Placeholders and Bind Values</a></li>
	</ul>

	<li><a href="#the_dbi_package_and_class">THE DBI PACKAGE AND CLASS</a></li>
	<ul>

		<li><a href="#dbi_constants">DBI Constants</a></li>
		<li><a href="#dbi_class_methods">DBI Class Methods</a></li>
		<ul>

			<li><a href="#parse_dsn"><code>parse_dsn</code></a></li>
			<li><a href="#connect"><a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a></a></li>
			<li><a href="#connect_cached"><code>connect_cached</code></a></li>
			<li><a href="#available_drivers"><code>available_drivers</code></a></li>
			<li><a href="#installed_drivers"><code>installed_drivers</code></a></li>
			<li><a href="#installed_versions"><code>installed_versions</code></a></li>
			<li><a href="#data_sources"><code>data_sources</code></a></li>
			<li><a href="#trace"><code>trace</code></a></li>
		</ul>

		<li><a href="#dbi_utility_functions">DBI Utility Functions</a></li>
		<ul>

			<li><a href="#data_string_desc"><code>data_string_desc</code></a></li>
			<li><a href="#data_string_diff"><code>data_string_diff</code></a></li>
			<li><a href="#data_diff"><code>data_diff</code></a></li>
			<li><a href="#neat"><code>neat</code></a></li>
			<li><a href="#neat_list"><code>neat_list</code></a></li>
			<li><a href="#looks_like_number"><code>looks_like_number</code></a></li>
			<li><a href="#hash"><code>hash</code></a></li>
		</ul>

		<li><a href="#dbi_dynamic_attributes">DBI Dynamic Attributes</a></li>
		<ul>

			<li><a href="#_dbi__err"><code>$DBI::err</code></a></li>
			<li><a href="#_dbi__errstr"><code>$DBI::errstr</code></a></li>
			<li><a href="#_dbi__state"><code>$DBI::state</code></a></li>
			<li><a href="#_dbi__rows"><code>$DBI::rows</code></a></li>
			<li><a href="#_dbi__lasth"><code>$DBI::lasth</code></a></li>
		</ul>

	</ul>

	<li><a href="#methods_common_to_all_handles">METHODS COMMON TO ALL HANDLES</a></li>
	<ul>

		<ul>

			<li><a href="#err"><code>err</code></a></li>
			<li><a href="#errstr"><code>errstr</code></a></li>
			<li><a href="#state"><a href="../lib/pods/perlfunc.html#state"><code>state</code></a></a></li>
			<li><a href="#set_err"><code>set_err</code></a></li>
			<li><a href="#trace"><code>trace</code></a></li>
			<li><a href="#trace_msg"><code>trace_msg</code></a></li>
			<li><a href="#func"><code>func</code></a></li>
			<li><a href="#can"><code>can</code></a></li>
			<li><a href="#parse_trace_flags"><code>parse_trace_flags</code></a></li>
			<li><a href="#parse_trace_flag"><code>parse_trace_flag</code></a></li>
			<li><a href="#private_attribute_info"><code>private_attribute_info</code></a></li>
			<li><a href="#swap_inner_handle"><code>swap_inner_handle</code></a></li>
		</ul>

	</ul>

	<li><a href="#attributes_common_to_all_handles">ATTRIBUTES COMMON TO ALL HANDLES</a></li>
	<ul>

		<ul>

			<li><a href="#warn__boolean__inherited_"><code>Warn</code> (boolean, inherited)</a></li>
			<li><a href="#active__boolean__read_only_"><code>Active</code> (boolean, read-only)</a></li>
			<li><a href="#executed__boolean_"><code>Executed</code> (boolean)</a></li>
			<li><a href="#kids__integer__read_only_"><code>Kids</code> (integer, read-only)</a></li>
			<li><a href="#activekids__integer__read_only_"><code>ActiveKids</code> (integer, read-only)</a></li>
			<li><a href="#cachedkids__hash_ref_"><code>CachedKids</code> (hash ref)</a></li>
			<li><a href="#type__scalar__read_only_"><code>Type</code> (scalar, read-only)</a></li>
			<li><a href="#childhandles__array_ref_"><code>ChildHandles</code> (array ref)</a></li>
			<li><a href="#compatmode__boolean__inherited_"><code>CompatMode</code> (boolean, inherited)</a></li>
			<li><a href="#inactivedestroy__boolean_"><code>InactiveDestroy</code> (boolean)</a></li>
			<li><a href="#printwarn__boolean__inherited_"><code>PrintWarn</code> (boolean, inherited)</a></li>
			<li><a href="#printerror__boolean__inherited_"><code>PrintError</code> (boolean, inherited)</a></li>
			<li><a href="#raiseerror__boolean__inherited_"><code>RaiseError</code> (boolean, inherited)</a></li>
			<li><a href="#handleerror__code_ref__inherited_"><code>HandleError</code> (code ref, inherited)</a></li>
			<li><a href="#handleseterr__code_ref__inherited_"><code>HandleSetErr</code> (code ref, inherited)</a></li>
			<li><a href="#errcount__unsigned_integer_"><code>ErrCount</code> (unsigned integer)</a></li>
			<li><a href="#showerrorstatement__boolean__inherited_"><code>ShowErrorStatement</code> (boolean, inherited)</a></li>
			<li><a href="#tracelevel__integer__inherited_"><code>TraceLevel</code> (integer, inherited)</a></li>
			<li><a href="#fetchhashkeyname__string__inherited_"><code>FetchHashKeyName</code> (string, inherited)</a></li>
			<li><a href="#chopblanks__boolean__inherited_"><code>ChopBlanks</code> (boolean, inherited)</a></li>
			<li><a href="#longreadlen__unsigned_integer__inherited_"><code>LongReadLen</code> (unsigned integer, inherited)</a></li>
			<li><a href="#longtruncok__boolean__inherited_"><code>LongTruncOk</code> (boolean, inherited)</a></li>
			<li><a href="#taintin__boolean__inherited_"><code>TaintIn</code> (boolean, inherited)</a></li>
			<li><a href="#taintout__boolean__inherited_"><code>TaintOut</code> (boolean, inherited)</a></li>
			<li><a href="#taint__boolean__inherited_"><code>Taint</code> (boolean, inherited)</a></li>
			<li><a href="#profile__inherited_"><code>Profile</code> (inherited)</a></li>
			<li><a href="#readonly__boolean__inherited_"><code>ReadOnly</code> (boolean, inherited)</a></li>
			<li><a href="#private_your_module_name__"><code>private_your_module_name_*</code></a></li>
		</ul>

	</ul>

	<li><a href="#dbi_database_handle_objects">DBI DATABASE HANDLE OBJECTS</a></li>
	<ul>

		<li><a href="#database_handle_methods">Database Handle Methods</a></li>
		<ul>

			<li><a href="#clone"><code>clone</code></a></li>
			<li><a href="#data_sources"><code>data_sources</code></a></li>
			<li><a href="#do"><a href="../lib/pods/perlfunc.html#do"><code>do</code></a></a></li>
			<li><a href="#last_insert_id"><code>last_insert_id</code></a></li>
			<li><a href="#selectrow_array"><code>selectrow_array</code></a></li>
			<li><a href="#selectrow_arrayref"><code>selectrow_arrayref</code></a></li>
			<li><a href="#selectrow_hashref"><code>selectrow_hashref</code></a></li>
			<li><a href="#selectall_arrayref"><code>selectall_arrayref</code></a></li>
			<li><a href="#selectall_hashref"><code>selectall_hashref</code></a></li>
			<li><a href="#selectcol_arrayref"><code>selectcol_arrayref</code></a></li>
			<li><a href="#prepare"><code>prepare</code></a></li>
			<li><a href="#prepare_cached"><code>prepare_cached</code></a></li>
			<li><a href="#commit"><code>commit</code></a></li>
			<li><a href="#rollback"><code>rollback</code></a></li>
			<li><a href="#begin_work"><code>begin_work</code></a></li>
			<li><a href="#disconnect"><code>disconnect</code></a></li>
			<li><a href="#ping"><code>ping</code></a></li>
			<li><a href="#get_info"><code>get_info</code></a></li>
			<li><a href="#table_info"><code>table_info</code></a></li>
			<li><a href="#column_info"><code>column_info</code></a></li>
			<li><a href="#primary_key_info"><code>primary_key_info</code></a></li>
			<li><a href="#primary_key"><code>primary_key</code></a></li>
			<li><a href="#foreign_key_info"><code>foreign_key_info</code></a></li>
			<li><a href="#statistics_info"><code>statistics_info</code></a></li>
			<li><a href="#tables"><code>tables</code></a></li>
			<li><a href="#type_info_all"><code>type_info_all</code></a></li>
			<li><a href="#type_info"><code>type_info</code></a></li>
			<li><a href="#quote"><code>quote</code></a></li>
			<li><a href="#quote_identifier"><code>quote_identifier</code></a></li>
			<li><a href="#take_imp_data"><code>take_imp_data</code></a></li>
		</ul>

		<li><a href="#database_handle_attributes">Database Handle Attributes</a></li>
		<ul>

			<li><a href="#autocommit__boolean_"><code>AutoCommit</code>  (boolean)</a></li>
			<li><a href="#driver__handle_"><code>Driver</code>  (handle)</a></li>
			<li><a href="#name__string_"><code>Name</code>  (string)</a></li>
			<li><a href="#statement__string__read_only_"><code>Statement</code>  (string, read-only)</a></li>
			<li><a href="#rowcachesize__integer_"><code>RowCacheSize</code>  (integer)</a></li>
			<li><a href="#username__string_"><code>Username</code>  (string)</a></li>
		</ul>

	</ul>

	<li><a href="#dbi_statement_handle_objects">DBI STATEMENT HANDLE OBJECTS</a></li>
	<ul>

		<li><a href="#statement_handle_methods">Statement Handle Methods</a></li>
		<ul>

			<li><a href="#bind_param"><code>bind_param</code></a></li>
			<li><a href="#bind_param_inout"><code>bind_param_inout</code></a></li>
			<li><a href="#bind_param_array"><code>bind_param_array</code></a></li>
			<li><a href="#execute"><code>execute</code></a></li>
			<li><a href="#execute_array"><code>execute_array</code></a></li>
			<li><a href="#execute_for_fetch"><code>execute_for_fetch</code></a></li>
			<li><a href="#fetchrow_arrayref"><code>fetchrow_arrayref</code></a></li>
			<li><a href="#fetchrow_array"><code>fetchrow_array</code></a></li>
			<li><a href="#fetchrow_hashref"><code>fetchrow_hashref</code></a></li>
			<li><a href="#fetchall_arrayref"><code>fetchall_arrayref</code></a></li>
			<li><a href="#fetchall_hashref"><code>fetchall_hashref</code></a></li>
			<li><a href="#finish"><code>finish</code></a></li>
			<li><a href="#rows"><code>rows</code></a></li>
			<li><a href="#bind_col"><code>bind_col</code></a></li>
			<li><a href="#bind_columns"><code>bind_columns</code></a></li>
			<li><a href="#dump_results"><code>dump_results</code></a></li>
		</ul>

		<li><a href="#statement_handle_attributes">Statement Handle Attributes</a></li>
		<ul>

			<li><a href="#num_of_fields__integer__read_only_"><code>NUM_OF_FIELDS</code>  (integer, read-only)</a></li>
			<li><a href="#num_of_params__integer__read_only_"><code>NUM_OF_PARAMS</code>  (integer, read-only)</a></li>
			<li><a href="#name__array_ref__read_only_"><a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a>  (array-ref, read-only)</a></li>
			<li><a href="#name_lc__array_ref__read_only_"><code>NAME_lc</code>  (array-ref, read-only)</a></li>
			<li><a href="#name_uc__array_ref__read_only_"><code>NAME_uc</code>  (array-ref, read-only)</a></li>
			<li><a href="#name_hash__hash_ref__read_only_"><code>NAME_hash</code>  (hash-ref, read-only)</a></li>
			<li><a href="#name_lc_hash__hash_ref__read_only_"><code>NAME_lc_hash</code>  (hash-ref, read-only)</a></li>
			<li><a href="#name_uc_hash__hash_ref__read_only_"><code>NAME_uc_hash</code>  (hash-ref, read-only)</a></li>
			<li><a href="#type__array_ref__read_only_"><code>TYPE</code>  (array-ref, read-only)</a></li>
			<li><a href="#precision__array_ref__read_only_"><code>PRECISION</code>  (array-ref, read-only)</a></li>
			<li><a href="#scale__array_ref__read_only_"><code>SCALE</code>  (array-ref, read-only)</a></li>
			<li><a href="#nullable__array_ref__read_only_"><code>NULLABLE</code>  (array-ref, read-only)</a></li>
			<li><a href="#cursorname__string__read_only_"><code>CursorName</code>  (string, read-only)</a></li>
			<li><a href="#database__dbh__read_only_"><code>Database</code>  (dbh, read-only)</a></li>
			<li><a href="#paramvalues__hash_ref__read_only_"><code>ParamValues</code>  (hash ref, read-only)</a></li>
			<li><a href="#paramarrays__hash_ref__read_only_"><code>ParamArrays</code>  (hash ref, read-only)</a></li>
			<li><a href="#paramtypes__hash_ref__read_only_"><code>ParamTypes</code>  (hash ref, read-only)</a></li>
			<li><a href="#statement__string__read_only_"><code>Statement</code>  (string, read-only)</a></li>
			<li><a href="#rowsincache__integer__read_only_"><code>RowsInCache</code>  (integer, read-only)</a></li>
		</ul>

	</ul>

	<li><a href="#further_information">FURTHER INFORMATION</a></li>
	<ul>

		<li><a href="#catalog_methods">Catalog Methods</a></li>
		<li><a href="#transactions">Transactions</a></li>
		<li><a href="#handling_blob___long___memo_fields">Handling BLOB / LONG / Memo Fields</a></li>
		<li><a href="#simple_examples">Simple Examples</a></li>
		<li><a href="#threads_and_thread_safety">Threads and Thread Safety</a></li>
		<li><a href="#signal_handling_and_canceling_operations">Signal Handling and Canceling Operations</a></li>
		<li><a href="#subclassing_the_dbi">Subclassing the DBI</a></li>
	</ul>

	<li><a href="#tracing">TRACING</a></li>
	<ul>

		<li><a href="#trace_settings">Trace Settings</a></li>
		<li><a href="#trace_levels">Trace Levels</a></li>
		<li><a href="#trace_flags">Trace Flags</a></li>
		<li><a href="#enabling_trace">Enabling Trace</a></li>
		<li><a href="#trace_output">Trace Output</a></li>
		<li><a href="#tracing_to_layered_filehandles">Tracing to Layered Filehandles</a></li>
		<li><a href="#trace_content">Trace Content</a></li>
		<li><a href="#tracing_tips">Tracing Tips</a></li>
	</ul>

	<li><a href="#dbi_environment_variables">DBI ENVIRONMENT VARIABLES</a></li>
	<ul>

		<li><a href="#dbi_dsn">DBI_DSN</a></li>
		<li><a href="#dbi_driver">DBI_DRIVER</a></li>
		<li><a href="#dbi_autoproxy">DBI_AUTOPROXY</a></li>
		<li><a href="#dbi_user">DBI_USER</a></li>
		<li><a href="#dbi_pass">DBI_PASS</a></li>
		<li><a href="#dbi_dbname__obsolete_">DBI_DBNAME (obsolete)</a></li>
		<li><a href="#dbi_trace">DBI_TRACE</a></li>
		<li><a href="#perl_dbi_debug__obsolete_">PERL_DBI_DEBUG (obsolete)</a></li>
		<li><a href="#dbi_profile">DBI_PROFILE</a></li>
		<li><a href="#dbi_pureperl">DBI_PUREPERL</a></li>
	</ul>

	<li><a href="#warning_and_error_messages">WARNING AND ERROR MESSAGES</a></li>
	<ul>

		<li><a href="#fatal_errors">Fatal Errors</a></li>
	</ul>

	<li><a href="#pure_perl_dbi">Pure-Perl DBI</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<ul>

		<li><a href="#driver_and_database_documentation">Driver and Database Documentation</a></li>
		<li><a href="#odbc_and_sql_cli_standards_reference_information">ODBC and SQL/CLI Standards Reference Information</a></li>
		<li><a href="#standards_reference_information">Standards Reference Information</a></li>
		<li><a href="#books_and_articles">Books and Articles</a></li>
		<li><a href="#perl_modules">Perl Modules</a></li>
		<li><a href="#mailing_list">Mailing List</a></li>
		<li><a href="#assorted_related_www_links">Assorted Related WWW Links</a></li>
		<li><a href="#faq">FAQ</a></li>
	</ul>

	<li><a href="#authors">AUTHORS</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
	<li><a href="#support___warranty">SUPPORT / WARRANTY</a></li>
	<ul>

		<li><a href="#support">Support</a></li>
		<li><a href="#sponsor_enhancements">Sponsor Enhancements</a></li>
	</ul>

	<li><a href="#acknowledgements">ACKNOWLEDGEMENTS</a></li>
	<li><a href="#contributing">CONTRIBUTING</a></li>
	<ul>

		<li><a href="#browsing_the_source_code_repository">Browsing the source code repository</a></li>
		<li><a href="#how_to_create_a_patch_using_subversion">How to create a patch using Subversion</a></li>
		<li><a href="#how_to_create_a_patch_without_subversion">How to create a patch without Subversion</a></li>
		<li><a href="#speak_before_you_patch">Speak before you patch</a></li>
	</ul>

	<li><a href="#translations">TRANSLATIONS</a></li>
	<li><a href="#training">TRAINING</a></li>
	<li><a href="#other_related_work_and_perl_modules">OTHER RELATED WORK AND PERL MODULES</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>DBI - Database independent interface for Perl</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">@driver_names</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">available_drivers</span><span class="operator">;</span>
  <span class="variable">%drivers</span>      <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_drivers</span><span class="operator">;</span>
  <span class="variable">@data_sources</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver_name</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$auth</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$rv</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$rv</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$rv</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$key_field</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">@row_ary</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_array</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="variable">$bind_value</span><span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="variable">$bind_value</span><span class="operator">,</span> <span class="variable">$bind_type</span><span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="variable">$bind_value</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">@bind_values</span><span class="operator">);</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="operator">...);</span>
</pre>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="variable">$col_num</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$col_variable</span><span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_columns</span><span class="operator">(</span><span class="variable">@list_of_refs_to_vars_to_bind</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">@row_ary</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span><span class="operator">;</span>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_arrayref</span><span class="operator">;</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_hashref</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">;</span>
  <span class="variable">$ary_ref</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span> <span class="variable">$slice</span><span class="operator">,</span> <span class="variable">$max_rows</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_hashref</span><span class="operator">(</span> <span class="variable">$key_field</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$rv</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">rows</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">begin_work</span><span class="operator">;</span>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span><span class="operator">;</span>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">rollback</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$quoted_string</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote</span><span class="operator">(</span><span class="variable">$string</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">err</span><span class="operator">;</span>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$rv</span>  <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">state</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">disconnect</span><span class="operator">;</span>
</pre>
<p><em>The synopsis above only lists the major methods and parameters.</em></p>
<p>
</p>
<h2><a name="getting_help">GETTING HELP</a></h2>
<p>If you have questions about DBI, or DBD driver modules, you can get
help from the <em><a href="mailto:dbi-users@perl.org">dbi-users@perl.org</a></em> mailing list.  You don't have to subscribe
to the list in order to post, though I'd recommend it. You can get help on
subscribing and using the list by emailing <em><a href="mailto:dbi-users-help@perl.org">dbi-users-help@perl.org</a></em>.</p>
<p>I don't recommend the DBI cpanform (at <a href="http://www.cpanforum.com/dist/DBI)">http://www.cpanforum.com/dist/DBI)</a>
because relatively few people read it compared with <a href="mailto:dbi-users@perl.org.">dbi-users@perl.org.</a></p>
<p>To help you make the best use of the dbi-users mailing list,
and any other lists or forums you may use, I <em>strongly</em>
recommend that you read &quot;How To Ask Questions The Smart Way&quot;
by Eric Raymond: <a href="http://www.catb.org/~esr/faqs/smart-questions.html">http://www.catb.org/~esr/faqs/smart-questions.html</a>.</p>
<p>If you think you've found a bug then please also read
&quot;How to Report Bugs Effectively&quot; by Simon Tatham:
<a href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html">http://www.chiark.greenend.org.uk/~sgtatham/bugs.html</a>.</p>
<p>The DBI home page at <a href="http://dbi.perl.org/">http://dbi.perl.org/</a> and the DBI FAQ
at <a href="http://faq.dbi-support.com/">http://faq.dbi-support.com/</a> are always worth a visit.
They include links to other resources.</p>
<p>Before asking any questions, reread this document, consult the
archives and read the DBI FAQ. The archives are listed
at the end of this document and on the DBI home page.</p>
<p>This document often uses terms like <em>references</em>, <em>objects</em>,
<em>methods</em>.  If you're not familar with those terms then it would
be a good idea to read at least the following perl manuals first:
<a href="../lib/pods/perlreftut.html">the perlreftut manpage</a>, <a href="../lib/pods/perldsc.html">the perldsc manpage</a>, <a href="../lib/pods/perllol.html">the perllol manpage</a>, and <a href="../lib/pods/perlboot.html">the perlboot manpage</a>.</p>
<p>Please note that Tim Bunce does not maintain the mailing lists or the
web page (generous volunteers do that).  So please don't send mail
directly to him; he just doesn't have the time to answer questions
personally. The <em>dbi-users</em> mailing list has lots of experienced
people who should be able to help you if you need it. If you do email
Tim he's very likely to just forward it to the mailing list.</p>
<p>
</p>
<h2><a name="notes">NOTES</a></h2>
<p>This is the DBI specification that corresponds to the DBI version 1.607
($Revision: 11570 $).</p>
<p>The DBI is evolving at a steady pace, so it's good to check that
you have the latest copy.</p>
<p>The significant user-visible changes in each release are documented
in the <a href="../lib/DBI/Changes.html">the DBI::Changes manpage</a> module so you can read them by executing
<code>perldoc DBI::Changes</code>.</p>
<p>Some DBI changes require changes in the drivers, but the drivers
can take some time to catch up. Newer versions of the DBI have
added features that may not yet be supported by the drivers you
use.  Talk to the authors of your drivers if you need a new feature
that's not yet supported.</p>
<p>Features added after DBI 1.21 (February 2002) are marked in the
text with the version number of the DBI release they first appeared in.</p>
<p>Extensions to the DBI API often use the <code>DBIx::*</code> namespace.
See <a href="#naming_conventions_and_name_space">Naming Conventions and Name Space</a>. DBI extension modules
can be found at <a href="http://search.cpan.org/search?mode=module&query=DBIx">http://search.cpan.org/search</a>.
And all modules related to the DBI can be found at
<a href="http://search.cpan.org/search?query=DBI&mode=all">http://search.cpan.org/search</a>.</p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>The DBI is a database access module for the Perl programming language.  It defines
a set of methods, variables, and conventions that provide a consistent
database interface, independent of the actual database being used.</p>
<p>It is important to remember that the DBI is just an interface.
The DBI is a layer
of &quot;glue&quot; between an application and one or more database <em>driver</em>
modules.  It is the driver modules which do most of the real work. The DBI
provides a standard interface and framework for the drivers to operate
within.</p>
<p>
</p>
<h2><a name="architecture_of_a_dbi_application">Architecture of a DBI Application</a></h2>
<pre>
             |&lt;- Scope of DBI -&gt;|
                  .-.   .--------------.   .-------------.
  .-------.       | |---| XYZ Driver   |---| XYZ Engine  |
  | Perl  |       | |   `--------------'   `-------------'
  | script|  |A|  |D|   .--------------.   .-------------.
  | using |--|P|--|B|---|Oracle Driver |---|Oracle Engine|
  | DBI   |  |I|  |I|   `--------------'   `-------------'
  | API   |       | |...
  |methods|       | |... Other drivers
  `-------'       | |...
                  `-'</pre>
<p>The API, or Application Programming Interface, defines the
call interface and variables for Perl scripts to use. The API
is implemented by the Perl DBI extension.</p>
<p>The DBI &quot;dispatches&quot; the method calls to the appropriate driver for
actual execution.  The DBI is also responsible for the dynamic loading
of drivers, error checking and handling, providing default
implementations for methods, and many other non-database specific duties.</p>
<p>Each driver
contains implementations of the DBI methods using the
private interface functions of the corresponding database engine.  Only authors
of sophisticated/multi-database applications or generic library
functions need be concerned with drivers.</p>
<p>
</p>
<h2><a name="notation_and_conventions">Notation and Conventions</a></h2>
<p>The following conventions are used in this document:</p>
<pre>
  $dbh    Database handle object
  $sth    Statement handle object
  $drh    Driver handle object (rarely seen or used in applications)
  $h      Any of the handle types above ($dbh, $sth, or $drh)
  $rc     General Return Code  (boolean: true=ok, false=error)
  $rv     General Return Value (typically an integer)
  @ary    List of values returned from the database, typically a row of data
  $rows   Number of rows processed (if available, else -1)
  $fh     A filehandle
  undef   NULL values are represented by undefined values in Perl
  \%attr  Reference to a hash of attribute values passed to methods</pre>
<p>Note that Perl will automatically destroy database and statement handle objects
if all references to them are deleted.</p>
<p>
</p>
<h2><a name="outline_usage">Outline Usage</a></h2>
<p>To use DBI,
first you need to load the DBI module:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
</pre>
<p>(The <code>use strict;</code> isn't required but is strongly recommended.)</p>
<p>Then you need to <a href="../lib/pods/perlfunc.html#connect">connect</a> to your data source and get a <em>handle</em> for that
connection:</p>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$dsn</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span>
                      <span class="operator">{</span> <span class="string">RaiseError</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span> <span class="string">AutoCommit</span> <span class="operator">=&gt;</span> <span class="number">0</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>Since connecting can be expensive, you generally just connect at the
start of your program and disconnect at the end.</p>
<p>Explicitly defining the required <code>AutoCommit</code> behaviour is strongly
recommended and may become mandatory in a later version.  This
determines whether changes are automatically committed to the
database when executed, or need to be explicitly committed later.</p>
<p>The DBI allows an application to &quot;prepare&quot; statements for later
execution.  A prepared statement is identified by a statement handle
held in a Perl variable.
We'll call the Perl variable <code>$sth</code> in our examples.</p>
<p>The typical method call sequence for a <code>SELECT</code> statement is:</p>
<pre>
  prepare,
    execute, fetch, fetch, ...
    execute, fetch, fetch, ...
    execute, fetch, fetch, ...</pre>
<p>for example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"SELECT foo, bar FROM table WHERE baz=?"</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span> <span class="variable">$baz</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">while</span> <span class="operator">(</span> <span class="variable">@row</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span> <span class="operator">)</span> <span class="operator">{</span>
    <span class="keyword">print</span> <span class="string">"</span><span class="variable">@row</span><span class="string">\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>The typical method call sequence for a <em>non</em>-<code>SELECT</code> statement is:</p>
<pre>
  prepare,
    execute,
    execute,
    execute.</pre>
<p>for example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"INSERT INTO table(foo,bar,baz) VALUES (?,?,?)"</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">while</span><span class="operator">(&lt;</span><span class="variable">CSV</span><span class="operator">&gt;)</span> <span class="operator">{</span>
    <span class="keyword">chomp</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$foo</span><span class="operator">,</span><span class="variable">$bar</span><span class="operator">,</span><span class="variable">$baz</span><span class="operator">)</span> <span class="operator">=</span> <span class="keyword">split</span> <span class="regex">/,/</span><span class="operator">;</span>
        <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span> <span class="variable">$foo</span><span class="operator">,</span> <span class="variable">$bar</span><span class="operator">,</span> <span class="variable">$baz</span> <span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<p>The <a href="../lib/pods/perlfunc.html#do"><code>do()</code></a> method can be used for non repeated <em>non</em>-<code>SELECT</code> statement
(or with drivers that don't support placeholders):</p>
<pre>
  <span class="variable">$rows_affected</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">"UPDATE your_table SET foo = foo + 1"</span><span class="operator">);</span>
</pre>
<p>To commit your changes to the database (when <a href="#autocommit">AutoCommit</a> is off):</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span><span class="operator">;</span>  <span class="comment"># or call $dbh-&gt;rollback; to undo changes</span>
</pre>
<p>Finally, when you have finished working with the data source, you should
<a href="#disconnect">disconnect</a> from it:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">disconnect</span><span class="operator">;</span>
</pre>
<p>
</p>
<h2><a name="general_interface_rules___caveats">General Interface Rules &amp; Caveats</a></h2>
<p>The DBI does not have a concept of a &quot;current session&quot;. Every session
has a handle object (i.e., a <code>$dbh</code>) returned from the <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> method.
That handle object is used to invoke database related methods.</p>
<p>Most data is returned to the Perl script as strings. (Null values are
returned as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.)  This allows arbitrary precision numeric data to be
handled without loss of accuracy.  Beware that Perl may not preserve
the same accuracy when the string is used as a number.</p>
<p>Dates and times are returned as character strings in the current
default format of the corresponding database engine.  Time zone effects
are database/driver dependent.</p>
<p>Perl supports binary data in Perl strings, and the DBI will pass binary
data to and from the driver without change. It is up to the driver
implementors to decide how they wish to handle such binary data.</p>
<p>Perl supports two kinds of strings: unicode (utf8 internally) and non-unicode
(defaults to iso-8859-1 if forced to assume an encoding).  Drivers should
accept both kinds of strings and, if required, convert them to the character
set of the database being used. Similarly, when fetching from the database
character data that isn't iso-8859-1 the driver should convert it into utf8.</p>
<p>Multiple SQL statements may not be combined in a single statement
handle (<code>$sth</code>), although some databases and drivers do support this
(notably Sybase and SQL Server).</p>
<p>Non-sequential record reads are not supported in this version of the DBI.
In other words, records can only be fetched in the order that the
database returned them, and once fetched they are forgotten.</p>
<p>Positioned updates and deletes are not directly supported by the DBI.
See the description of the <code>CursorName</code> attribute for an alternative.</p>
<p>Individual driver implementors are free to provide any private
functions and/or handle attributes that they feel are useful.
Private driver functions can be invoked using the DBI <code>func()</code> method.
Private driver attributes are accessed just like standard attributes.</p>
<p>Many methods have an optional <code>\%attr</code> parameter which can be used to
pass information to the driver implementing the method. Except where
specifically documented, the <code>\%attr</code> parameter can only be used to pass
driver specific hints. In general, you can ignore <code>\%attr</code> parameters
or pass it as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.</p>
<p>
</p>
<h2><a name="naming_conventions_and_name_space">Naming Conventions and Name Space</a></h2>
<p>The DBI package and all packages below it (<code>DBI::*</code>) are reserved for
use by the DBI. Extensions and related modules use the <code>DBIx::</code>
namespace (see <a href="http://www.perl.com/CPAN/modules/by-module/DBIx/">http://www.perl.com/CPAN/modules/by-module/DBIx/</a>).
Package names beginning with <code>DBD::</code> are reserved for use
by DBI database drivers.  All environment variables used by the DBI
or by individual DBDs begin with &quot;<code>DBI_</code>&quot; or &quot;<code>DBD_</code>&quot;.</p>
<p>The letter case used for attribute names is significant and plays an
important part in the portability of DBI scripts.  The case of the
attribute name is used to signify who defined the meaning of that name
and its values.</p>
<pre>
  Case of name  Has a meaning defined by
  ------------  ------------------------
  UPPER_CASE    Standards, e.g.,  X/Open, ISO SQL92 etc (portable)
  MixedCase     DBI API (portable), underscores are not used.
  lower_case    Driver or database engine specific (non-portable)</pre>
<p>It is of the utmost importance that Driver developers only use
lowercase attribute names when defining private attributes. Private
attribute names must be prefixed with the driver name or suitable
abbreviation (e.g., &quot;<code>ora_</code>&quot; for Oracle, &quot;<code>ing_</code>&quot; for Ingres, etc).</p>
<p>
</p>
<h2><a name="sql___a_query_language">SQL - A Query Language</a></h2>
<p>Most DBI drivers require applications to use a dialect of SQL
(Structured Query Language) to interact with the database engine.
The <a href="#standards_reference_information">Standards Reference Information</a> section provides links
to useful information about SQL.</p>
<p>The DBI itself does not mandate or require any particular language to
be used; it is language independent. In ODBC terms, the DBI is in
&quot;pass-thru&quot; mode, although individual drivers might not be. The only requirement
is that queries and other statements must be expressed as a single
string of characters passed as the first argument to the <a href="#prepare">prepare</a> or
<a href="../lib/pods/perlfunc.html#do">do</a> methods.</p>
<p>For an interesting diversion on the <em>real</em> history of RDBMS and SQL,
from the people who made it happen, see:</p>
<pre>
  <a href="http://ftp.digital.com/pub/DEC/SRC/technical-notes/SRC-1997-018-html/sqlr95.html">http://ftp.digital.com/pub/DEC/SRC/technical-notes/SRC-1997-018-html/sqlr95.html</a></pre>
<p>Follow the &quot;Full Contents&quot; then &quot;Intergalactic dataspeak&quot; links for the
SQL history.</p>
<p>
</p>
<h2><a name="placeholders_and_bind_values">Placeholders and Bind Values</a></h2>
<p>Some drivers support placeholders and bind values.
<em>Placeholders</em>, also called parameter markers, are used to indicate
values in a database statement that will be supplied later,
before the prepared statement is executed.  For example, an application
might use the following to insert a row of data into the SALES table:</p>
<pre>
  INSERT INTO sales (product_code, qty, price) VALUES (?, ?, ?)</pre>
<p>or the following, to select the description for a product:</p>
<pre>
  SELECT description FROM products WHERE product_code = ?</pre>
<p>The <code>?</code> characters are the placeholders.  The association of actual
values with placeholders is known as <em>binding</em>, and the values are
referred to as <em>bind values</em>.
Note that the <code>?</code> is not enclosed in quotation marks, even when the
placeholder represents a string.</p>
<p>Some drivers also allow placeholders like <code>:</code><em>name</em> and <code>:</code><em>N</em> (e.g.,
<code>:1</code>, <code>:2</code>, and so on) in addition to <code>?</code>, but their use is not portable.</p>
<p>If the <code>:</code><em>N</em> form of placeholder is supported by the driver you're using,
then you should be able to use either <a href="#bind_param">bind_param</a> or <a href="#execute">execute</a> to bind
values. Check your driver documentation.</p>
<p>With most drivers, placeholders can't be used for any element of a
statement that would prevent the database server from validating the
statement and creating a query execution plan for it. For example:</p>
<pre>
  &quot;SELECT name, age FROM ?&quot;         # wrong (will probably fail)
  &quot;SELECT name, ?   FROM people&quot;    # wrong (but may not 'fail')</pre>
<p>Also, placeholders can only represent single scalar values.
For example, the following
statement won't work as expected for more than one value:</p>
<pre>
  &quot;SELECT name, age FROM people WHERE name IN (?)&quot;    # wrong
  &quot;SELECT name, age FROM people WHERE name IN (?,?)&quot;  # two names</pre>
<p>When using placeholders with the SQL <code>LIKE</code> qualifier, you must
remember that the placeholder substitutes for the whole string.
So you should use &quot;<code>... LIKE ? ...</code>&quot; and include any wildcard
characters in the value that you bind to the placeholder.</p>
<p><strong>NULL Values</strong></p>
<p>Undefined values, or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>, are used to indicate NULL values.
You can insert and update columns with a NULL value as you would a
non-NULL value.  These examples insert and update the column
<code>age</code> with a NULL value:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">qq{
    INSERT INTO people (fullname, age) VALUES (?, ?)
  }</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="string">"Joe Bloggs"</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">qq{
    UPDATE people SET age = ? WHERE fullname = ?
  }</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="keyword">undef</span><span class="operator">,</span> <span class="string">"Joe Bloggs"</span><span class="operator">);</span>
</pre>
<p>However, care must be taken when trying to use NULL values in a
<code>WHERE</code> clause.  Consider:</p>
<pre>
  SELECT fullname FROM people WHERE age = ?</pre>
<p>Binding an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> (NULL) to the placeholder will <em>not</em> select rows
which have a NULL <code>age</code>!  At least for database engines that
conform to the SQL standard.  Refer to the SQL manual for your database
engine or any SQL book for the reasons for this.  To explicitly select
NULLs you have to say &quot;<code>WHERE age IS NULL</code>&quot;.</p>
<p>A common issue is to have a code fragment handle a value that could be
either <a href="../lib/pods/perlfunc.html#defined"><code>defined</code></a> or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> (non-NULL or NULL) at runtime.
A simple technique is to prepare the appropriate statement as needed,
and substitute the placeholder for non-NULL cases:</p>
<pre>
  <span class="variable">$sql_clause</span> <span class="operator">=</span> <span class="keyword">defined</span> <span class="variable">$age</span><span class="operator">?</span> <span class="string">"age = ?"</span> <span class="operator">:</span> <span class="string">"age IS NULL"</span><span class="operator">;</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">qq{
    SELECT fullname FROM people WHERE </span><span class="variable">$sql_clause</span><span class="string">
  }</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="keyword">defined</span> <span class="variable">$age</span> <span class="operator">?</span> <span class="variable">$age</span> <span class="operator">:</span> <span class="operator">());</span>
</pre>
<p>The following technique illustrates qualifying a <code>WHERE</code> clause with
several columns, whose associated values (<a href="../lib/pods/perlfunc.html#defined"><code>defined</code></a> or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) are
in a hash %h:</p>
<pre>
  <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$col</span> <span class="operator">(</span><span class="string">"age"</span><span class="operator">,</span> <span class="string">"phone"</span><span class="operator">,</span> <span class="string">"email"</span><span class="operator">)</span> <span class="operator">{</span>
    <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">defined</span> <span class="variable">$h</span><span class="operator">{</span><span class="variable">$col</span><span class="operator">}</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">push</span> <span class="variable">@sql_qual</span><span class="operator">,</span> <span class="string">"</span><span class="variable">$col</span><span class="string"> = ?"</span><span class="operator">;</span>
      <span class="keyword">push</span> <span class="variable">@sql_bind</span><span class="operator">,</span> <span class="variable">$h</span><span class="operator">{</span><span class="variable">$col</span><span class="operator">}</span><span class="operator">;</span>
    <span class="operator">}</span>
    <span class="keyword">else</span> <span class="operator">{</span>
      <span class="keyword">push</span> <span class="variable">@sql_qual</span><span class="operator">,</span> <span class="string">"</span><span class="variable">$col</span><span class="string"> IS NULL"</span><span class="operator">;</span>
    <span class="operator">}</span>
  <span class="operator">}</span>
  <span class="variable">$sql_clause</span> <span class="operator">=</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">" AND "</span><span class="operator">,</span> <span class="variable">@sql_qual</span><span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">qq{
      SELECT fullname FROM people WHERE </span><span class="variable">$sql_clause</span><span class="string">
  }</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">@sql_bind</span><span class="operator">);</span>
</pre>
<p>The techniques above call prepare for the SQL statement with each call to
execute.  Because calls to <code>prepare()</code> can be expensive, performance
can suffer when an application iterates many times over statements
like the above.</p>
<p>A better solution is a single <code>WHERE</code> clause that supports both
NULL and non-NULL comparisons.  Its SQL statement would need to be
prepared only once for all cases, thus improving performance.
Several examples of <code>WHERE</code> clauses that support this are presented
below.  But each example lacks portability, robustness, or simplicity.
Whether an example is supported on your database engine depends on
what SQL extensions it provides, and where it supports the <code>?</code>
placeholder in a statement.</p>
<pre>
  0)  age = ?
  1)  NVL(age, xx) = NVL(?, xx)
  2)  ISNULL(age, xx) = ISNULL(?, xx)
  3)  DECODE(age, ?, 1, 0) = 1
  4)  age = ? OR (age IS NULL AND ? IS NULL)
  5)  age = ? OR (age IS NULL AND SP_ISNULL(?) = 1)
  6)  age = ? OR (age IS NULL AND ? = 1)</pre>
<p>Statements formed with the above <code>WHERE</code> clauses require execute
statements as follows.  The arguments are required, whether their
values are <a href="../lib/pods/perlfunc.html#defined"><code>defined</code></a> or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.</p>
<pre>
  <span class="number">0</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="operator">,</span><span class="number">3</span><span class="operator">)</span>  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$age</span><span class="operator">);</span>
  <span class="number">4</span><span class="operator">,</span><span class="number">5</span><span class="operator">)</span>      <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$age</span><span class="operator">,</span> <span class="variable">$age</span><span class="operator">);</span>
  <span class="number">6</span><span class="operator">)</span>        <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$age</span><span class="operator">,</span> <span class="keyword">defined</span><span class="operator">(</span><span class="variable">$age</span><span class="operator">)</span> <span class="operator">?</span> <span class="number">0</span> <span class="operator">:</span> <span class="number">1</span><span class="operator">);</span>
</pre>
<p>Example 0 should not work (as mentioned earlier), but may work on
a few database engines anyway (e.g. Sybase).  Example 0 is part
of examples 4, 5, and 6, so if example 0 works, these other
examples may work, even if the engine does not properly support
the right hand side of the <code>OR</code> expression.</p>
<p>Examples 1 and 2 are not robust: they require that you provide a
valid column value xx (e.g. '~') which is not present in any row.
That means you must have some notion of what data won't be stored
in the column, and expect clients to adhere to that.</p>
<p>Example 5 requires that you provide a stored procedure (SP_ISNULL
in this example) that acts as a function: it checks whether a value
is null, and returns 1 if it is, or 0 if not.</p>
<p>Example 6, the least simple, is probably the most portable, i.e., it
should work with with most, if not all, database engines.</p>
<p>Here is a table that indicates which examples above are known to
work on various database engines:</p>
<pre>
                   -----Examples------
                   0  1  2  3  4  5  6
                   -  -  -  -  -  -  -
  Oracle 9         N  Y  N  Y  Y  ?  Y
  Informix IDS 9   N  N  N  Y  N  Y  Y
  MS SQL           N  N  Y  N  Y  ?  Y
  Sybase           Y  N  N  N  N  N  Y
  AnyData,DBM,CSV  Y  N  N  N  Y  Y* Y
  SQLite 3.3       N  N  N  N  Y  N  N</pre>
<p>* Works only because Example 0 works.</p>
<p>DBI provides a sample perl script that will test the examples above
on your database engine and tell you which ones work.  It is located
in the <em class="file">ex/</em> subdirectory of the DBI source distribution, or here:
<a href="http://svn.perl.org/modules/dbi/trunk/ex/perl_dbi_nulls_test.pl">http://svn.perl.org/modules/dbi/trunk/ex/perl_dbi_nulls_test.pl</a>
Please use the script to help us fill-in and maintain this table.</p>
<p><strong>Performance</strong></p>
<p>Without using placeholders, the insert statement shown previously would have to
contain the literal values to be inserted and would have to be
re-prepared and re-executed for each row. With placeholders, the insert
statement only needs to be prepared once. The bind values for each row
can be given to the <code>execute</code> method each time it's called. By avoiding
the need to re-prepare the statement for each row, the application
typically runs many times faster. Here's an example:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{
    INSERT INTO sales (product_code, qty, price) VALUES (?, ?, ?)
  }</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="keyword">while</span> <span class="operator">(&lt;&gt;)</span> <span class="operator">{</span>
      <span class="keyword">chomp</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$product_code</span><span class="operator">,</span> <span class="variable">$qty</span><span class="operator">,</span> <span class="variable">$price</span><span class="operator">)</span> <span class="operator">=</span> <span class="keyword">split</span> <span class="regex">/,/</span><span class="operator">;</span>
      <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$product_code</span><span class="operator">,</span> <span class="variable">$qty</span><span class="operator">,</span> <span class="variable">$price</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="operator">}</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>See <a href="#execute">execute</a> and <a href="#bind_param">bind_param</a> for more details.</p>
<p>The <code>q{...}</code> style quoting used in this example avoids clashing with
quotes that may be used in the SQL statement. Use the double-quote like
<code>qq{...}</code> operator if you want to interpolate variables into the string.
See <a href="../lib/pods/perlop.html#quote_and_quote_like_operators">Quote and Quote-like Operators in the perlop manpage</a> for more details.</p>
<p>See also the <a href="#bind_columns">bind_columns</a> method, which is used to associate Perl
variables with the output columns of a <code>SELECT</code> statement.</p>
<p>
</p>
<hr />
<h1><a name="the_dbi_package_and_class">THE DBI PACKAGE AND CLASS</a></h1>
<p>In this section, we cover the DBI class methods, utility functions,
and the dynamic attributes associated with generic DBI handles.</p>
<p>
</p>
<h2><a name="dbi_constants">DBI Constants</a></h2>
<p>Constants representing the values of the SQL standard types can be
imported individually by name, or all together by importing the
special <code>:sql_types</code> tag.</p>
<p>The names and values of all the defined SQL standard types can be
produced like this:</p>
<pre>
  <span class="keyword">foreach</span> <span class="operator">(</span><span class="variable">@</span><span class="operator">{</span> <span class="variable">$DBI::EXPORT_TAGS</span><span class="operator">{</span><span class="string">sql_types</span><span class="operator">}</span> <span class="operator">}</span><span class="operator">)</span> <span class="operator">{</span>
    <span class="keyword">printf</span> <span class="string">"%s=%d\n"</span><span class="operator">,</span> <span class="variable">$_</span><span class="operator">,</span> <span class="operator">&amp;{</span><span class="string">"DBI::</span><span class="variable">$_</span><span class="string">"</span><span class="operator">};</span>
  <span class="operator">}</span>
</pre>
<p>These constants are defined by SQL/CLI, ODBC or both.
<code>SQL_BIGINT</code> is (currently) omitted, because SQL/CLI and ODBC provide
conflicting codes.</p>
<p>See the <a href="#type_info">type_info</a>, <a href="#type_info_all">type_info_all</a>, and <a href="#bind_param">bind_param</a> methods
for possible uses.</p>
<p>Note that just because the DBI defines a named constant for a given
data type doesn't mean that drivers will support that data type.</p>
<p>
</p>
<h2><a name="dbi_class_methods">DBI Class Methods</a></h2>
<p>The following methods are provided by the DBI class:</p>
<p>
</p>
<h3><a name="parse_dsn"><code>parse_dsn</code></a></h3>
<pre>
  <span class="operator">(</span><span class="variable">$scheme</span><span class="operator">,</span> <span class="variable">$driver</span><span class="operator">,</span> <span class="variable">$attr_string</span><span class="operator">,</span> <span class="variable">$attr_hash</span><span class="operator">,</span> <span class="variable">$driver_dsn</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">parse_dsn</span><span class="operator">(</span><span class="variable">$dsn</span><span class="operator">)</span>
      <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Can't parse DBI DSN '</span><span class="variable">$dsn</span><span class="string">'"</span><span class="operator">;</span>
</pre>
<p>Breaks apart a DBI Data Source Name (DSN) and returns the individual
parts. If $dsn doesn't contain a valid DSN then <code>parse_dsn()</code> returns
an empty list.</p>
<p>$scheme is the first part of the DSN and is currently always 'dbi'.
$driver is the driver name, possibly defaulted to $ENV{DBI_DRIVER},
and may be undefined.  $attr_string is the contents of the optional attribute
string, which may be undefined.  If $attr_string is not empty then $attr_hash
is a reference to a hash containing the parsed attribute names and values.
$driver_dsn is the last part of the DBI DSN string. For example:</p>
<pre>
  <span class="operator">(</span><span class="variable">$scheme</span><span class="operator">,</span> <span class="variable">$driver</span><span class="operator">,</span> <span class="variable">$attr_string</span><span class="operator">,</span> <span class="variable">$attr_hash</span><span class="operator">,</span> <span class="variable">$driver_dsn</span><span class="operator">)</span>
      <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">parse_dsn</span><span class="operator">(</span><span class="string">"DBI:MyDriver(RaiseError=&gt;1):db=test;port=42"</span><span class="operator">);</span>
  <span class="variable">$scheme</span>      <span class="operator">=</span> <span class="string">'dbi'</span><span class="operator">;</span>
  <span class="variable">$driver</span>      <span class="operator">=</span> <span class="string">'MyDriver'</span><span class="operator">;</span>
  <span class="variable">$attr_string</span> <span class="operator">=</span> <span class="string">'RaiseError=&gt;1'</span><span class="operator">;</span>
  <span class="variable">$attr_hash</span>   <span class="operator">=</span> <span class="operator">{</span> <span class="string">'RaiseError'</span> <span class="operator">=&gt;</span> <span class="string">'1'</span> <span class="operator">}</span><span class="operator">;</span>
  <span class="variable">$driver_dsn</span>  <span class="operator">=</span> <span class="string">'db=test;port=42'</span><span class="operator">;</span>
</pre>
<p>The <code>parse_dsn()</code> method was added in DBI 1.43.</p>
<p>
</p>
<h3><a name="connect"><a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a></a></h3>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">)</span>
            <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$DBI::errstr</span><span class="operator">;</span>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">)</span>
            <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$DBI::errstr</span><span class="operator">;</span>
</pre>
<p>Establishes a database connection, or session, to the requested <code>$data_source</code>.
Returns a database handle object if the connection succeeds. Use
<code>$dbh-&gt;disconnect</code> to terminate the connection.</p>
<p>If the connect fails (see below), it returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> and sets both <code>$DBI::err</code>
and <code>$DBI::errstr</code>. (It does <em>not</em> explicitly set <a href="../lib/pods/perlvar.html#__"><code>$!</code></a>.) You should generally
test the return status of <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> and <code>print $DBI::errstr</code> if it has failed.</p>
<p>Multiple simultaneous connections to multiple databases through multiple
drivers can be made via the DBI. Simply make one <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> call for each
database and keep a copy of each returned database handle.</p>
<p>The <code>$data_source</code> value must begin with &quot;<code>dbi:</code><em>driver_name</em><code>:</code>&quot;.
The <em>driver_name</em> specifies the driver that will be used to make the
connection. (Letter case is significant.)</p>
<p>As a convenience, if the <code>$data_source</code> parameter is undefined or empty,
the DBI will substitute the value of the environment variable <code>DBI_DSN</code>.
If just the <em>driver_name</em> part is empty (i.e., the <code>$data_source</code>
prefix is &quot;<code>dbi::</code>&quot;), the environment variable <code>DBI_DRIVER</code> is
used. If neither variable is set, then <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> dies.</p>
<p>Examples of <code>$data_source</code> values are:</p>
<pre>
  <span class="variable">dbi</span><span class="operator">:</span><span class="variable">DriverName</span><span class="operator">:</span><span class="variable">database_name</span>
  <span class="variable">dbi</span><span class="operator">:</span><span class="variable">DriverName</span><span class="operator">:</span><span class="variable">database_name</span><span class="variable">@hostname</span><span class="operator">:</span><span class="variable">port</span>
  <span class="variable">dbi</span><span class="operator">:</span><span class="variable">DriverName</span><span class="operator">:</span><span class="variable">database</span><span class="operator">=</span><span class="variable">database_name</span><span class="operator">;</span><span class="variable">host</span><span class="operator">=</span><span class="variable">hostname</span><span class="operator">;</span><span class="variable">port</span><span class="operator">=</span><span class="variable">port</span>
</pre>
<p>There is <em>no standard</em> for the text following the driver name. Each
driver is free to use whatever syntax it wants. The only requirement the
DBI makes is that all the information is supplied in a single string.
You must consult the documentation for the drivers you are using for a
description of the syntax they require.</p>
<p>It is recommended that drivers support the ODBC style, shown in the
last example above. It is also recommended that that they support the
three common names '<code>host</code>', '<code>port</code>', and '<code>database</code>' (plus '<code>db</code>'
as an alias for <code>database</code>). This simplifies automatic construction
of basic DSNs: <code>&quot;dbi:$driver:database=$db;host=$host;port=$port&quot;</code>.
Drivers should aim to 'do something reasonable' when given a DSN
in this form, but if any part is meaningless for that driver (such
as 'port' for Informix) it should generate an error if that part
is not empty.</p>
<p>If the environment variable <code>DBI_AUTOPROXY</code> is defined (and the
driver in <code>$data_source</code> is not &quot;<code>Proxy</code>&quot;) then the connect request
will automatically be changed to:</p>
<pre>
  <span class="variable">$ENV</span><span class="operator">{</span><span class="string">DBI_AUTOPROXY</span><span class="operator">}</span><span class="operator">;</span><span class="variable">dsn</span><span class="operator">=</span><span class="variable">$data_source</span>
</pre>
<p><code>DBI_AUTOPROXY</code> is typically set as &quot;<code>dbi:Proxy:hostname=...;port=...</code>&quot;.
If $ENV{DBI_AUTOPROXY} doesn't begin with '<code>dbi:</code>' then &quot;dbi:Proxy:&quot;
will be prepended to it first.  See the DBD::Proxy documentation
for more details.</p>
<p>If <code>$username</code> or <code>$password</code> are undefined (rather than just empty),
then the DBI will substitute the values of the <code>DBI_USER</code> and <code>DBI_PASS</code>
environment variables, respectively.  The DBI will warn if the
environment variables are not defined.  However, the everyday use
of these environment variables is not recommended for security
reasons. The mechanism is primarily intended to simplify testing.
See below for alternative way to specify the username and password.</p>
<p><a href="../lib/pods/perlfunc.html#connect"><code>DBI-&gt;connect</code></a> automatically installs the driver if it has not been
installed yet. Driver installation either returns a valid driver
handle, or it <em>dies</em> with an error message that includes the string
&quot;<code>install_driver</code>&quot; and the underlying problem. So <a href="../lib/pods/perlfunc.html#connect"><code>DBI-&gt;connect</code></a>
will die
on a driver installation failure and will only return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> on a
connect failure, in which case <code>$DBI::errstr</code> will hold the error message.
Use <a href="../lib/pods/perlfunc.html#eval"><code>eval { ... }</code></a> if you need to catch the &quot;<code>install_driver</code>&quot; error.</p>
<p>The <code>$data_source</code> argument (with the &quot;<code>dbi:...:</code>&quot; prefix removed) and the
<code>$username</code> and <code>$password</code> arguments are then passed to the driver for
processing. The DBI does not define any interpretation for the
contents of these fields.  The driver is free to interpret the
<code>$data_source</code>, <code>$username</code>, and <code>$password</code> fields in any way, and supply
whatever defaults are appropriate for the engine being accessed.
(Oracle, for example, uses the ORACLE_SID and TWO_TASK environment
variables if no <code>$data_source</code> is specified.)</p>
<p>The <code>AutoCommit</code> and <code>PrintError</code> attributes for each connection
default to &quot;on&quot;. (See <a href="#autocommit">AutoCommit</a> and <a href="#printerror">PrintError</a> for more information.)
However, it is strongly recommended that you explicitly define <code>AutoCommit</code>
rather than rely on the default. The <code>PrintWarn</code> attribute defaults to
on if $^W is true, i.e., perl is running with warnings enabled.</p>
<p>The <code>\%attr</code> parameter can be used to alter the default settings of
<code>PrintError</code>, <code>RaiseError</code>, <code>AutoCommit</code>, and other attributes. For example:</p>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$pass</span><span class="operator">,</span> <span class="operator">{</span>
        <span class="string">PrintError</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>
        <span class="string">AutoCommit</span> <span class="operator">=&gt;</span> <span class="number">0</span>
  <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>The username and password can also be specified using the attributes
<code>Username</code> and <code>Password</code>, in which case they take precedence
over the <code>$username</code> and <code>$password</code> parameters.</p>
<p>You can also define connection attribute values within the <code>$data_source</code>
parameter. For example:</p>
<pre>
  dbi:DriverName(PrintWarn=&gt;1,PrintError=&gt;0,Taint=&gt;1):...</pre>
<p>Individual attributes values specified in this way take precedence over
any conflicting values specified via the <code>\%attr</code> parameter to <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a>.</p>
<p>The <code>dbi_connect_method</code> attribute can be used to specify which driver
method should be called to establish the connection. The only useful
values are 'connect', 'connect_cached', or some specialized case like
'Apache::DBI::connect' (which is automatically the default when running
within Apache).</p>
<p>Where possible, each session (<code>$dbh</code>) is independent from the transactions
in other sessions. This is useful when you need to hold cursors open
across transactions--for example, if you use one session for your long lifespan
cursors (typically read-only) and another for your short update
transactions.</p>
<p>For compatibility with old DBI scripts, the driver can be specified by
passing its name as the fourth argument to <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> (instead of <code>\%attr</code>):</p>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$pass</span><span class="operator">,</span> <span class="variable">$driver</span><span class="operator">);</span>
</pre>
<p>In this &quot;old-style&quot; form of <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a>, the <code>$data_source</code> should not start
with &quot;<code>dbi:driver_name:</code>&quot;. (If it does, the embedded driver_name
will be ignored). Also note that in this older form of <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a>,
the <code>$dbh-&gt;{AutoCommit}</code> attribute is <em>undefined</em>, the
<code>$dbh-&gt;{PrintError}</code> attribute is off, and the old <code>DBI_DBNAME</code>
environment variable is
checked if <code>DBI_DSN</code> is not defined. Beware that this &quot;old-style&quot;
<a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> will soon be withdrawn in a future version of DBI.</p>
<p>
</p>
<h3><a name="connect_cached"><code>connect_cached</code></a></h3>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect_cached</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">)</span>
            <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$DBI::errstr</span><span class="operator">;</span>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect_cached</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">)</span>
            <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$DBI::errstr</span><span class="operator">;</span>
</pre>
<p><code>connect_cached</code> is like <a href="../lib/pods/perlfunc.html#connect">connect</a>, except that the database handle
returned is also
stored in a hash associated with the given parameters. If another call
is made to <code>connect_cached</code> with the same parameter values, then the
corresponding cached <code>$dbh</code> will be returned if it is still valid.
The cached database handle is replaced with a new connection if it
has been disconnected or if the <code>ping</code> method fails.</p>
<p>That the behaviour of this method differs in several respects from the
behaviour of persistent connections implemented by Apache::DBI.
However, if Apache::DBI is loaded then <code>connect_cached</code> will use it.</p>
<p>Caching connections can be useful in some applications, but it can
also cause problems, such as too many connections, and so should
be used with care. In particular, avoid changing the attributes of
a database handle created via <code>connect_cached()</code> because it will affect
other code that may be using the same handle.</p>
<p>Where multiple separate parts of a program are using <code>connect_cached()</code>
to connect to the same database with the same (initial) attributes
it is a good idea to add a private attribute to the <code>connect_cached()</code>
call to effectively limit the scope of the caching. For example:</p>
<pre>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect_cached</span><span class="operator">(...,</span> <span class="operator">{</span> <span class="string">private_foo_cachekey</span> <span class="operator">=&gt;</span> <span class="string">"Bar"</span><span class="operator">,</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>Handles returned from that <code>connect_cached()</code> call will only be returned
by other <code>connect_cached()</code> call elsewhere in the code if those other
calls also pass in the same attribute values, including the private one.
(I've used <code>private_foo_cachekey</code> here as an example, you can use
any attribute name with a <code>private_</code> prefix.)</p>
<p>Taking that one step further, you can limit a particular <code>connect_cached()</code>
call to return handles unique to that one place in the code by setting the
private attribute to a unique value for that place:</p>
<pre>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect_cached</span><span class="operator">(...,</span> <span class="operator">{</span> <span class="string">private_foo_cachekey</span> <span class="operator">=&gt;</span> <span class="keyword">__FILE__</span><span class="operator">.</span><span class="keyword">__LINE__</span><span class="operator">,</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>By using a private attribute you still get connection caching for
the individual calls to <code>connect_cached()</code> but, by making separate
database conections for separate parts of the code, the database
handles are isolated from any attribute changes made to other handles.</p>
<p>The cache can be accessed (and cleared) via the <a href="#cachedkids">CachedKids</a> attribute:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$CachedKids_hashref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Driver</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">CachedKids</span><span class="operator">}</span><span class="operator">;</span>
  <span class="variable">%$CachedKids_hashref</span> <span class="operator">=</span> <span class="operator">()</span> <span class="keyword">if</span> <span class="variable">$CachedKids_hashref</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="available_drivers"><code>available_drivers</code></a></h3>
<pre>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">available_drivers</span><span class="operator">;</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">available_drivers</span><span class="operator">(</span><span class="variable">$quiet</span><span class="operator">);</span>
</pre>
<p>Returns a list of all available drivers by searching for <code>DBD::*</code> modules
through the directories in <a href="../lib/pods/perlvar.html#_inc"><code>@INC</code></a>. By default, a warning is given if
some drivers are hidden by others of the same name in earlier
directories. Passing a true value for <code>$quiet</code> will inhibit the warning.</p>
<p>
</p>
<h3><a name="installed_drivers"><code>installed_drivers</code></a></h3>
<pre>
  <span class="variable">%drivers</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_drivers</span><span class="operator">();</span>
</pre>
<p>Returns a list of driver name and driver handle pairs for all drivers
'installed' (loaded) into the current process.  The driver name does not
include the 'DBD::' prefix.</p>
<p>To get a list of all drivers available in your perl instalation you can use
<a href="#available_drivers">available_drivers</a>.</p>
<p>Added in DBI 1.49.</p>
<p>
</p>
<h3><a name="installed_versions"><code>installed_versions</code></a></h3>
<pre>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_versions</span><span class="operator">;</span>
  <span class="variable">@ary</span>  <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_versions</span><span class="operator">;</span>
  <span class="variable">%hash</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_versions</span><span class="operator">;</span>
</pre>
<p>Calls <code>available_drivers()</code> and attempts to load each of them in turn
using <code>install_driver()</code>.  For each load that succeeds the driver
name and version number are added to a hash. When running under
<a href="../lib/DBI/PurePerl.html">the DBI::PurePerl manpage</a> drivers which appear not be pure-perl are ignored.</p>
<p>When called in array context the list of successfully loaded drivers
is returned (without the 'DBD::' prefix).</p>
<p>When called in scalar context a reference to the hash is returned
and the hash will also contain other entries for the <code>DBI</code> version,
<code>OS</code> name, etc.</p>
<p>When called in a void context the <code>installed_versions()</code> method will
print out a formatted list of the hash contents, one per line.</p>
<p>Due to the potentially high memory cost and unknown risks of loading
in an unknown number of drivers that just happen to be installed
on the system, this method is not recommended for general use.
Use <code>available_drivers()</code> instead.</p>
<p>The <code>installed_versions()</code> method is primarily intended as a quick
way to see from the command line what's installed. For example:</p>
<pre>
  perl -MDBI -e 'DBI-&gt;installed_versions'</pre>
<p>The <code>installed_versions()</code> method was added in DBI 1.38.</p>
<p>
</p>
<h3><a name="data_sources"><code>data_sources</code></a></h3>
<pre>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">);</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(</span><span class="variable">$driver</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<p>Returns a list of data sources (databases) available via the named
driver.  If <code>$driver</code> is empty or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>, then the value of the
<code>DBI_DRIVER</code> environment variable is used.</p>
<p>The driver will be loaded if it hasn't been already. Note that if the
driver loading fails then <code>data_sources()</code> <em>dies</em> with an error message
that includes the string &quot;<code>install_driver</code>&quot; and the underlying problem.</p>
<p>Data sources are returned in a form suitable for passing to the
<a href="../lib/pods/perlfunc.html#connect">connect</a> method (that is, they will include the &quot;<code>dbi:$driver:</code>&quot; prefix).</p>
<p>Note that many drivers have no way of knowing what data sources might
be available for it. These drivers return an empty or incomplete list
or may require driver-specific attributes.</p>
<p>There is also a <code>data_sources()</code> method defined for database handles.</p>
<p>
</p>
<h3><a name="trace"><code>trace</code></a></h3>
<pre>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="variable">$trace_setting</span><span class="operator">)</span>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="variable">$trace_setting</span><span class="operator">,</span> <span class="variable">$trace_filename</span><span class="operator">)</span>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="variable">$trace_setting</span><span class="operator">,</span> <span class="variable">$trace_filehandle</span><span class="operator">)</span>
  <span class="variable">$trace_setting</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">;</span>
</pre>
<p>The <code>DBI-&gt;trace</code> method sets the <em>global default</em> trace
settings and returns the <em>previous</em> trace settings. It can also
be used to change where the trace output is sent.</p>
<p>There's a similar method, <code>$h-&gt;trace</code>, which sets the trace
settings for the specific handle it's called on.</p>
<p>See the <a href="#tracing">TRACING</a> section for full details about the DBI's powerful
tracing facilities.</p>
<p>
</p>
<h2><a name="dbi_utility_functions">DBI Utility Functions</a></h2>
<p>In addition to the DBI methods listed in the previous section,
the DBI package also provides several utility functions.</p>
<p>These can be imported into your code by listing them in
the <a href="../lib/pods/perlfunc.html#use"><code>use</code></a> statement. For example:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(neat data_diff)</span><span class="operator">;</span>
</pre>
<p>Alternatively, all these utility functions (except hash) can be
imported using the <code>:utils</code> import tag. For example:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(:utils)</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="data_string_desc"><code>data_string_desc</code></a></h3>
<pre>
  <span class="variable">$description</span> <span class="operator">=</span> <span class="variable">data_string_desc</span><span class="operator">(</span><span class="variable">$string</span><span class="operator">);</span>
</pre>
<p>Returns an informal description of the string. For example:</p>
<pre>
  UTF8 off, ASCII, 42 characters 42 bytes
  UTF8 off, non-ASCII, 42 characters 42 bytes
  UTF8 on, non-ASCII, 4 characters 6 bytes
  UTF8 on but INVALID encoding, non-ASCII, 4 characters 6 bytes
  UTF8 off, undef</pre>
<p>The initial <code>UTF8</code> on/off refers to Perl's internal SvUTF8 flag.
If $string has the SvUTF8 flag set but the sequence of bytes it
contains are not a valid UTF-8 encoding then <code>data_string_desc()</code>
will report <code>UTF8 on but INVALID encoding</code>.</p>
<p>The <code>ASCII</code> vs <code>non-ASCII</code> portion shows <code>ASCII</code> if <em>all</em> the
characters in the string are ASCII (have code points &lt;= 127).</p>
<p>The <code>data_string_desc()</code> function was added in DBI 1.46.</p>
<p>
</p>
<h3><a name="data_string_diff"><code>data_string_diff</code></a></h3>
<pre>
  <span class="variable">$diff</span> <span class="operator">=</span> <span class="variable">data_string_diff</span><span class="operator">(</span><span class="variable">$a</span><span class="operator">,</span> <span class="variable">$b</span><span class="operator">);</span>
</pre>
<p>Returns an informal description of the first character difference
between the strings. If both $a and $b contain the same sequence
of characters then <code>data_string_diff()</code> returns an empty string.
For example:</p>
<pre>
 Params a &amp; b     Result
 ------------     ------
 'aaa', 'aaa'     ''
 'aaa', 'abc'     'Strings differ at index 2: a[2]=a, b[2]=b'
 'aaa', undef     'String b is undef, string a has 3 characters'
 'aaa', 'aa'      'String b truncated after 2 characters'</pre>
<p>Unicode characters are reported in <code>\x{XXXX}</code> format. Unicode
code points in the range U+0800 to U+08FF are unassigned and most
likely to occur due to double-encoding. Characters in this range
are reported as <code>\x{08XX}='C'</code> where <code>C</code> is the corresponding
latin-1 character.</p>
<p>The <code>data_string_diff()</code> function only considers logical <em>characters</em>
and not the underlying encoding. See <a href="#data_diff">data_diff</a> for an alternative.</p>
<p>The <code>data_string_diff()</code> function was added in DBI 1.46.</p>
<p>
</p>
<h3><a name="data_diff"><code>data_diff</code></a></h3>
<pre>
  <span class="variable">$diff</span> <span class="operator">=</span> <span class="variable">data_diff</span><span class="operator">(</span><span class="variable">$a</span><span class="operator">,</span> <span class="variable">$b</span><span class="operator">);</span>
  <span class="variable">$diff</span> <span class="operator">=</span> <span class="variable">data_diff</span><span class="operator">(</span><span class="variable">$a</span><span class="operator">,</span> <span class="variable">$b</span><span class="operator">,</span> <span class="variable">$logical</span><span class="operator">);</span>
</pre>
<p>Returns an informal description of the difference between two strings.
It calls <a href="#data_string_desc">data_string_desc</a> and <a href="#data_string_diff">data_string_diff</a>
and returns the combined results as a multi-line string.</p>
<p>For example, <code>data_diff(&quot;abc&quot;, &quot;ab\x{263a}&quot;)</code> will return:</p>
<pre>
  <span class="variable">a</span><span class="operator">:</span> <span class="variable">UTF8</span> <span class="variable">off</span><span class="operator">,</span> <span class="variable">ASCII</span><span class="operator">,</span> <span class="number">3</span> <span class="variable">characters</span> <span class="number">3</span> <span class="variable">bytes</span>
  <span class="variable">b</span><span class="operator">:</span> <span class="variable">UTF8</span> <span class="variable">on</span><span class="operator">,</span> <span class="variable">non</span><span class="operator">-</span><span class="variable">ASCII</span><span class="operator">,</span> <span class="number">3</span> <span class="variable">characters</span> <span class="number">5</span> <span class="variable">bytes</span>
  <span class="variable">Strings</span> <span class="variable">differ</span> <span class="variable">at</span> <span class="keyword">index</span> <span class="number">2</span><span class="operator">:</span> <span class="variable">a</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span><span class="operator">=</span><span class="variable">c</span><span class="operator">,</span> <span class="variable">b</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span><span class="operator">=\x</span><span class="operator">{</span><span class="string">263A</span><span class="operator">}</span>
</pre>
<p>If $a and $b are identical in both the characters they contain <em>and</em>
their physical encoding then <code>data_diff()</code> returns an empty string.
If $logical is true then physical encoding differences are ignored
(but are still reported if there is a difference in the characters).</p>
<p>The <code>data_diff()</code> function was added in DBI 1.46.</p>
<p>
</p>
<h3><a name="neat"><code>neat</code></a></h3>
<pre>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">neat</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">);</span>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">neat</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">,</span> <span class="variable">$maxlen</span><span class="operator">);</span>
</pre>
<p>Return a string containing a neat (and tidy) representation of the
supplied value.</p>
<p>Strings will be quoted, although internal quotes will <em>not</em> be escaped.
Values known to be numeric will be unquoted. Undefined (NULL) values
will be shown as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> (without quotes).</p>
<p>If the string is flagged internally as utf8 then double quotes will
be used, otherwise single quotes are used and unprintable characters
will be replaced by dot (.).</p>
<p>For result strings longer than <code>$maxlen</code> the result string will be
truncated to <code>$maxlen-4</code> and &quot;<code>...'</code>&quot; will be appended.  If <code>$maxlen</code> is 0
or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>, it defaults to <code>$DBI::neat_maxlen</code> which, in turn, defaults to 400.</p>
<p>This function is designed to format values for human consumption.
It is used internally by the DBI for <a href="#trace">trace</a> output. It should
typically <em>not</em> be used for formatting values for database use.
(See also <a href="#quote">quote</a>.)</p>
<p>
</p>
<h3><a name="neat_list"><code>neat_list</code></a></h3>
<pre>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">neat_list</span><span class="operator">(\</span><span class="variable">@listref</span><span class="operator">,</span> <span class="variable">$maxlen</span><span class="operator">,</span> <span class="variable">$field_sep</span><span class="operator">);</span>
</pre>
<p>Calls <code>neat</code> on each element of the list and returns a string
containing the results joined with <code>$field_sep</code>. <code>$field_sep</code> defaults
to <code>&quot;, &quot;</code>.</p>
<p>
</p>
<h3><a name="looks_like_number"><code>looks_like_number</code></a></h3>
<pre>
  <span class="variable">@bool</span> <span class="operator">=</span> <span class="variable">looks_like_number</span><span class="operator">(</span><span class="variable">@array</span><span class="operator">);</span>
</pre>
<p>Returns true for each element that looks like a number.
Returns false for each element that does not look like a number.
Returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> for each element that is undefined or empty.</p>
<p>
</p>
<h3><a name="hash"><code>hash</code></a></h3>
<pre>
  <span class="variable">$hash_value</span> <span class="operator">=</span> <span class="variable">DBI::hash</span><span class="operator">(</span><span class="variable">$buffer</span><span class="operator">,</span> <span class="variable">$type</span><span class="operator">);</span>
</pre>
<p>Return a 32-bit integer 'hash' value corresponding to the contents of $buffer.
The $type parameter selects which kind of hash algorithm should be used.</p>
<p>For the technically curious, type 0 (which is the default if $type
isn't specified) is based on the Perl 5.1 hash except that the value
is forced to be negative (for obscure historical reasons).
Type 1 is the better &quot;Fowler / Noll / Vo&quot; (FNV) hash. See
<a href="http://www.isthe.com/chongo/tech/comp/fnv/">http://www.isthe.com/chongo/tech/comp/fnv/</a> for more information.
Both types are implemented in C and are very fast.</p>
<p>This function doesn't have much to do with databases, except that
it can be handy to store hash values in a database.</p>
<p>
</p>
<h2><a name="dbi_dynamic_attributes">DBI Dynamic Attributes</a></h2>
<p>Dynamic attributes are always associated with the <em>last handle used</em>
(that handle is represented by <code>$h</code> in the descriptions below).</p>
<p>Where an attribute is equivalent to a method call, then refer to
the method call for all related documentation.</p>
<p>Warning: these attributes are provided as a convenience but they
do have limitations. Specifically, they have a short lifespan:
because they are associated with
the last handle used, they should only be used <em>immediately</em> after
calling the method that &quot;sets&quot; them.
If in any doubt, use the corresponding method call.</p>
<p>
</p>
<h3><a name="_dbi__err"><code>$DBI::err</code></a></h3>
<p>Equivalent to <code>$h-&gt;err</code>.</p>
<p>
</p>
<h3><a name="_dbi__errstr"><code>$DBI::errstr</code></a></h3>
<p>Equivalent to <code>$h-&gt;errstr</code>.</p>
<p>
</p>
<h3><a name="_dbi__state"><code>$DBI::state</code></a></h3>
<p>Equivalent to <a href="../lib/pods/perlfunc.html#state"><code>$h-&gt;state</code></a>.</p>
<p>
</p>
<h3><a name="_dbi__rows"><code>$DBI::rows</code></a></h3>
<p>Equivalent to <code>$h-&gt;rows</code>. Please refer to the documentation
for the <a href="#rows">rows</a> method.</p>
<p>
</p>
<h3><a name="_dbi__lasth"><code>$DBI::lasth</code></a></h3>
<p>Returns the DBI object handle used for the most recent DBI method call.
If the last DBI method call was a DESTROY then $DBI::lasth will return
the handle of the parent of the destroyed handle, if there is one.</p>
<p>
</p>
<hr />
<h1><a name="methods_common_to_all_handles">METHODS COMMON TO ALL HANDLES</a></h1>
<p>The following methods can be used by all types of DBI handles.</p>
<p>
</p>
<h3><a name="err"><code>err</code></a></h3>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">err</span><span class="operator">;</span>
</pre>
<p>Returns the <em>native</em> database engine error code from the last driver
method called. The code is typically an integer but you should not
assume that.</p>
<p>The DBI resets $h-&gt;err to undef before almost all DBI method calls, so the
value only has a short lifespan. Also, for most drivers, the statement
handles share the same error variable as the parent database handle,
so calling a method on one handle may reset the error on the
related handles.</p>
<p>(Methods which don't reset err before being called include <code>err()</code> and <code>errstr()</code>,
obviously, <a href="../lib/pods/perlfunc.html#state"><code>state()</code></a>, <code>rows()</code>, <code>func()</code>, <code>trace()</code>, <code>trace_msg()</code>, <code>ping()</code>, and the
tied hash attribute <code>FETCH()</code> and <code>STORE()</code> methods.)</p>
<p>If you need to test for specific error conditions <em>and</em> have your program be
portable to different database engines, then you'll need to determine what the
corresponding error codes are for all those engines and test for all of them.</p>
<p>The DBI uses the value of $DBI::stderr as the <code>err</code> value for internal errors.
Drivers should also do likewise.  The default value for $DBI::stderr is 2000000000.</p>
<p>A driver may return <code>0</code> from <code>err()</code> to indicate a warning condition
after a method call. Similarly, a driver may return an empty string
to indicate a 'success with information' condition. In both these
cases the value is false but not undef. The <code>errstr()</code> and <a href="../lib/pods/perlfunc.html#state"><code>state()</code></a>
methods may be used to retrieve extra information in these cases.</p>
<p>See <a href="#set_err">set_err</a> for more information.</p>
<p>
</p>
<h3><a name="errstr"><code>errstr</code></a></h3>
<pre>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Returns the native database engine error message from the last DBI
method called. This has the same lifespan issues as the <a href="#err">err</a> method
described above.</p>
<p>The returned string may contain multiple messages separated by
newline characters.</p>
<p>The <code>errstr()</code> method should not be used to test for errors, use <code>err()</code>
for that, because drivers may return 'success with information' or
warning messages via <code>errstr()</code> for methods that have not 'failed'.</p>
<p>See <a href="#set_err">set_err</a> for more information.</p>
<p>
</p>
<h3><a name="state"><a href="../lib/pods/perlfunc.html#state"><code>state</code></a></a></h3>
<pre>
  <span class="variable">$str</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">state</span><span class="operator">;</span>
</pre>
<p>Returns a state code in the standard SQLSTATE five character format.
Note that the specific success code <code>00000</code> is translated to any empty string
(false). If the driver does not support SQLSTATE (and most don't),
then <a href="../lib/pods/perlfunc.html#state"><code>state()</code></a> will return <code>S1000</code> (General Error) for all errors.</p>
<p>The driver is free to return any value via <a href="../lib/pods/perlfunc.html#state"><code>state</code></a>, e.g., warning
codes, even if it has not declared an error by returning a true value
via the <a href="#err">err</a> method described above.</p>
<p>The <a href="../lib/pods/perlfunc.html#state"><code>state()</code></a> method should not be used to test for errors, use <code>err()</code>
for that, because drivers may return a 'success with information' or
warning state code via <a href="../lib/pods/perlfunc.html#state"><code>state()</code></a> for methods that have not 'failed'.</p>
<p>
</p>
<h3><a name="set_err"><code>set_err</code></a></h3>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="variable">$err</span><span class="operator">,</span> <span class="variable">$errstr</span><span class="operator">);</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="variable">$err</span><span class="operator">,</span> <span class="variable">$errstr</span><span class="operator">,</span> <span class="variable">$state</span><span class="operator">);</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="variable">$err</span><span class="operator">,</span> <span class="variable">$errstr</span><span class="operator">,</span> <span class="variable">$state</span><span class="operator">,</span> <span class="variable">$method</span><span class="operator">);</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="variable">$err</span><span class="operator">,</span> <span class="variable">$errstr</span><span class="operator">,</span> <span class="variable">$state</span><span class="operator">,</span> <span class="variable">$method</span><span class="operator">,</span> <span class="variable">$rv</span><span class="operator">);</span>
</pre>
<p>Set the <code>err</code>, <code>errstr</code>, and <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> values for the handle.
This method is typically only used by DBI drivers and DBI subclasses.</p>
<p>If the <a href="#handleseterr">HandleSetErr</a> attribute holds a reference to a subroutine
it is called first. The subroutine can alter the $err, $errstr, $state,
and $method values. See <a href="#handleseterr">HandleSetErr</a> for full details.
If the subroutine returns a true value then the handle <code>err</code>,
<code>errstr</code>, and <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> values are not altered and <code>set_err()</code> returns
an empty list (it normally returns $rv which defaults to undef, see below).</p>
<p>Setting <code>err</code> to a <em>true</em> value indicates an error and will trigger
the normal DBI error handling mechanisms, such as <code>RaiseError</code> and
<code>HandleError</code>, if they are enabled, when execution returns from
the DBI back to the application.</p>
<p>Setting <code>err</code> to <code>&quot;&quot;</code> indicates an 'information' state, and setting
it to <code>&quot;0&quot;</code> indicates a 'warning' state. Setting <code>err</code> to <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>
also sets <code>errstr</code> to undef, and <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> to <code>&quot;&quot;</code>, irrespective
of the values of the $errstr and $state parameters.</p>
<p>The $method parameter provides an alternate method name for the
<code>RaiseError</code>/<code>PrintError</code>/<code>PrintWarn</code> error string instead of
the fairly unhelpful '<code>set_err</code>'.</p>
<p>The <code>set_err</code> method normally returns undef.  The $rv parameter
provides an alternate return value.</p>
<p>Some special rules apply if the <code>err</code> or <code>errstr</code>
values for the handle are <em>already</em> set...</p>
<p>If <code>errstr</code> is true then: &quot;<code> [err was %s now %s]</code>&quot; is appended if $err is
true and <code>err</code> is already true and the new err value differs from the original
one. Similarly &quot;<code> [state was %s now %s]</code>&quot; is appended if $state is true and <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> is
already true and the new state value differs from the original one. Finally
&quot;<a href="../lib/pods/perlrun.html#n"><code>\n</code></a>&quot; and the new $errstr are appended if $errstr differs from the existing
errstr value. Obviously the <code>%s</code>'s above are replaced by the corresponding values.</p>
<p>The handle <code>err</code> value is set to $err if: $err is true; or handle
<code>err</code> value is undef; or $err is defined and the length is greater
than the handle <code>err</code> length. The effect is that an 'information'
state only overrides undef; a 'warning' overrides undef or 'information',
and an 'error' state overrides anything.</p>
<p>The handle <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> value is set to $state if $state is true and
the handle <code>err</code> value was set (by the rules above).</p>
<p>Support for warning and information states was added in DBI 1.41.</p>
<p>
</p>
<h3><a name="trace"><code>trace</code></a></h3>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="variable">$trace_settings</span><span class="operator">);</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="variable">$trace_settings</span><span class="operator">,</span> <span class="variable">$trace_filename</span><span class="operator">);</span>
  <span class="variable">$trace_settings</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">;</span>
</pre>
<p>The <code>trace()</code> method is used to alter the trace settings for a handle
(and any future children of that handle).  It can also be used to
change where the trace output is sent.</p>
<p>There's a similar method, <code>DBI-&gt;trace</code>, which sets the global
default trace settings.</p>
<p>See the <a href="#tracing">TRACING</a> section for full details about the DBI's powerful
tracing facilities.</p>
<p>
</p>
<h3><a name="trace_msg"><code>trace_msg</code></a></h3>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">trace_msg</span><span class="operator">(</span><span class="variable">$message_text</span><span class="operator">);</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">trace_msg</span><span class="operator">(</span><span class="variable">$message_text</span><span class="operator">,</span> <span class="variable">$min_level</span><span class="operator">);</span>
</pre>
<p>Writes <code>$message_text</code> to the trace file if the trace level is
greater than or equal to $min_level (which defaults to 1).
Can also be called as <code>DBI-&gt;trace_msg($msg)</code>.</p>
<p>See <a href="#tracing">TRACING</a> for more details.</p>
<p>
</p>
<h3><a name="func"><code>func</code></a></h3>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">func</span><span class="operator">(</span><span class="variable">@func_arguments</span><span class="operator">,</span> <span class="variable">$func_name</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="operator">...;</span>
</pre>
<p>The <code>func</code> method can be used to call private non-standard and
non-portable methods implemented by the driver. Note that the function
name is given as the <em>last</em> argument.</p>
<p>It's also important to note that the <code>func()</code> method does not clear
a previous error ($DBI::err etc.) and it does not trigger automatic
error detection (RaiseError etc.) so you must check the return
status and/or $h-&gt;err to detect errors.</p>
<p>(This method is not directly related to calling stored procedures.
Calling stored procedures is currently not defined by the DBI.
Some drivers, such as DBD::Oracle, support it in non-portable ways.
See driver documentation for more details.)</p>
<p>See also <code>install_method()</code> in <a href="../lib/DBI/DBD.html">the DBI::DBD manpage</a> for how you can avoid needing to
use <code>func()</code> and gain direct access to driver-private methods.</p>
<p>
</p>
<h3><a name="can"><code>can</code></a></h3>
<pre>
  <span class="variable">$is_implemented</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">can</span><span class="operator">(</span><span class="variable">$method_name</span><span class="operator">);</span>
</pre>
<p>Returns true if $method_name is implemented by the driver or a
default method is provided by the DBI.
It returns false where a driver hasn't implemented a method and the
default method is provided by the DBI is just an empty stub.</p>
<p>
</p>
<h3><a name="parse_trace_flags"><code>parse_trace_flags</code></a></h3>
<pre>
  <span class="variable">$trace_settings_integer</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">parse_trace_flags</span><span class="operator">(</span><span class="variable">$trace_settings</span><span class="operator">);</span>
</pre>
<p>Parses a string containing trace settings and returns the corresponding
integer value used internally by the DBI and drivers.</p>
<p>The $trace_settings argument is a string containing a trace level
between 0 and 15 and/or trace flag names separated by vertical bar
(&quot;<code>|</code>&quot;) or comma (&quot;<code>,</code>&quot;) characters. For example: <code>&quot;SQL|3|foo&quot;</code>.</p>
<p>It uses the <code>parse_trace_flag()</code> method, described below, to process
the individual trage flag names.</p>
<p>The <code>parse_trace_flags()</code> method was added in DBI 1.42.</p>
<p>
</p>
<h3><a name="parse_trace_flag"><code>parse_trace_flag</code></a></h3>
<pre>
  <span class="variable">$bit_flag</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">parse_trace_flag</span><span class="operator">(</span><span class="variable">$trace_flag_name</span><span class="operator">);</span>
</pre>
<p>Returns the bit flag corresponding to the trace flag name in
$trace_flag_name.  Drivers are expected to override this method and
check if $trace_flag_name is a driver specific trace flags and, if
not, then call the DBIs default <code>parse_trace_flag()</code>.</p>
<p>The <code>parse_trace_flag()</code> method was added in DBI 1.42.</p>
<p>
</p>
<h3><a name="private_attribute_info"><code>private_attribute_info</code></a></h3>
<pre>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">private_attribute_info</span><span class="operator">();</span>
</pre>
<p>Returns a reference to a hash whose keys are the names of driver-private
attributes available for the kind of handle (driver, database, statement)
that the method was called on.</p>
<p>For example, the return value when called with a DBD::Sybase $dbh could look like this:</p>
<pre>
  <span class="operator">{</span>
      <span class="string">syb_dynamic_supported</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
      <span class="string">syb_oc_version</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
      <span class="string">syb_server_version</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
      <span class="string">syb_server_version_string</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
  <span class="operator">}</span>
</pre>
<p>and when called with a DBD::Sybase $sth they could look like this:</p>
<pre>
  <span class="operator">{</span>
      <span class="string">syb_types</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
      <span class="string">syb_proc_status</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
      <span class="string">syb_result_type</span> <span class="operator">=&gt;</span> <span class="keyword">undef</span><span class="operator">,</span>
  <span class="operator">}</span>
</pre>
<p>The values should be undef. Meanings may be assigned to particular values in future.</p>
<p>
</p>
<h3><a name="swap_inner_handle"><code>swap_inner_handle</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$h1</span><span class="operator">-&gt;</span><span class="variable">swap_inner_handle</span><span class="operator">(</span> <span class="variable">$h2</span> <span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$h1</span><span class="operator">-&gt;</span><span class="variable">swap_inner_handle</span><span class="operator">(</span> <span class="variable">$h2</span><span class="operator">,</span> <span class="variable">$allow_reparent</span> <span class="operator">);</span>
</pre>
<p>Brain transplants for handles. You don't need to know about this
unless you want to become a handle surgeon.</p>
<p>A DBI handle is a reference to a tied hash. A tied hash has an
<em>inner</em> hash that actually holds the contents.  The <code>swap_inner_handle()</code>
method swaps the inner hashes between two handles. The $h1 and $h2
handles still point to the same tied hashes, but what those hashes
are tied to has been swapped.  In effect $h1 <em>becomes</em> $h2 and
vice-versa. This is powerful stuff, expect problems. Use with care.</p>
<p>As a small safety measure, the two handles, $h1 and $h2, have to
share the same parent unless $allow_reparent is true.</p>
<p>The <code>swap_inner_handle()</code> method was added in DBI 1.44.</p>
<p>Here's a quick kind of 'diagram' as a worked example to help think about what's
happening:</p>
<pre>
    Original state:
            dbh1o -&gt; dbh1i
            sthAo -&gt; sthAi(dbh1i)
            dbh2o -&gt; dbh2i</pre>
<pre>
    swap_inner_handle dbh1o with dbh2o:
            dbh2o -&gt; dbh1i
            sthAo -&gt; sthAi(dbh1i)
            dbh1o -&gt; dbh2i</pre>
<pre>
    create new sth from dbh1o:
            dbh2o -&gt; dbh1i
            sthAo -&gt; sthAi(dbh1i)
            dbh1o -&gt; dbh2i
            sthBo -&gt; sthBi(dbh2i)</pre>
<pre>
    swap_inner_handle sthAo with sthBo:
            dbh2o -&gt; dbh1i
            sthBo -&gt; sthAi(dbh1i)
            dbh1o -&gt; dbh2i
            sthAo -&gt; sthBi(dbh2i)</pre>
<p>
</p>
<hr />
<h1><a name="attributes_common_to_all_handles">ATTRIBUTES COMMON TO ALL HANDLES</a></h1>
<p>These attributes are common to all types of DBI handles.</p>
<p>Some attributes are inherited by child handles. That is, the value
of an inherited attribute in a newly created statement handle is the
same as the value in the parent database handle. Changes to attributes
in the new statement handle do not affect the parent database handle
and changes to the database handle do not affect existing statement
handles, only future ones.</p>
<p>Attempting to set or get the value of an unknown attribute generates a warning,
except for private driver specific attributes (which all have names
starting with a lowercase letter).</p>
<p>Example:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AttributeName</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">...;</span>    <span class="comment"># set/write</span>
  <span class="operator">...</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AttributeName</span><span class="operator">}</span><span class="operator">;</span>    <span class="comment"># get/read</span>
</pre>
<p>
</p>
<h3><a name="warn__boolean__inherited_"><code>Warn</code> (boolean, inherited)</a></h3>
<p>The <code>Warn</code> attribute enables useful warnings for certain bad
practices. It is enabled by default and should only be disabled in
rare circumstances.  Since warnings are generated using the Perl
<a href="../lib/pods/perlfunc.html#warn"><code>warn</code></a> function, they can be intercepted using the Perl <code>$SIG{__WARN__}</code>
hook.</p>
<p>The <code>Warn</code> attribute is not related to the <code>PrintWarn</code> attribute.</p>
<p>
</p>
<h3><a name="active__boolean__read_only_"><code>Active</code> (boolean, read-only)</a></h3>
<p>The <code>Active</code> attribute is true if the handle object is &quot;active&quot;. This is rarely used in
applications. The exact meaning of active is somewhat vague at the
moment. For a database handle it typically means that the handle is
connected to a database (<code>$dbh-&gt;disconnect</code> sets <code>Active</code> off).  For
a statement handle it typically means that the handle is a <code>SELECT</code>
that may have more data to fetch. (Fetching all the data or calling <a href="#finish"><code>$sth-&gt;finish</code></a>
sets <code>Active</code> off.)</p>
<p>
</p>
<h3><a name="executed__boolean_"><code>Executed</code> (boolean)</a></h3>
<p>The <code>Executed</code> attribute is true if the handle object has been &quot;executed&quot;.
Currently only the $dbh <a href="../lib/pods/perlfunc.html#do"><code>do()</code></a> method and the $sth <code>execute()</code>, <code>execute_array()</code>,
and <code>execute_for_fetch()</code> methods set the <code>Executed</code> attribute.</p>
<p>When it's set on a handle it is also set on the parent handle at the
same time. So calling <code>execute()</code> on a $sth also sets the <code>Executed</code>
attribute on the parent $dbh.</p>
<p>The <code>Executed</code> attribute for a database handle is cleared by the <code>commit()</code> and
<code>rollback()</code> methods (even if they fail). The <code>Executed</code> attribute of a
statement handle is not cleared by the DBI under any circumstances and so acts
as a permanent record of whether the statement handle was ever used.</p>
<p>The <code>Executed</code> attribute was added in DBI 1.41.</p>
<p>
</p>
<h3><a name="kids__integer__read_only_"><code>Kids</code> (integer, read-only)</a></h3>
<p>For a driver handle, <code>Kids</code> is the number of currently existing database
handles that were created from that driver handle.  For a database
handle, <code>Kids</code> is the number of currently existing statement handles that
were created from that database handle.
For a statement handle, the value is zero.</p>
<p>
</p>
<h3><a name="activekids__integer__read_only_"><code>ActiveKids</code> (integer, read-only)</a></h3>
<p>Like <code>Kids</code>, but only counting those that are <code>Active</code> (as above).</p>
<p>
</p>
<h3><a name="cachedkids__hash_ref_"><code>CachedKids</code> (hash ref)</a></h3>
<p>For a database handle, <code>CachedKids</code> returns a reference to the cache (hash) of
statement handles created by the <a href="#prepare_cached">prepare_cached</a> method.  For a
driver handle, returns a reference to the cache (hash) of
database handles created by the <a href="#connect_cached">connect_cached</a> method.</p>
<p>
</p>
<h3><a name="type__scalar__read_only_"><code>Type</code> (scalar, read-only)</a></h3>
<p>The <code>Type</code> attribute identifies the type of a DBI handle.  Returns
&quot;dr&quot; for driver handles, &quot;db&quot; for database handles and &quot;st&quot; for
statement handles.</p>
<p>
</p>
<h3><a name="childhandles__array_ref_"><code>ChildHandles</code> (array ref)</a></h3>
<p>The ChildHandles attribute contains a reference to an array of all the
handles created by this handle which are still accessible.  The
contents of the array are weak-refs and will become undef when the
handle goes out of scope.</p>
<p><code>ChildHandles</code> returns undef if your perl version does not support weak
references (check the <a href="../lib/Scalar/Util.html">Scalar::Util</a> module).  The referenced
array returned should be treated as read-only.</p>
<p>For example, to enumerate all driver handles, database handles and
statement handles:</p>
<pre>
    <span class="keyword">sub</span><span class="variable"> show_child_handles </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$h</span><span class="operator">,</span> <span class="variable">$level</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
        <span class="keyword">printf</span> <span class="string">"%sh %s %s\n"</span><span class="operator">,</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Type</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\t"</span> <span class="operator">x</span> <span class="variable">$level</span><span class="operator">,</span> <span class="variable">$h</span><span class="operator">;</span>
        <span class="variable">show_child_handles</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">,</span> <span class="variable">$level</span> <span class="operator">+</span> <span class="number">1</span><span class="operator">)</span>
            <span class="keyword">for</span> <span class="operator">(</span><span class="keyword">grep</span> <span class="operator">{</span> <span class="keyword">defined</span> <span class="operator">}</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ChildHandles</span><span class="operator">}}</span><span class="operator">);</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">my</span> <span class="variable">%drivers</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">installed_drivers</span><span class="operator">();</span>
    <span class="variable">show_child_handles</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">,</span> <span class="number">0</span><span class="operator">)</span> <span class="keyword">for</span> <span class="operator">(</span><span class="keyword">values</span> <span class="variable">%drivers</span><span class="operator">);</span>
</pre>
<p>
</p>
<h3><a name="compatmode__boolean__inherited_"><code>CompatMode</code> (boolean, inherited)</a></h3>
<p>The <code>CompatMode</code> attribute is used by emulation layers (such as
Oraperl) to enable compatible behaviour in the underlying driver
(e.g., DBD::Oracle) for this handle. Not normally set by application code.</p>
<p>It also has the effect of disabling the 'quick FETCH' of attribute
values from the handles attribute cache. So all attribute values
are handled by the drivers own FETCH method. This makes them slightly
slower but is useful for special-purpose drivers like DBD::Multiplex.</p>
<p>
</p>
<h3><a name="inactivedestroy__boolean_"><code>InactiveDestroy</code> (boolean)</a></h3>
<p>The default value, false, means a handle will be fully destroyed
as normal when the last reference to it is removed, just as you'd expect.</p>
<p>If set true then the handle will be treated by the DESTROY as if it was no
longer Active, and so the <em>database engine</em> related effects of DESTROYing a
handle will be skipped.</p>
<p>Think of the name as meaning 'treat the handle as not-Active in the DESTROY
method'.</p>
<p>For a database handle, this attribute does not disable an <em>explicit</em>
call to the disconnect method, only the implicit call from DESTROY
that happens if the handle is still marked as <code>Active</code>.</p>
<p>This attribute is specifically designed for use in Unix applications
that &quot;fork&quot; child processes. Either the parent or the child process,
but not both, should set <code>InactiveDestroy</code> true on all their shared handles.
(Note that some databases, including Oracle, don't support passing a
database connection across a fork.)</p>
<p>To help tracing applications using fork the process id is shown in
the trace log whenever a DBI or handle <code>trace()</code> method is called.
The process id also shown for <em>every</em> method call if the DBI trace
level (not handle trace level) is set high enough to show the trace
from the DBI's method dispatcher, e.g. &gt;= 9.</p>
<p>
</p>
<h3><a name="printwarn__boolean__inherited_"><code>PrintWarn</code> (boolean, inherited)</a></h3>
<p>The <code>PrintWarn</code> attribute controls the printing of warnings recorded
by the driver.  When set to a true value the DBI will check method
calls to see if a warning condition has been set. If so, the DBI
will effectively do a <a href="../lib/pods/perlfunc.html#warn"><code>warn(&quot;$class $method warning: $DBI::errstr&quot;)</code></a>
where <code>$class</code> is the driver class and <code>$method</code> is the name of
the method which failed. E.g.,</p>
<pre>
  DBD::Oracle::db execute warning: ... warning text here ...</pre>
<p>By default, <a href="../lib/pods/perlfunc.html#connect"><code>DBI-&gt;connect</code></a> sets <code>PrintWarn</code> &quot;on&quot; if $^W is true,
i.e., perl is running with warnings enabled.</p>
<p>If desired, the warnings can be caught and processed using a <code>$SIG{__WARN__}</code>
handler or modules like CGI::Carp and CGI::ErrorWrap.</p>
<p>See also <a href="#set_err">set_err</a> for how warnings are recorded and <a href="#handleseterr">HandleSetErr</a>
for how to influence it.</p>
<p>Fetching the full details of warnings can require an extra round-trip
to the database server for some drivers. In which case the driver
may opt to only fetch the full details of warnings if the <code>PrintWarn</code>
attribute is true. If <code>PrintWarn</code> is false then these drivers should
still indicate the fact that there were warnings by setting the
warning string to, for example: &quot;3 warnings&quot;.</p>
<p>
</p>
<h3><a name="printerror__boolean__inherited_"><code>PrintError</code> (boolean, inherited)</a></h3>
<p>The <code>PrintError</code> attribute can be used to force errors to generate warnings (using
<a href="../lib/pods/perlfunc.html#warn"><code>warn</code></a>) in addition to returning error codes in the normal way.  When set
&quot;on&quot;, any method which results in an error occuring will cause the DBI to
effectively do a <a href="../lib/pods/perlfunc.html#warn"><code>warn(&quot;$class $method failed: $DBI::errstr&quot;)</code></a> where <code>$class</code>
is the driver class and <code>$method</code> is the name of the method which failed. E.g.,</p>
<pre>
  DBD::Oracle::db prepare failed: ... error text here ...</pre>
<p>By default, <a href="../lib/pods/perlfunc.html#connect"><code>DBI-&gt;connect</code></a> sets <code>PrintError</code> &quot;on&quot;.</p>
<p>If desired, the warnings can be caught and processed using a <code>$SIG{__WARN__}</code>
handler or modules like CGI::Carp and CGI::ErrorWrap.</p>
<p>
</p>
<h3><a name="raiseerror__boolean__inherited_"><code>RaiseError</code> (boolean, inherited)</a></h3>
<p>The <code>RaiseError</code> attribute can be used to force errors to raise exceptions rather
than simply return error codes in the normal way. It is &quot;off&quot; by default.
When set &quot;on&quot;, any method which results in an error will cause
the DBI to effectively do a <a href="../lib/pods/perlfunc.html#die"><code>die(&quot;$class $method failed: $DBI::errstr&quot;)</code></a>,
where <code>$class</code> is the driver class and <code>$method</code> is the name of the method
that failed. E.g.,</p>
<pre>
  DBD::Oracle::db prepare failed: ... error text here ...</pre>
<p>If you turn <code>RaiseError</code> on then you'd normally turn <code>PrintError</code> off.
If <code>PrintError</code> is also on, then the <code>PrintError</code> is done first (naturally).</p>
<p>Typically <code>RaiseError</code> is used in conjunction with <a href="../lib/pods/perlfunc.html#eval"><code>eval { ... }</code></a>
to catch the exception that's been thrown and followed by an
<code>if ($@) { ... }</code> block to handle the caught exception.
For example:</p>
<pre>
  <span class="keyword">eval</span> <span class="operator">{</span>
    <span class="operator">...</span>
    <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">();</span>
    <span class="operator">...</span>
  <span class="operator">};</span>
  <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">{</span>
    <span class="comment"># $sth-&gt;err and $DBI::err will be true if error was from DBI</span>
    <span class="keyword">warn</span> <span class="variable">$@</span><span class="operator">;</span> <span class="comment"># print the error</span>
    <span class="operator">...</span> <span class="comment"># do whatever you need to deal with the error</span>
  <span class="operator">}</span>
</pre>
<p>In that eval block the $DBI::lasth variable can be useful for
diagnosis and reporting if you can't be sure which handle triggered
the error.  For example, $DBI::lasth-&gt;{Type} and $DBI::lasth-&gt;{Statement}.</p>
<p>See also <a href="#transactions">Transactions</a>.</p>
<p>If you want to temporarily turn <code>RaiseError</code> off (inside a library function
that is likely to fail, for example), the recommended way is like this:</p>
<pre>
  <span class="operator">{</span>
    <span class="keyword">local</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">RaiseError</span><span class="operator">}</span><span class="operator">;</span>  <span class="comment"># localize and turn off for this block</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
</pre>
<p>The original value will automatically and reliably be restored by Perl,
regardless of how the block is exited.
The same logic applies to other attributes, including <code>PrintError</code>.</p>
<p>
</p>
<h3><a name="handleerror__code_ref__inherited_"><code>HandleError</code> (code ref, inherited)</a></h3>
<p>The <code>HandleError</code> attribute can be used to provide your own alternative behaviour
in case of errors. If set to a reference to a subroutine then that
subroutine is called when an error is detected (at the same point that
<code>RaiseError</code> and <code>PrintError</code> are handled).</p>
<p>The subroutine is called with three parameters: the error message
string that <code>RaiseError</code> and <code>PrintError</code> would use,
the DBI handle being used, and the first value being returned by
the method that failed (typically undef).</p>
<p>If the subroutine returns a false value then the <code>RaiseError</code>
and/or <code>PrintError</code> attributes are checked and acted upon as normal.</p>
<p>For example, to <a href="../lib/pods/perlfunc.html#die"><code>die</code></a> with a full stack trace for any error:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">Carp</span><span class="operator">;</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">confess</span><span class="operator">(</span><span class="keyword">shift</span><span class="operator">)</span> <span class="operator">};</span>
</pre>
<p>Or to turn errors into exceptions:</p>
<pre>
  <span class="keyword">use</span> <span class="variable">Exception</span><span class="operator">;</span> <span class="comment"># or your own favourite exception module</span>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">Exception</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'DBI'</span><span class="operator">)-&gt;</span><span class="variable">raise</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">)</span> <span class="operator">};</span>
</pre>
<p>It is possible to 'stack' multiple HandleError handlers by using
closures:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> your_subroutine </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="variable">$previous_handler</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span><span class="operator">;</span>
    <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
      <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> <span class="variable">$previous_handler</span> <span class="keyword">and</span> <span class="operator">&amp;</span><span class="variable">$previous_handler</span><span class="operator">(</span><span class="variable">@_</span><span class="operator">);</span>
      <span class="operator">...</span> <span class="variable">your</span> <span class="variable">code</span> <span class="variable">here</span> <span class="operator">...</span>
    <span class="operator">};</span>
  <span class="operator">}</span>
</pre>
<p>Using a <a href="../lib/pods/perlfunc.html#my"><code>my</code></a> inside a subroutine to store the previous <code>HandleError</code>
value is important.  See <a href="../lib/pods/perlsub.html">the perlsub manpage</a> and <a href="../lib/pods/perlref.html">the perlref manpage</a> for more information
about <em>closures</em>.</p>
<p>It is possible for <code>HandleError</code> to alter the error message that
will be used by <code>RaiseError</code> and <code>PrintError</code> if it returns false.
It can do that by altering the value of $_[0]. This example appends
a stack trace to all errors and, unlike the previous example using
Carp::confess, this will work <code>PrintError</code> as well as <code>RaiseError</code>:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">=</span><span class="variable">Carp::longmess</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">);</span> <span class="number">0</span><span class="operator">;</span> <span class="operator">};</span>
</pre>
<p>It is also possible for <code>HandleError</code> to hide an error, to a limited
degree, by using <a href="#set_err">set_err</a> to reset $DBI::err and $DBI::errstr,
and altering the return value of the failed method. For example:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">HandleError</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
    <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">unless</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span> <span class="operator">=~</span> <span class="regex">/^\S+ fetchrow_arrayref failed:/</span><span class="operator">;</span>
    <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">unless</span> <span class="variable">$_</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">err</span> <span class="operator">==</span> <span class="number">1234</span><span class="operator">;</span> <span class="comment"># the error to 'hide'</span>
    <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="keyword">undef</span><span class="operator">,</span><span class="keyword">undef</span><span class="operator">);</span>   <span class="comment"># turn off the error</span>
    <span class="variable">$_</span><span class="operator">[</span><span class="number">2</span><span class="operator">]</span> <span class="operator">=</span> <span class="operator">[</span> <span class="operator">...</span> <span class="operator">]</span><span class="operator">;</span>    <span class="comment"># supply alternative return value</span>
    <span class="keyword">return</span> <span class="number">1</span><span class="operator">;</span>
  <span class="operator">};</span>
</pre>
<p>This only works for methods which return a single value and is hard
to make reliable (avoiding infinite loops, for example) and so isn't
recommended for general use!  If you find a <em>good</em> use for it then
please let me know.</p>
<p>
</p>
<h3><a name="handleseterr__code_ref__inherited_"><code>HandleSetErr</code> (code ref, inherited)</a></h3>
<p>The <code>HandleSetErr</code> attribute can be used to intercept
the setting of handle <code>err</code>, <code>errstr</code>, and <a href="../lib/pods/perlfunc.html#state"><code>state</code></a> values.
If set to a reference to a subroutine then that subroutine is called
whenever <code>set_err()</code> is called, typically by the driver or a subclass.</p>
<p>The subroutine is called with five arguments, the first five that
were passed to set_err(): the handle, the <code>err</code>, <code>errstr</code>, and
<a href="../lib/pods/perlfunc.html#state"><code>state</code></a> values being set, and the method name. These can be altered
by changing the values in the @_ array. The return value affects
<code>set_err()</code> behaviour, see <a href="#set_err">set_err</a> for details.</p>
<p>It is possible to 'stack' multiple HandleSetErr handlers by using
closures. See <a href="#handleerror">HandleError</a> for an example.</p>
<p>The <code>HandleSetErr</code> and <code>HandleError</code> subroutines differ in subtle
but significant ways. HandleError is only invoked at the point where
the DBI is about to return to the application with <code>err</code> set true.
It's not invoked by the failure of a method that's been called by
another DBI method.  HandleSetErr, on the other hand, is called
whenever <code>set_err()</code> is called with a defined <code>err</code> value, even if false.
So it's not just for errors, despite the name, but also warn and info states.
The <code>set_err()</code> method, and thus HandleSetErr, may be called multiple
times within a method and is usually invoked from deep within driver code.</p>
<p>In theory a driver can use the return value from HandleSetErr via
<code>set_err()</code> to decide whether to continue or not. If <code>set_err()</code> returns
an empty list, indicating that the HandleSetErr code has 'handled'
the 'error', the driver could then continue instead of failing (if
that's a reasonable thing to do).  This isn't excepted to be
common and any such cases should be clearly marked in the driver
documentation and discussed on the dbi-dev mailing list.</p>
<p>The <code>HandleSetErr</code> attribute was added in DBI 1.41.</p>
<p>
</p>
<h3><a name="errcount__unsigned_integer_"><code>ErrCount</code> (unsigned integer)</a></h3>
<p>The <code>ErrCount</code> attribute is incremented whenever the <code>set_err()</code>
method records an error. It isn't incremented by warnings or
information states. It is not reset by the DBI at any time.</p>
<p>The <code>ErrCount</code> attribute was added in DBI 1.41. Older drivers may
not have been updated to use <code>set_err()</code> to record errors and so this
attribute may not be incremented when using them.</p>
<p>
</p>
<h3><a name="showerrorstatement__boolean__inherited_"><code>ShowErrorStatement</code> (boolean, inherited)</a></h3>
<p>The <code>ShowErrorStatement</code> attribute can be used to cause the relevant
Statement text to be appended to the error messages generated by
the <code>RaiseError</code>, <code>PrintError</code>, and <code>PrintWarn</code> attributes.
Only applies to errors on statement handles
plus the <code>prepare()</code>, <a href="../lib/pods/perlfunc.html#do"><code>do()</code></a>, and the various <a href="../lib/pods/perlfunc.html#select"><code>select*()</code></a> database handle methods.
(The exact format of the appended text is subject to change.)</p>
<p>If <code>$h-&gt;{ParamValues}</code> returns a hash reference of parameter
(placeholder) values then those are formatted and appended to the
end of the Statement text in the error message.</p>
<p>
</p>
<h3><a name="tracelevel__integer__inherited_"><code>TraceLevel</code> (integer, inherited)</a></h3>
<p>The <code>TraceLevel</code> attribute can be used as an alternative to the
<a href="#trace">trace</a> method to set the DBI trace level and trace flags for a
specific handle.  See <a href="#tracing">TRACING</a> for more details.</p>
<p>The <code>TraceLevel</code> attribute is especially useful combined with
<a href="../lib/pods/perlfunc.html#local"><code>local</code></a> to alter the trace settings for just a single block of code.</p>
<p>
</p>
<h3><a name="fetchhashkeyname__string__inherited_"><code>FetchHashKeyName</code> (string, inherited)</a></h3>
<p>The <code>FetchHashKeyName</code> attribute is used to specify whether the <code>fetchrow_hashref()</code>
method should perform case conversion on the field names used for
the hash keys. For historical reasons it defaults to '<a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a>' but
it is recommended to set it to '<code>NAME_lc</code>' (convert to lower case)
or '<code>NAME_uc</code>' (convert to upper case) according to your preference.
It can only be set for driver and database handles.  For statement
handles the value is frozen when <code>prepare()</code> is called.</p>
<p>
</p>
<h3><a name="chopblanks__boolean__inherited_"><code>ChopBlanks</code> (boolean, inherited)</a></h3>
<p>The <code>ChopBlanks</code> attribute can be used to control the trimming of trailing space
characters from fixed width character (CHAR) fields. No other field
types are affected, even where field values have trailing spaces.</p>
<p>The default is false (although it is possible that the default may change).
Applications that need specific behaviour should set the attribute as
needed.</p>
<p>Drivers are not required to support this attribute, but any driver which
does not support it must arrange to return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> as the attribute value.</p>
<p>
</p>
<h3><a name="longreadlen__unsigned_integer__inherited_"><code>LongReadLen</code> (unsigned integer, inherited)</a></h3>
<p>The <code>LongReadLen</code> attribute may be used to control the maximum
length of 'long' type fields (LONG, BLOB, CLOB, MEMO, etc.) which the driver will
read from the database automatically when it fetches each row of data.</p>
<p>The <code>LongReadLen</code> attribute only relates to fetching and reading
long values; it is not involved in inserting or updating them.</p>
<p>A value of 0 means not to automatically fetch any long data.
Drivers may return undef or an empty string for long fields when
<code>LongReadLen</code> is 0.</p>
<p>The default is typically 0 (zero) or 80 bytes but may vary between drivers.
Applications fetching long fields should set this value to slightly
larger than the longest long field value to be fetched.</p>
<p>Some databases return some long types encoded as pairs of hex digits.
For these types, <code>LongReadLen</code> relates to the underlying data
length and not the doubled-up length of the encoded string.</p>
<p>Changing the value of <code>LongReadLen</code> for a statement handle after it
has been <code>prepare</code>'d will typically have no effect, so it's common to
set <code>LongReadLen</code> on the <code>$dbh</code> before calling <code>prepare</code>.</p>
<p>For most drivers the value used here has a direct effect on the
memory used by the statement handle while it's active, so don't be
too generous. If you can't be sure what value to use you could
execute an extra select statement to determine the longest value.
For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">LongReadLen</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_array</span><span class="operator">(</span><span class="string">qq{
      SELECT MAX(OCTET_LENGTH(long_column_name))
      FROM table WHERE ...
  }</span><span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">qq{
      SELECT long_column_name, ... FROM table WHERE ...
  }</span><span class="operator">);</span>
</pre>
<p>You may need to take extra care if the table can be modified between
the first select and the second being executed. You may also need to
use a different function if <code>OCTET_LENGTH()</code> does not work for long
types in your database. For example, for Sybase use <code>DATALENGTH()</code> and
for Oracle use <code>LENGTHB()</code>.</p>
<p>See also <a href="#longtruncok">LongTruncOk</a> for information on truncation of long types.</p>
<p>
</p>
<h3><a name="longtruncok__boolean__inherited_"><code>LongTruncOk</code> (boolean, inherited)</a></h3>
<p>The <code>LongTruncOk</code> attribute may be used to control the effect of
fetching a long field value which has been truncated (typically
because it's longer than the value of the <code>LongReadLen</code> attribute).</p>
<p>By default, <code>LongTruncOk</code> is false and so fetching a long value that
needs to be truncated will cause the fetch to fail.
(Applications should always be sure to
check for errors after a fetch loop in case an error, such as a divide
by zero or long field truncation, caused the fetch to terminate
prematurely.)</p>
<p>If a fetch fails due to a long field truncation when <code>LongTruncOk</code> is
false, many drivers will allow you to continue fetching further rows.</p>
<p>See also <a href="#longreadlen">LongReadLen</a>.</p>
<p>
</p>
<h3><a name="taintin__boolean__inherited_"><code>TaintIn</code> (boolean, inherited)</a></h3>
<p>If the <code>TaintIn</code> attribute is set to a true value <em>and</em> Perl is running in
taint mode (e.g., started with the <a href="../lib/pods/perlrun.html#t"><code>-T</code></a> option), then all the arguments
to most DBI method calls are checked for being tainted. <em>This may change.</em></p>
<p>The attribute defaults to off, even if Perl is in taint mode.
See <a href="../lib/pods/perlsec.html">the perlsec manpage</a> for more about taint mode.  If Perl is not
running in taint mode, this attribute has no effect.</p>
<p>When fetching data that you trust you can turn off the TaintIn attribute,
for that statement handle, for the duration of the fetch loop.</p>
<p>The <code>TaintIn</code> attribute was added in DBI 1.31.</p>
<p>
</p>
<h3><a name="taintout__boolean__inherited_"><code>TaintOut</code> (boolean, inherited)</a></h3>
<p>If the <code>TaintOut</code> attribute is set to a true value <em>and</em> Perl is running in
taint mode (e.g., started with the <a href="../lib/pods/perlrun.html#t"><code>-T</code></a> option), then most data fetched
from the database is considered tainted. <em>This may change.</em></p>
<p>The attribute defaults to off, even if Perl is in taint mode.
See <a href="../lib/pods/perlsec.html">the perlsec manpage</a> for more about taint mode.  If Perl is not
running in taint mode, this attribute has no effect.</p>
<p>When fetching data that you trust you can turn off the TaintOut attribute,
for that statement handle, for the duration of the fetch loop.</p>
<p>Currently only fetched data is tainted. It is possible that the results
of other DBI method calls, and the value of fetched attributes, may
also be tainted in future versions. That change may well break your
applications unless you take great care now. If you use DBI Taint mode,
please report your experience and any suggestions for changes.</p>
<p>The <code>TaintOut</code> attribute was added in DBI 1.31.</p>
<p>
</p>
<h3><a name="taint__boolean__inherited_"><code>Taint</code> (boolean, inherited)</a></h3>
<p>The <code>Taint</code> attribute is a shortcut for <a href="#taintin">TaintIn</a> and <a href="#taintout">TaintOut</a> (it is also present
for backwards compatibility).</p>
<p>Setting this attribute sets both <a href="#taintin">TaintIn</a> and <a href="#taintout">TaintOut</a>, and retrieving
it returns a true value if and only if <a href="#taintin">TaintIn</a> and <a href="#taintout">TaintOut</a> are
both set to true values.</p>
<p>
</p>
<h3><a name="profile__inherited_"><code>Profile</code> (inherited)</a></h3>
<p>The <code>Profile</code> attribute enables the collection and reporting of method call timing statistics.
See the <a href="../lib/DBI/Profile.html">the DBI::Profile manpage</a> module documentation for <em>much</em> more detail.</p>
<p>The <code>Profile</code> attribute was added in DBI 1.24.</p>
<p>
</p>
<h3><a name="readonly__boolean__inherited_"><code>ReadOnly</code> (boolean, inherited)</a></h3>
<p>An application can set the <code>ReadOnly</code> attribute of a handle to a true value to
indicate that it will not be attempting to make any changes using that handle
or any children of it.</p>
<p>Note that the exact definition of 'read only' is rather fuzzy.
For more details see the documentation for the driver you're using.</p>
<p>If the driver can make the handle truly read-only then it should
(unless doing so would have unpleasant side effect, like changing the
consistency level from per-statement to per-session).
Otherwise the attribute is simply advisory.</p>
<p>A driver can set the <code>ReadOnly</code> attribute itself to indicate that the data it
is connected to cannot be changed for some reason.</p>
<p>Library modules and proxy drivers can use the attribute to influence their behavior.
For example, the DBD::Gofer driver considers the <code>ReadOnly</code> attribute when
making a decison about whether to retry an operation that failed.</p>
<p>The attribute should be set to 1 or 0 (or undef). Other values are reserved.</p>
<p>
</p>
<h3><a name="private_your_module_name__"><code>private_your_module_name_*</code></a></h3>
<p>The DBI provides a way to store extra information in a DBI handle as
&quot;private&quot; attributes. The DBI will allow you to store and retrieve any
attribute which has a name starting with &quot;<code>private_</code>&quot;.</p>
<p>It is <em>strongly</em> recommended that you use just <em>one</em> private
attribute (e.g., use a hash ref) <em>and</em> give it a long and unambiguous
name that includes the module or application name that the attribute
relates to (e.g., &quot;<code>private_YourFullModuleName_thingy</code>&quot;).</p>
<p>Because of the way the Perl tie mechanism works you cannot reliably
use the <code>||=</code> operator directly to initialise the attribute, like this:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$foo</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">private_yourmodname_foo</span><span class="operator">}</span> <span class="operator">||=</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">;</span> <span class="comment"># WRONG</span>
</pre>
<p>you should use a two step approach like this:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$foo</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">private_yourmodname_foo</span><span class="operator">}</span><span class="operator">;</span>
  <span class="variable">$foo</span> <span class="operator">||=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">private_yourmodname_foo</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>This attribute is primarily of interest to people sub-classing DBI,
or for applications to piggy-back extra information onto DBI handles.</p>
<p>
</p>
<hr />
<h1><a name="dbi_database_handle_objects">DBI DATABASE HANDLE OBJECTS</a></h1>
<p>This section covers the methods and attributes associated with
database handles.</p>
<p>
</p>
<h2><a name="database_handle_methods">Database Handle Methods</a></h2>
<p>The following methods are specified for DBI database handles:</p>
<p>
</p>
<h3><a name="clone"><code>clone</code></a></h3>
<pre>
  <span class="variable">$new_dbh</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">clone</span><span class="operator">();</span>
  <span class="variable">$new_dbh</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">clone</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<p>The <code>clone</code> method duplicates the $dbh connection by connecting
with the same parameters ($dsn, $user, $password) as originally used.</p>
<p>The attributes for the cloned connect are the same as those used
for the original connect, with some other attribute merged over
them depending on the \%attr parameter.</p>
<p>If \%attr is given then the attributes it contains are merged into
the original attributes and override any with the same names.
Effectively the same as doing:</p>
<pre>
  <span class="variable">%attribues_used</span> <span class="operator">=</span> <span class="operator">(</span> <span class="variable">%original_attributes</span><span class="operator">,</span> <span class="variable">%attr</span> <span class="operator">);</span>
</pre>
<p>If \%attr is not given then it defaults to a hash containing all
the attributes in the attribute cache of $dbh excluding any non-code
references, plus the main boolean attributes (RaiseError, PrintError,
AutoCommit, etc.). This behaviour is subject to change.</p>
<p>The clone method can be used even if the database handle is disconnected.</p>
<p>The <code>clone</code> method was added in DBI 1.33. It is very new and likely
to change.</p>
<p>
</p>
<h3><a name="data_sources"><code>data_sources</code></a></h3>
<pre>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">();</span>
  <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">data_sources</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<p>Returns a list of data sources (databases) available via the $dbh
driver's <code>data_sources()</code> method, plus any extra data sources that
the driver can discover via the connected $dbh. Typically the extra
data sources are other databases managed by the same server process
that the $dbh is connected to.</p>
<p>Data sources are returned in a form suitable for passing to the
<a href="../lib/pods/perlfunc.html#connect">connect</a> method (that is, they will include the &quot;<code>dbi:$driver:</code>&quot; prefix).</p>
<p>The <code>data_sources()</code> method, for a $dbh, was added in DBI 1.38.</p>
<p>
</p>
<h3><a name="do"><a href="../lib/pods/perlfunc.html#do"><code>do</code></a></a></h3>
<pre>
  <span class="variable">$rows</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">)</span>           <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$rows</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">)</span>   <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$rows</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="operator">...</span>
</pre>
<p>Prepare and execute a single statement. Returns the number of rows
affected or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> on error. A return value of <code>-1</code> means the
number of rows is not known, not applicable, or not available.</p>
<p>This method is typically most useful for <em>non</em>-<code>SELECT</code> statements that
either cannot be prepared in advance (due to a limitation of the
driver) or do not need to be executed repeatedly. It should not
be used for <code>SELECT</code> statements because it does not return a statement
handle (so you can't fetch any data).</p>
<p>The default <a href="../lib/pods/perlfunc.html#do"><code>do</code></a> method is logically similar to:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> do </span><span class="operator">{</span>
      <span class="keyword">my</span><span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$attr</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">return</span> <span class="keyword">undef</span><span class="operator">;</span>
      <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">@bind_values</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">return</span> <span class="keyword">undef</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="variable">$rows</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">rows</span><span class="operator">;</span>
      <span class="operator">(</span><span class="variable">$rows</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span> <span class="operator">?</span> <span class="string">"0E0"</span> <span class="operator">:</span> <span class="variable">$rows</span><span class="operator">;</span> <span class="comment"># always return true if no error</span>
  <span class="operator">}</span>
</pre>
<p>For example:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$rows_deleted</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">do</span><span class="operator">(</span><span class="string">q{
      DELETE FROM table
      WHERE status = ?
  }</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="string">'DONE'</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Using placeholders and <code>@bind_values</code> with the <a href="../lib/pods/perlfunc.html#do"><code>do</code></a> method can be
useful because it avoids the need to correctly quote any variables
in the <code>$statement</code>. But if you'll be executing the statement many
times then it's more efficient to <code>prepare</code> it once and call
<code>execute</code> many times instead.</p>
<p>The <code>q{...}</code> style quoting used in this example avoids clashing with
quotes that may be used in the SQL statement. Use the double-quote-like
<code>qq{...}</code> operator if you want to interpolate variables into the string.
See <a href="../lib/pods/perlop.html#quote_and_quote_like_operators">Quote and Quote-like Operators in the perlop manpage</a> for more details.</p>
<p>
</p>
<h3><a name="last_insert_id"><code>last_insert_id</code></a></h3>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">last_insert_id</span><span class="operator">(</span><span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$field</span><span class="operator">);</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">last_insert_id</span><span class="operator">(</span><span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$field</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<p>Returns a value 'identifying' the row just inserted, if possible.
Typically this would be a value assigned by the database server
to a column with an <em>auto_increment</em> or <em>serial</em> type.
Returns undef if the driver does not support the method or can't
determine the value.</p>
<p>The $catalog, $schema, $table, and $field parameters may be required
for some drivers (see below).  If you don't know the parameter values
and your driver does not need them, then use <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> for each.</p>
<p>There are several caveats to be aware of with this method if you want
to use it for portable applications:</p>
<p><strong>*</strong> For some drivers the value may only available immediately after
the insert statement has executed (e.g., mysql, Informix).</p>
<p><strong>*</strong> For some drivers the $catalog, $schema, $table, and $field parameters
are required, for others they are ignored (e.g., mysql).</p>
<p><strong>*</strong> Drivers may return an indeterminate value if no insert has
been performed yet.</p>
<p><strong>*</strong> For some drivers the value may only be available if placeholders
have <em>not</em> been used (e.g., Sybase, MS SQL). In this case the value
returned would be from the last non-placeholder insert statement.</p>
<p><strong>*</strong> Some drivers may need driver-specific hints about how to get
the value. For example, being told the name of the database 'sequence'
object that holds the value. Any such hints are passed as driver-specific
attributes in the \%attr parameter.</p>
<p><strong>*</strong> If the underlying database offers nothing better, then some
drivers may attempt to implement this method by executing
&quot;<code>select max($field) from $table</code>&quot;. Drivers using any approach
like this should issue a warning if <code>AutoCommit</code> is true because
it is generally unsafe - another process may have modified the table
between your insert and the select. For situations where you know
it is safe, such as when you have locked the table, you can silence
the warning by passing <code>Warn</code> =&gt; 0 in \%attr.</p>
<p><strong>*</strong> If no insert has been performed yet, or the last insert failed,
then the value is implementation defined.</p>
<p>Given all the caveats above, it's clear that this method must be
used with care.</p>
<p>The <code>last_insert_id</code> method was added in DBI 1.38.</p>
<p>
</p>
<h3><a name="selectrow_array"><code>selectrow_array</code></a></h3>
<pre>
  <span class="variable">@row_ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_array</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">@row_ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_array</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">@row_ary</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_array</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a> and
<a href="#fetchrow_array">fetchrow_array</a> into a single call. If called in a list context, it
returns the first row of data from the statement.  The <code>$statement</code>
parameter can be a previously prepared statement handle, in which case
the <code>prepare</code> is skipped.</p>
<p>If any method fails, and <a href="#raiseerror">RaiseError</a> is not set, <code>selectrow_array</code>
will return an empty list.</p>
<p>If called in a scalar context for a statement handle that has more
than one column, it is undefined whether the driver will return
the value of the first column or the last. So don't do that.
Also, in a scalar context, an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> is returned if there are no
more rows or if an error occurred. That <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> can't be distinguished
from an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> returned because the first field value was NULL.
For these reasons you should exercise some caution if you use
<code>selectrow_array</code> in a scalar context, or just don't do that.</p>
<p>
</p>
<h3><a name="selectrow_arrayref"><code>selectrow_arrayref</code></a></h3>
<pre>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a> and
<a href="#fetchrow_arrayref">fetchrow_arrayref</a> into a single call. It returns the first row of
data from the statement.  The <code>$statement</code> parameter can be a previously
prepared statement handle, in which case the <code>prepare</code> is skipped.</p>
<p>If any method fails, and <a href="#raiseerror">RaiseError</a> is not set, <code>selectrow_array</code>
will return undef.</p>
<p>
</p>
<h3><a name="selectrow_hashref"><code>selectrow_hashref</code></a></h3>
<pre>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectrow_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a> and
<a href="#fetchrow_hashref">fetchrow_hashref</a> into a single call. It returns the first row of
data from the statement.  The <code>$statement</code> parameter can be a previously
prepared statement handle, in which case the <code>prepare</code> is skipped.</p>
<p>If any method fails, and <a href="#raiseerror">RaiseError</a> is not set, <code>selectrow_hashref</code>
will return undef.</p>
<p>
</p>
<h3><a name="selectall_arrayref"><code>selectall_arrayref</code></a></h3>
<pre>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a> and
<a href="#fetchall_arrayref">fetchall_arrayref</a> into a single call. It returns a reference to an
array containing a reference to an array (or hash, see below) for each row of
data fetched.</p>
<p>The <code>$statement</code> parameter can be a previously prepared statement handle,
in which case the <code>prepare</code> is skipped. This is recommended if the
statement is going to be executed many times.</p>
<p>If <a href="#raiseerror">RaiseError</a> is not set and any method except <code>fetchall_arrayref</code>
fails then <code>selectall_arrayref</code> will return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>; if
<code>fetchall_arrayref</code> fails then it will return with whatever data
has been fetched thus far. You should check <code>$sth-&gt;err</code>
afterwards (or use the <code>RaiseError</code> attribute) to discover if the data is
complete or was truncated due to an error.</p>
<p>The <a href="#fetchall_arrayref">fetchall_arrayref</a> method called by <code>selectall_arrayref</code>
supports a $max_rows parameter. You can specify a value for $max_rows
by including a '<code>MaxRows</code>' attribute in \%attr. In which case <a href="#finish"><code>finish()</code></a>
is called for you after <code>fetchall_arrayref()</code> returns.</p>
<p>The <a href="#fetchall_arrayref">fetchall_arrayref</a> method called by <code>selectall_arrayref</code>
also supports a $slice parameter. You can specify a value for $slice by
including a '<code>Slice</code>' or '<code>Columns</code>' attribute in \%attr. The only
difference between the two is that if <code>Slice</code> is not defined and
<code>Columns</code> is an array ref, then the array is assumed to contain column
index values (which count from 1), rather than perl array index values.
In which case the array is copied and each value decremented before
passing to <code>/fetchall_arrayref</code>.</p>
<p>You may often want to fetch an array of rows where each row is stored as a
hash. That can be done simple using:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$emps</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span>
      <span class="string">"SELECT ename FROM emp ORDER BY ename"</span><span class="operator">,</span>
      <span class="operator">{</span> <span class="string">Slice</span> <span class="operator">=&gt;</span> <span class="operator">{}</span> <span class="operator">}</span>
  <span class="operator">);</span>
  <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$emp</span> <span class="operator">(</span> <span class="variable">@$emps</span> <span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">print</span> <span class="string">"Employee: </span><span class="variable">$emp</span><span class="string">-&gt;{ename}\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>Or, to fetch into an array instead of an array ref:</p>
<pre>
  <span class="variable">@result</span> <span class="operator">=</span> <span class="variable">@</span><span class="operator">{</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$sql</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">Slice</span> <span class="operator">=&gt;</span> <span class="operator">{}</span> <span class="operator">}</span><span class="operator">)</span> <span class="operator">}</span><span class="operator">;</span>
</pre>
<p>See <a href="#fetchall_arrayref">fetchall_arrayref</a> method for more details.</p>
<p>
</p>
<h3><a name="selectall_hashref"><code>selectall_hashref</code></a></h3>
<pre>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$key_field</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$key_field</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_hashref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="variable">$key_field</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a> and
<a href="#fetchall_hashref">fetchall_hashref</a> into a single call. It returns a reference to a
hash containing one entry, at most, for each row, as returned by <code>fetchall_hashref()</code>.</p>
<p>The <code>$statement</code> parameter can be a previously prepared statement handle,
in which case the <code>prepare</code> is skipped.  This is recommended if the
statement is going to be executed many times.</p>
<p>The <code>$key_field</code> parameter defines which column, or columns, are used as keys
in the returned hash. It can either be the name of a single field, or a
reference to an array containing multiple field names. Using multiple names
yields a tree of nested hashes.</p>
<p>If a row has the same key as an earlier row then it replaces the earlier row.</p>
<p>If any method except <code>fetchrow_hashref</code> fails, and <a href="#raiseerror">RaiseError</a> is not set,
<code>selectall_hashref</code> will return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.  If <code>fetchrow_hashref</code> fails and
<a href="#raiseerror">RaiseError</a> is not set, then it will return with whatever data it
has fetched thus far. $DBI::err should be checked to catch that.</p>
<p>See <code>fetchall_hashref()</code> for more details.</p>
<p>
</p>
<h3><a name="selectcol_arrayref"><code>selectcol_arrayref</code></a></h3>
<pre>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">);</span>
</pre>
<p>This utility method combines <a href="#prepare">prepare</a>, <a href="#execute">execute</a>, and fetching one
column from all the rows, into a single call. It returns a reference to
an array containing the values of the first column from each row.</p>
<p>The <code>$statement</code> parameter can be a previously prepared statement handle,
in which case the <code>prepare</code> is skipped. This is recommended if the
statement is going to be executed many times.</p>
<p>If any method except <code>fetch</code> fails, and <a href="#raiseerror">RaiseError</a> is not set,
<code>selectcol_arrayref</code> will return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.  If <code>fetch</code> fails and
<a href="#raiseerror">RaiseError</a> is not set, then it will return with whatever data it
has fetched thus far. $DBI::err should be checked to catch that.</p>
<p>The <code>selectcol_arrayref</code> method defaults to pushing a single column
value (the first) from each row into the result array. However, it can
also push another column, or even multiple columns per row, into the
result array. This behaviour can be specified via a '<code>Columns</code>'
attribute which must be a ref to an array containing the column number
or numbers to use. For example:</p>
<pre>
  <span class="comment"># get array of id and name pairs:</span>
  <span class="keyword">my</span> <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectcol_arrayref</span><span class="operator">(</span><span class="string">"select id, name from table"</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">Columns</span><span class="operator">=&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="operator">]</span> <span class="operator">}</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">%hash</span> <span class="operator">=</span> <span class="variable">@$ary_ref</span><span class="operator">;</span> <span class="comment"># build hash from key-value pairs so $hash{$id} =&gt; name</span>
</pre>
<p>You can specify a maximum number of rows to fetch by including a
'<code>MaxRows</code>' attribute in \%attr.</p>
<p>
</p>
<h3><a name="prepare"><code>prepare</code></a></h3>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">)</span>          <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="variable">$statement</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">)</span>  <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Prepares a statement for later execution by the database
engine and returns a reference to a statement handle object.</p>
<p>The returned statement handle can be used to get attributes of the
statement and invoke the <a href="#execute">execute</a> method. See <a href="#statement_handle_methods">Statement Handle Methods</a>.</p>
<p>Drivers for engines without the concept of preparing a
statement will typically just store the statement in the returned
handle and process it when <code>$sth-&gt;execute</code> is called. Such drivers are
unlikely to give much useful information about the
statement, such as <code>$sth-&gt;{NUM_OF_FIELDS}</code>, until after <code>$sth-&gt;execute</code>
has been called. Portable applications should take this into account.</p>
<p>In general, DBI drivers do not parse the contents of the statement
(other than simply counting any <a href="#placeholders">Placeholders</a>). The statement is
passed directly to the database engine, sometimes known as pass-thru
mode. This has advantages and disadvantages. On the plus side, you can
access all the functionality of the engine being used. On the downside,
you're limited if you're using a simple engine, and you need to take extra care if
writing applications intended to be portable between engines.</p>
<p>Portable applications should not assume that a new statement can be
prepared and/or executed while still fetching results from a previous
statement.</p>
<p>Some command-line SQL tools use statement terminators, like a semicolon,
to indicate the end of a statement. Such terminators should not normally
be used with the DBI.</p>
<p>
</p>
<h3><a name="prepare_cached"><code>prepare_cached</code></a></h3>
<pre>
  $sth = $dbh-&gt;prepare_cached($statement)
  $sth = $dbh-&gt;prepare_cached($statement, \%attr)
  $sth = $dbh-&gt;prepare_cached($statement, \%attr, $if_active)</pre>
<p>Like <a href="#prepare">prepare</a> except that the statement handle returned will be
stored in a hash associated with the <code>$dbh</code>. If another call is made to
<code>prepare_cached</code> with the same <code>$statement</code> and <code>%attr</code> parameter values,
then the corresponding cached <code>$sth</code> will be returned without contacting the
database server.</p>
<p>The <code>$if_active</code> parameter lets you adjust the behaviour if an
already cached statement handle is still Active.  There are several
alternatives:</p>
<ol>
<li><strong><a name="finish" class="item"><strong>0</strong>: A warning will be generated, and <code>finish()</code> will be called on
the statement handle before it is returned.  This is the default
behaviour if $if_active is not passed.</a></strong>

<li><strong><strong>1</strong>: <code>finish()</code> will be called on the statement handle, but the
warning is suppressed.</strong>

<li><strong><a name="disables_any_checking" class="item"><strong>2</strong>: Disables any checking.</a></strong>

<li><strong><a name="the_existing_active_statement_handle_will_be_removed_from_the_cache_and_a_new_statement_handle_prepared_and_cached_in_its_place_this_is_the_safest_option_because_it_doesn_t_affect_the_state_of_the_old_handle_it_just_removes_it_from_the_cache_added_in_dbi_1_40" class="item"><strong>3</strong>: The existing active statement handle will be removed from the
cache and a new statement handle prepared and cached in its place.
This is the safest option because it doesn't affect the state of the
old handle, it just removes it from the cache. [Added in DBI 1.40]</a></strong>

</ol>
<p>Here are some examples of <code>prepare_cached</code>:</p>
<pre>
  <span class="keyword">sub</span><span class="variable"> insert_hash </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$table</span><span class="operator">,</span> <span class="variable">$field_values</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="comment"># sort to keep field order, and thus sql, stable for prepare_cached</span>
    <span class="keyword">my</span> <span class="variable">@fields</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="keyword">keys</span> <span class="variable">%$field_values</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">@values</span> <span class="operator">=</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$field_values</span><span class="operator">}{</span><span class="variable">@fields</span><span class="operator">}</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$sql</span> <span class="operator">=</span> <span class="keyword">sprintf</span> <span class="string">"insert into %s (%s) values (%s)"</span><span class="operator">,</span>
        <span class="variable">$table</span><span class="operator">,</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">","</span><span class="operator">,</span> <span class="variable">@fields</span><span class="operator">),</span> <span class="keyword">join</span><span class="operator">(</span><span class="string">","</span><span class="operator">,</span> <span class="operator">(</span><span class="string">"?"</span><span class="operator">)x</span><span class="variable">@fields</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="variable">$sql</span><span class="operator">);</span>
    <span class="keyword">return</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">@values</span><span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<pre>
  <span class="keyword">sub</span><span class="variable"> search_hash </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$table</span><span class="operator">,</span> <span class="variable">$field_values</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="comment"># sort to keep field order, and thus sql, stable for prepare_cached</span>
    <span class="keyword">my</span> <span class="variable">@fields</span> <span class="operator">=</span> <span class="keyword">sort</span> <span class="keyword">keys</span> <span class="variable">%$field_values</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">@values</span> <span class="operator">=</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$field_values</span><span class="operator">}{</span><span class="variable">@fields</span><span class="operator">}</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$qualifier</span> <span class="operator">=</span> <span class="string">""</span><span class="operator">;</span>
    <span class="variable">$qualifier</span> <span class="operator">=</span> <span class="string">"where "</span><span class="operator">.</span><span class="keyword">join</span><span class="operator">(</span><span class="string">" and "</span><span class="operator">,</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="string">"</span><span class="variable">$_</span><span class="string">=?"</span> <span class="operator">}</span> <span class="variable">@fields</span><span class="operator">)</span> <span class="keyword">if</span> <span class="variable">@fields</span><span class="operator">;</span>
    <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="string">"SELECT * FROM </span><span class="variable">$table</span><span class="string"> </span><span class="variable">$qualifier</span><span class="string">"</span><span class="operator">);</span>
    <span class="keyword">return</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">selectall_arrayref</span><span class="operator">(</span><span class="variable">$sth</span><span class="operator">,</span> <span class="operator">{}</span><span class="operator">,</span> <span class="variable">@values</span><span class="operator">);</span>
  <span class="operator">}</span>
</pre>
<p><em>Caveat emptor:</em> This caching can be useful in some applications,
but it can also cause problems and should be used with care. Here
is a contrived case where caching would cause a significant problem:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="string">'SELECT * FROM foo WHERE bar=?'</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(...);</span>
  <span class="keyword">while</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$data</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_hashref</span><span class="operator">)</span> <span class="operator">{</span>
</pre>
<pre>
    <span class="comment"># later, in some other code called within the loop...</span>
    <span class="keyword">my</span> <span class="variable">$sth2</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="string">'SELECT * FROM foo WHERE bar=?'</span><span class="operator">);</span>
    <span class="variable">$sth2</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(...);</span>
    <span class="keyword">while</span> <span class="operator">(</span><span class="keyword">my</span> <span class="variable">$data2</span> <span class="operator">=</span> <span class="variable">$sth2</span><span class="operator">-&gt;</span><span class="variable">fetchrow_arrayref</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="variable">do_stuff</span><span class="operator">(...);</span>
    <span class="operator">}</span>
      <span class="operator">}</span>
</pre>
<p>In this example, since both handles are preparing the exact same statement,
<code>$sth2</code> will not be its own statement handle, but a duplicate of <code>$sth</code>
returned from the cache. The results will certainly not be what you expect.
Typically the the inner fetch loop will work normally, fetching all
the records and terminating when there are no more, but now $sth
is the same as $sth2 the outer fetch loop will also terminate.</p>
<p>You'll know if you run into this problem because <code>prepare_cached()</code>
will generate a warning by default (when $if_active is false).</p>
<p>The cache used by <code>prepare_cached()</code> is keyed by both the statement
and any attributes so you can also avoid this issue by doing something
like:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare_cached</span><span class="operator">(</span><span class="string">"..."</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">dbi_dummy</span> <span class="operator">=&gt;</span> <span class="keyword">__FILE__</span><span class="operator">.</span><span class="keyword">__LINE__</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>which will ensure that prepare_cached only returns statements cached
by that line of code in that source file.</p>
<p>If you'd like the cache to managed intelligently, you can tie the
hashref returned by <code>CachedKids</code> to an appropriate caching module,
such as <a href="../Tie/Cache/LRU.html">the Tie::Cache::LRU manpage</a>:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$cache</span><span class="operator">;</span>
  <span class="keyword">tie</span> <span class="variable">%$cache</span><span class="operator">,</span> <span class="string">'Tie::Cache::LRU'</span><span class="operator">,</span> <span class="number">500</span><span class="operator">;</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">CachedKids</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$cache</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="commit"><code>commit</code></a></h3>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span>     <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Commit (make permanent) the most recent series of database changes
if the database supports transactions and AutoCommit is off.</p>
<p>If <code>AutoCommit</code> is on, then calling
<code>commit</code> will issue a &quot;commit ineffective with AutoCommit&quot; warning.</p>
<p>See also <a href="#transactions">Transactions</a> in the <a href="#further_information">FURTHER INFORMATION</a> section below.</p>
<p>
</p>
<h3><a name="rollback"><code>rollback</code></a></h3>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">rollback</span>   <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Rollback (undo) the most recent series of uncommitted database
changes if the database supports transactions and AutoCommit is off.</p>
<p>If <code>AutoCommit</code> is on, then calling
<code>rollback</code> will issue a &quot;rollback ineffective with AutoCommit&quot; warning.</p>
<p>See also <a href="#transactions">Transactions</a> in the <a href="#further_information">FURTHER INFORMATION</a> section below.</p>
<p>
</p>
<h3><a name="begin_work"><code>begin_work</code></a></h3>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">begin_work</span>   <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Enable transactions (by turning <code>AutoCommit</code> off) until the next call
to <code>commit</code> or <code>rollback</code>. After the next <code>commit</code> or <code>rollback</code>,
<code>AutoCommit</code> will automatically be turned on again.</p>
<p>If <code>AutoCommit</code> is already off when <code>begin_work</code> is called then
it does nothing except return an error. If the driver does not support
transactions then when <code>begin_work</code> attempts to set <code>AutoCommit</code> off
the driver will trigger a fatal error.</p>
<p>See also <a href="#transactions">Transactions</a> in the <a href="#further_information">FURTHER INFORMATION</a> section below.</p>
<p>
</p>
<h3><a name="disconnect"><code>disconnect</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">disconnect</span>  <span class="keyword">or</span> <span class="keyword">warn</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Disconnects the database from the database handle. <code>disconnect</code> is typically only used
before exiting the program. The handle is of little use after disconnecting.</p>
<p>The transaction behaviour of the <code>disconnect</code> method is, sadly,
undefined.  Some database systems (such as Oracle and Ingres) will
automatically commit any outstanding changes, but others (such as
Informix) will rollback any outstanding changes.  Applications not
using <code>AutoCommit</code> should explicitly call <code>commit</code> or <code>rollback</code> before
calling <code>disconnect</code>.</p>
<p>The database is automatically disconnected by the <code>DESTROY</code> method if
still connected when there are no longer any references to the handle.
The <code>DESTROY</code> method for each driver should implicitly call <code>rollback</code> to
undo any uncommitted changes. This is vital behaviour to ensure that
incomplete transactions don't get committed simply because Perl calls
<code>DESTROY</code> on every object before exiting. Also, do not rely on the order
of object destruction during &quot;global destruction&quot;, as it is undefined.</p>
<p>Generally, if you want your changes to be commited or rolled back when
you disconnect, then you should explicitly call <a href="#commit">commit</a> or <a href="#rollback">rollback</a>
before disconnecting.</p>
<p>If you disconnect from a database while you still have active
statement handles (e.g., SELECT statement handles that may have
more data to fetch), you will get a warning. The warning may indicate
that a fetch loop terminated early, perhaps due to an uncaught error.
To avoid the warning call the <a href="#finish"><code>finish</code></a> method on the active handles.</p>
<p>
</p>
<h3><a name="ping"><code>ping</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">ping</span><span class="operator">;</span>
</pre>
<p>Attempts to determine, in a reasonably efficient way, if the database
server is still running and the connection to it is still working.
Individual drivers should implement this function in the most suitable
manner for their database engine.</p>
<p>The current <em>default</em> implementation always returns true without
actually doing anything. Actually, it returns &quot;<code>0 but true</code>&quot; which is
true but zero. That way you can tell if the return value is genuine or
just the default. Drivers should override this method with one that
does the right thing for their type of database.</p>
<p>Few applications would have direct use for this method. See the specialized
Apache::DBI module for one example usage.</p>
<p>
</p>
<h3><a name="get_info"><code>get_info</code></a></h3>
<pre>
  <span class="variable">$value</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">(</span> <span class="variable">$info_type</span> <span class="operator">);</span>
</pre>
<p>Returns information about the implementation, i.e. driver and data
source capabilities, restrictions etc. It returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> for
unknown or unimplemented information types. For example:</p>
<pre>
  <span class="variable">$database_version</span>  <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">(</span>  <span class="number">18</span> <span class="operator">);</span> <span class="comment"># SQL_DBMS_VER</span>
  <span class="variable">$max_select_tables</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">(</span> <span class="number">106</span> <span class="operator">);</span> <span class="comment"># SQL_MAXIMUM_TABLES_IN_SELECT</span>
</pre>
<p>See <a href="#standards_reference_information">Standards Reference Information</a> for more detailed information
about the information types and their meanings and possible return values.</p>
<p>The DBI::Const::GetInfoType module exports a %GetInfoType hash that
can be used to map info type names to numbers. For example:</p>
<pre>
  <span class="variable">$database_version</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">(</span> <span class="variable">$GetInfoType</span><span class="operator">{</span><span class="string">SQL_DBMS_VER</span><span class="operator">}</span> <span class="operator">);</span>
</pre>
<p>The names are a merging of the ANSI and ODBC standards (which differ
in some cases). See <a href="../lib/DBI/Const/GetInfoType.html">the DBI::Const::GetInfoType manpage</a> for more details.</p>
<p>Because some DBI methods make use of <code>get_info()</code>, drivers are strongly
encouraged to support <em>at least</em> the following very minimal set
of information types to ensure the DBI itself works properly:</p>
<pre>
 Type  Name                        Example A     Example B
 ----  --------------------------  ------------  ----------------
   17  SQL_DBMS_NAME               'ACCESS'      'Oracle'
   18  SQL_DBMS_VER                '03.50.0000'  '08.01.0721 ...'
   29  SQL_IDENTIFIER_QUOTE_CHAR   '`'           '&quot;'
   41  SQL_CATALOG_NAME_SEPARATOR  '.'           '@'
  114  SQL_CATALOG_LOCATION        1             2</pre>
<p>
</p>
<h3><a name="table_info"><code>table_info</code></a></h3>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">table_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span> <span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">table_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Returns an active statement handle that can be used to fetch
information about tables and views that exist in the database.</p>
<p>The arguments $catalog, $schema and $table may accept search patterns
according to the database/driver, for example: $table = '%FOO%';
Remember that the underscore character ('<code>_</code>') is a search pattern
that means match any character, so 'FOO_%' is the same as 'FOO%'
and 'FOO_BAR%' will match names like 'FOO1BAR'.</p>
<p>The value of $type is a comma-separated list of one or more types of
tables to be returned in the result set. Each value may optionally be
quoted, e.g.:</p>
<pre>
  <span class="variable">$type</span> <span class="operator">=</span> <span class="string">"TABLE"</span><span class="operator">;</span>
  <span class="variable">$type</span> <span class="operator">=</span> <span class="string">"'TABLE','VIEW'"</span><span class="operator">;</span>
</pre>
<p>In addition the following special cases may also be supported by some drivers:</p>
<ul>
<li><strong><a name="if_the_value_of_catalog_is_and_schema_and_table_name_are_empty_strings_the_result_set_contains_a_list_of_catalog_names_for_example" class="item">If the value of $catalog is '%' and $schema and $table name
are empty strings, the result set contains a list of catalog names.
For example:</a></strong>

<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">table_info</span><span class="operator">(</span><span class="string">'%'</span><span class="operator">,</span> <span class="string">''</span><span class="operator">,</span> <span class="string">''</span><span class="operator">);</span>
</pre>
<li><strong><a name="if_the_value_of_schema_is_and_catalog_and_table_are_empty_strings_the_result_set_contains_a_list_of_schema_names" class="item">If the value of $schema is '%' and $catalog and $table are empty
strings, the result set contains a list of schema names.</a></strong>

<li><strong><a name="if_the_value_of_type_is_and_catalog_schema_and_table_are_all_empty_strings_the_result_set_contains_a_list_of_table_types" class="item">If the value of $type is '%' and $catalog, $schema, and $table are all
empty strings, the result set contains a list of table types.</a></strong>

</ul>
<p>If your driver doesn't support one or more of the selection filter
parameters then you may get back more than you asked for and can
do the filtering yourself.</p>
<p>This method can be expensive, and can return a large amount of data.
(For example, small Oracle installation returns over 2000 rows.)
So it's a good idea to use the filters to limit the data as much as possible.</p>
<p>The statement handle returned has at least the following fields in the
order show below. Other fields, after these, may also be present.</p>
<p><strong>TABLE_CAT</strong>: Table catalog identifier. This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not
applicable to the data source, which is usually the case. This field
is empty if not applicable to the table.</p>
<p><strong>TABLE_SCHEM</strong>: The name of the schema containing the TABLE_NAME value.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to data source, and
empty if not applicable to the table.</p>
<p><strong>TABLE_NAME</strong>: Name of the table (or view, synonym, etc).</p>
<p><strong>TABLE_TYPE</strong>: One of the following: &quot;TABLE&quot;, &quot;VIEW&quot;, &quot;SYSTEM TABLE&quot;,
&quot;GLOBAL TEMPORARY&quot;, &quot;LOCAL TEMPORARY&quot;, &quot;ALIAS&quot;, &quot;SYNONYM&quot; or a type
identifier that is specific to the data
source.</p>
<p><strong>REMARKS</strong>: A description of the table. May be NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).</p>
<p>Note that <code>table_info</code> might not return records for all tables.
Applications can use any valid table regardless of whether it's
returned by <code>table_info</code>.</p>
<p>See also <a href="#tables">tables</a>, <a href="#catalog_methods">Catalog Methods</a> and
<a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="column_info"><code>column_info</code></a></h3>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">column_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$column</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Returns an active statement handle that can be used to fetch
information about columns in specified tables.</p>
<p>The arguments $schema, $table and $column may accept search patterns
according to the database/driver, for example: $table = '%FOO%';</p>
<p>Note: The support for the selection criteria is driver specific. If the
driver doesn't support one or more of them then you may get back more
than you asked for and can do the filtering yourself.</p>
<p>If the arguments don't match any tables then you'll still get a statement
handle, it'll just return no rows.</p>
<p>The statement handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be present.</p>
<p><strong>TABLE_CAT</strong>: The catalog identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
which is often the case.  This field is empty if not applicable to the
table.</p>
<p><strong>TABLE_SCHEM</strong>: The schema identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
and empty if not applicable to the table.</p>
<p><strong>TABLE_NAME</strong>: The table identifier.
Note: A driver may provide column metadata not only for base tables, but
also for derived objects like SYNONYMS etc.</p>
<p><strong>COLUMN_NAME</strong>: The column identifier.</p>
<p><strong>DATA_TYPE</strong>: The concise data type code.</p>
<p><strong>TYPE_NAME</strong>: A data source dependent data type name.</p>
<p><strong>COLUMN_SIZE</strong>: The column size.
This is the maximum length in characters for character data types,
the number of digits or bits for numeric data types or the length
in the representation of temporal types.
See the relevant specifications for detailed information.</p>
<p><strong>BUFFER_LENGTH</strong>: The length in bytes of transferred data.</p>
<p><strong>DECIMAL_DIGITS</strong>: The total number of significant digits to the right of
the decimal point.</p>
<p><strong>NUM_PREC_RADIX</strong>: The radix for numeric precision.
The value is 10 or 2 for numeric data types and NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not
applicable.</p>
<p><strong>NULLABLE</strong>: Indicates if a column can accept NULLs.
The following values are defined:</p>
<pre>
  SQL_NO_NULLS          0
  SQL_NULLABLE          1
  SQL_NULLABLE_UNKNOWN  2</pre>
<p><strong>REMARKS</strong>: A description of the column.</p>
<p><strong>COLUMN_DEF</strong>: The default value of the column.</p>
<p><strong>SQL_DATA_TYPE</strong>: The SQL data type.</p>
<p><strong>SQL_DATETIME_SUB</strong>: The subtype code for datetime and interval data types.</p>
<p><strong>CHAR_OCTET_LENGTH</strong>: The maximum length in bytes of a character or binary
data type column.</p>
<p><strong>ORDINAL_POSITION</strong>: The column sequence number (starting with 1).</p>
<p><strong>IS_NULLABLE</strong>: Indicates if the column can accept NULLs.
Possible values are: 'NO', 'YES' and ''.</p>
<p>SQL/CLI defines the following additional columns:</p>
<pre>
  CHAR_SET_CAT
  CHAR_SET_SCHEM
  CHAR_SET_NAME
  COLLATION_CAT
  COLLATION_SCHEM
  COLLATION_NAME
  UDT_CAT
  UDT_SCHEM
  UDT_NAME
  DOMAIN_CAT
  DOMAIN_SCHEM
  DOMAIN_NAME
  SCOPE_CAT
  SCOPE_SCHEM
  SCOPE_NAME
  MAX_CARDINALITY
  DTD_IDENTIFIER
  IS_SELF_REF</pre>
<p>Drivers capable of supplying any of those values should do so in
the corresponding column and supply undef values for the others.</p>
<p>Drivers wishing to provide extra database/driver specific information
should do so in extra columns beyond all those listed above, and
use lowercase field names with the driver-specific prefix (i.e.,
'ora_...'). Applications accessing such fields should do so by name
and not by column number.</p>
<p>The result set is ordered by TABLE_CAT, TABLE_SCHEM, TABLE_NAME
and ORDINAL_POSITION.</p>
<p>Note: There is some overlap with statement attributes (in perl) and
SQLDescribeCol (in ODBC). However, SQLColumns provides more metadata.</p>
<p>See also <a href="#catalog_methods">Catalog Methods</a> and <a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="primary_key_info"><code>primary_key_info</code></a></h3>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">primary_key_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Returns an active statement handle that can be used to fetch information
about columns that make up the primary key for a table.
The arguments don't accept search patterns (unlike table_info()).</p>
<p>The statement handle will return one row per column, ordered by
TABLE_CAT, TABLE_SCHEM, TABLE_NAME, and KEY_SEQ.
If there is no primary key then the statement handle will fetch no rows.</p>
<p>Note: The support for the selection criteria, such as $catalog, is
driver specific.  If the driver doesn't support catalogs and/or
schemas, it may ignore these criteria.</p>
<p>The statement handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be present.</p>
<p><strong>TABLE_CAT</strong>: The catalog identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
which is often the case.  This field is empty if not applicable to the
table.</p>
<p><strong>TABLE_SCHEM</strong>: The schema identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
and empty if not applicable to the table.</p>
<p><strong>TABLE_NAME</strong>: The table identifier.</p>
<p><strong>COLUMN_NAME</strong>: The column identifier.</p>
<p><strong>KEY_SEQ</strong>: The column sequence number (starting with 1).
Note: This field is named <strong>ORDINAL_POSITION</strong> in SQL/CLI.</p>
<p><strong>PK_NAME</strong>: The primary key constraint identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source.</p>
<p>See also <a href="#catalog_methods">Catalog Methods</a> and <a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="primary_key"><code>primary_key</code></a></h3>
<pre>
  <span class="variable">@key_column_names</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">primary_key</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span> <span class="operator">);</span>
</pre>
<p>Simple interface to the <code>primary_key_info()</code> method. Returns a list of
the column names that comprise the primary key of the specified table.
The list is in primary key column sequence order.
If there is no primary key then an empty list is returned.</p>
<p>
</p>
<h3><a name="foreign_key_info"><code>foreign_key_info</code></a></h3>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">foreign_key_info</span><span class="operator">(</span> <span class="variable">$pk_catalog</span><span class="operator">,</span> <span class="variable">$pk_schema</span><span class="operator">,</span> <span class="variable">$pk_table</span>
                               <span class="operator">,</span> <span class="variable">$fk_catalog</span><span class="operator">,</span> <span class="variable">$fk_schema</span><span class="operator">,</span> <span class="variable">$fk_table</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">foreign_key_info</span><span class="operator">(</span> <span class="variable">$pk_catalog</span><span class="operator">,</span> <span class="variable">$pk_schema</span><span class="operator">,</span> <span class="variable">$pk_table</span>
                               <span class="operator">,</span> <span class="variable">$fk_catalog</span><span class="operator">,</span> <span class="variable">$fk_schema</span><span class="operator">,</span> <span class="variable">$fk_table</span>
                               <span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Returns an active statement handle that can be used to fetch information
about foreign keys in and/or referencing the specified table(s).
The arguments don't accept search patterns (unlike table_info()).</p>
<p><code>$pk_catalog</code>, <code>$pk_schema</code>, <code>$pk_table</code>
identify the primary (unique) key table (<strong>PKT</strong>).</p>
<p><code>$fk_catalog</code>, <code>$fk_schema</code>, <code>$fk_table</code>
identify the foreign key table (<strong>FKT</strong>).</p>
<p>If both <strong>PKT</strong> and <strong>FKT</strong> are given, the function returns the foreign key, if
any, in table <strong>FKT</strong> that refers to the primary (unique) key of table <strong>PKT</strong>.
(Note: In SQL/CLI, the result is implementation-defined.)</p>
<p>If only <strong>PKT</strong> is given, then the result set contains the primary key
of that table and all foreign keys that refer to it.</p>
<p>If only <strong>FKT</strong> is given, then the result set contains all foreign keys
in that table and the primary keys to which they refer.
(Note: In SQL/CLI, the result includes unique keys too.)</p>
<p>For example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">foreign_key_info</span><span class="operator">(</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="string">'master'</span><span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">foreign_key_info</span><span class="operator">(</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span>   <span class="keyword">undef</span> <span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="string">'detail'</span><span class="operator">);</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">foreign_key_info</span><span class="operator">(</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="string">'master'</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="string">'detail'</span><span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Note: The support for the selection criteria, such as <code>$catalog</code>, is
driver specific.  If the driver doesn't support catalogs and/or
schemas, it may ignore these criteria.</p>
<p>The statement handle returned has the following fields in the order shown below.
Because ODBC never includes unique keys, they define different columns in the
result set than SQL/CLI. SQL/CLI column names are shown in parentheses.</p>
<p><strong>PKTABLE_CAT    ( UK_TABLE_CAT      )</strong>:
The primary (unique) key table catalog identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
which is often the case.  This field is empty if not applicable to the
table.</p>
<p><strong>PKTABLE_SCHEM  ( UK_TABLE_SCHEM    )</strong>:
The primary (unique) key table schema identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
and empty if not applicable to the table.</p>
<p><strong>PKTABLE_NAME   ( UK_TABLE_NAME     )</strong>:
The primary (unique) key table identifier.</p>
<p><strong>PKCOLUMN_NAME  (UK_COLUMN_NAME    )</strong>:
The primary (unique) key column identifier.</p>
<p><strong>FKTABLE_CAT    ( FK_TABLE_CAT      )</strong>:
The foreign key table catalog identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
which is often the case.  This field is empty if not applicable to the
table.</p>
<p><strong>FKTABLE_SCHEM  ( FK_TABLE_SCHEM    )</strong>:
The foreign key table schema identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
and empty if not applicable to the table.</p>
<p><strong>FKTABLE_NAME   ( FK_TABLE_NAME     )</strong>:
The foreign key table identifier.</p>
<p><strong>FKCOLUMN_NAME  ( FK_COLUMN_NAME    )</strong>:
The foreign key column identifier.</p>
<p><strong>KEY_SEQ        ( ORDINAL_POSITION  )</strong>:
The column sequence number (starting with 1).</p>
<p><strong>UPDATE_RULE    ( UPDATE_RULE       )</strong>:
The referential action for the UPDATE rule.
The following codes are defined:</p>
<pre>
  CASCADE              0
  RESTRICT             1
  SET NULL             2
  NO ACTION            3
  SET DEFAULT          4</pre>
<p><strong>DELETE_RULE    ( DELETE_RULE       )</strong>:
The referential action for the DELETE rule.
The codes are the same as for UPDATE_RULE.</p>
<p><strong>FK_NAME        ( FK_NAME           )</strong>:
The foreign key name.</p>
<p><strong>PK_NAME        ( UK_NAME           )</strong>:
The primary (unique) key name.</p>
<p><strong>DEFERRABILITY  ( DEFERABILITY      )</strong>:
The deferrability of the foreign key constraint.
The following codes are defined:</p>
<pre>
  INITIALLY DEFERRED   5
  INITIALLY IMMEDIATE  6
  NOT DEFERRABLE       7</pre>
<p><strong>               ( UNIQUE_OR_PRIMARY )</strong>:
This column is necessary if a driver includes all candidate (i.e. primary and
alternate) keys in the result set (as specified by SQL/CLI).
The value of this column is UNIQUE if the foreign key references an alternate
key and PRIMARY if the foreign key references a primary key, or it
may be undefined if the driver doesn't have access to the information.</p>
<p>See also <a href="#catalog_methods">Catalog Methods</a> and <a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="statistics_info"><code>statistics_info</code></a></h3>
<p><strong>Warning:</strong> This method is experimental and may change.</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">statistics_info</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$unique_only</span><span class="operator">,</span> <span class="variable">$quick</span> <span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># then $sth-&gt;fetchall_arrayref or $sth-&gt;fetchall_hashref etc</span>
</pre>
<p>Returns an active statement handle that can be used to fetch statistical
information about a table and its indexes.</p>
<p>The arguments don't accept search patterns (unlike <a href="#table_info">table_info</a>).</p>
<p>If the boolean argument $unique_only is true, only UNIQUE indexes will be
returned in the result set, otherwise all indexes will be returned.</p>
<p>If the boolean argument $quick is set, the actual statistical information
columns (CARDINALITY and PAGES) will only be returned if they are readily
available from the server, and might not be current.  Some databases may
return stale statistics or no statistics at all with this flag set.</p>
<p>The statement handle will return at most one row per column name per index,
plus at most one row for the entire table itself, ordered by NON_UNIQUE, TYPE,
INDEX_QUALIFIER, INDEX_NAME, and ORDINAL_POSITION.</p>
<p>Note: The support for the selection criteria, such as $catalog, is
driver specific.  If the driver doesn't support catalogs and/or
schemas, it may ignore these criteria.</p>
<p>The statement handle returned has at least the following fields in the
order shown below. Other fields, after these, may also be present.</p>
<p><strong>TABLE_CAT</strong>: The catalog identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
which is often the case.  This field is empty if not applicable to the
table.</p>
<p><strong>TABLE_SCHEM</strong>: The schema identifier.
This field is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if not applicable to the data source,
and empty if not applicable to the table.</p>
<p><strong>TABLE_NAME</strong>: The table identifier.</p>
<p><strong>NON_UNIQUE</strong>: Unique index indicator.
Returns 0 for unique indexes, 1 for non-unique indexes</p>
<p><strong>INDEX_QUALIFIER</strong>: Index qualifier identifier.
The identifier that is used to qualify the index name when doing a
<code>DROP INDEX</code>; NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned if an index qualifier is not
supported by the data source.
If a non-NULL (defined) value is returned in this column, it must be used
to qualify the index name on a <code>DROP INDEX</code> statement; otherwise,
the TABLE_SCHEM should be used to qualify the index name.</p>
<p><strong>INDEX_NAME</strong>: The index identifier.</p>
<p><strong>TYPE</strong>: The type of information being returned.  Can be any of the
following values: 'table', 'btree', 'clustered', 'content', 'hashed',
or 'other'.</p>
<p>In the case that this field is 'table', all fields
other than TABLE_CAT, TABLE_SCHEM, TABLE_NAME, TYPE,
CARDINALITY, and PAGES will be NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).</p>
<p><strong>ORDINAL_POSITION</strong>: Column sequence number (starting with 1).</p>
<p><strong>COLUMN_NAME</strong>: The column identifier.</p>
<p><strong>ASC_OR_DESC</strong>: Column sort sequence.
<a href="../lib/pods/perlguts.html#a"><code>A</code></a> for Ascending, <code>D</code> for Descending, or NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) if
not supported for this index.</p>
<p><strong>CARDINALITY</strong>: Cardinality of the table or index.
For indexes, this is the number of unique values in the index.
For tables, this is the number of rows in the table.
If not supported, the value will be NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).</p>
<p><strong>PAGES</strong>: Number of storage pages used by this table or index.
If not supported, the value will be NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).</p>
<p><strong>FILTER_CONDITION</strong>: The index filter condition as a string.
If the index is not a filtered index, or it cannot be determined
whether the index is a filtered index, this value is NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).
If the index is a filtered index, but the filter condition
cannot be determined, this value is the empty string <code>''</code>.
Otherwise it will be the literal filter condition as a string,
such as <code>SALARY &lt;= 4500</code>.</p>
<p>See also <a href="#catalog_methods">Catalog Methods</a> and <a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="tables"><code>tables</code></a></h3>
<pre>
  <span class="variable">@names</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">tables</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="variable">$type</span> <span class="operator">);</span>
  <span class="variable">@names</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">tables</span><span class="operator">;</span>        <span class="comment"># deprecated</span>
</pre>
<p>Simple interface to <code>table_info()</code>. Returns a list of matching
table names, possibly including a catalog/schema prefix.</p>
<p>See <a href="#table_info">table_info</a> for a description of the parameters.</p>
<p>If <code>$dbh-&gt;get_info(29)</code> returns true (29 is SQL_IDENTIFIER_QUOTE_CHAR)
then the table names are constructed and quoted by <a href="#quote_identifier">quote_identifier</a>
to ensure they are usable even if they contain whitespace or reserved
words etc. This means that the table names returned will include
quote characters.</p>
<p>
</p>
<h3><a name="type_info_all"><code>type_info_all</code></a></h3>
<pre>
  <span class="variable">$type_info_all</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">type_info_all</span><span class="operator">;</span>
</pre>
<p>Returns a reference to an array which holds information about each data
type variant supported by the database and driver. The array and its
contents should be treated as read-only.</p>
<p>The first item is a reference to an 'index' hash of <code>Name =</code>&gt; <code>Index</code> pairs.
The items following that are references to arrays, one per supported data
type variant. The leading index hash defines the names and order of the
fields within the arrays that follow it.
For example:</p>
<pre>
  <span class="variable">$type_info_all</span> <span class="operator">=</span> <span class="operator">[</span>
    <span class="operator">{</span>   <span class="string">TYPE_NAME</span>         <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span>
        <span class="string">DATA_TYPE</span>         <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span>
        <span class="string">COLUMN_SIZE</span>       <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">,</span>     <span class="comment"># was PRECISION originally</span>
        <span class="string">LITERAL_PREFIX</span>    <span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">,</span>
        <span class="string">LITERAL_SUFFIX</span>    <span class="operator">=&gt;</span> <span class="number">4</span><span class="operator">,</span>
        <span class="string">CREATE_PARAMS</span>     <span class="operator">=&gt;</span> <span class="number">5</span><span class="operator">,</span>
        <span class="string">NULLABLE</span>          <span class="operator">=&gt;</span> <span class="number">6</span><span class="operator">,</span>
        <span class="string">CASE_SENSITIVE</span>    <span class="operator">=&gt;</span> <span class="number">7</span><span class="operator">,</span>
        <span class="string">SEARCHABLE</span>        <span class="operator">=&gt;</span> <span class="number">8</span><span class="operator">,</span>
        <span class="string">UNSIGNED_ATTRIBUTE</span><span class="operator">=&gt;</span> <span class="number">9</span><span class="operator">,</span>
        <span class="string">FIXED_PREC_SCALE</span>  <span class="operator">=&gt;</span> <span class="number">10</span><span class="operator">,</span>    <span class="comment"># was MONEY originally</span>
        <span class="string">AUTO_UNIQUE_VALUE</span> <span class="operator">=&gt;</span> <span class="number">11</span><span class="operator">,</span>    <span class="comment"># was AUTO_INCREMENT originally</span>
        <span class="string">LOCAL_TYPE_NAME</span>   <span class="operator">=&gt;</span> <span class="number">12</span><span class="operator">,</span>
        <span class="string">MINIMUM_SCALE</span>     <span class="operator">=&gt;</span> <span class="number">13</span><span class="operator">,</span>
        <span class="string">MAXIMUM_SCALE</span>     <span class="operator">=&gt;</span> <span class="number">14</span><span class="operator">,</span>
        <span class="string">SQL_DATA_TYPE</span>     <span class="operator">=&gt;</span> <span class="number">15</span><span class="operator">,</span>
        <span class="string">SQL_DATETIME_SUB</span>  <span class="operator">=&gt;</span> <span class="number">16</span><span class="operator">,</span>
        <span class="string">NUM_PREC_RADIX</span>    <span class="operator">=&gt;</span> <span class="number">17</span><span class="operator">,</span>
        <span class="string">INTERVAL_PRECISION</span><span class="operator">=&gt;</span> <span class="number">18</span><span class="operator">,</span>
    <span class="operator">}</span><span class="operator">,</span>
    <span class="operator">[</span> <span class="string">'VARCHAR'</span><span class="operator">,</span> <span class="variable">SQL_VARCHAR</span><span class="operator">,</span>
        <span class="keyword">undef</span><span class="operator">,</span> <span class="string">"'"</span><span class="operator">,</span><span class="string">"'"</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="keyword">undef</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="number">255</span><span class="operator">,</span> <span class="keyword">undef</span>
    <span class="operator">]</span><span class="operator">,</span>
    <span class="operator">[</span> <span class="string">'INTEGER'</span><span class="operator">,</span> <span class="variable">SQL_INTEGER</span><span class="operator">,</span>
        <span class="keyword">undef</span><span class="operator">,</span>  <span class="string">""</span><span class="operator">,</span> <span class="string">""</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span><span class="number">1</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span><span class="keyword">undef</span><span class="operator">,</span><span class="number">0</span><span class="operator">,</span>  <span class="number">0</span><span class="operator">,</span> <span class="number">10</span>
    <span class="operator">]</span><span class="operator">,</span>
  <span class="operator">]</span><span class="operator">;</span>
</pre>
<p>More than one row may have the same value in the <a href="#data_type"><code>DATA_TYPE</code></a>
field if there are different ways to spell the type name and/or there
are variants of the type with different attributes (e.g., with and
without <a href="#auto_unique_value"><code>AUTO_UNIQUE_VALUE</code></a> set, with and without <a href="#unsigned_attribute"><code>UNSIGNED_ATTRIBUTE</code></a>, etc).</p>
<p>The rows are ordered by <a href="#data_type"><code>DATA_TYPE</code></a> first and then by how closely each
type maps to the corresponding ODBC SQL data type, closest first.</p>
<p>The meaning of the fields is described in the documentation for
the <a href="#type_info">type_info</a> method.</p>
<p>An 'index' hash is provided so you don't need to rely on index
values defined above.  However, using DBD::ODBC with some old ODBC
drivers may return older names, shown as comments in the example above.
Another issue with the index hash is that the lettercase of the
keys is not defined. It is usually uppercase, as show here, but
drivers may return names with any lettercase.</p>
<p>Drivers are also free to return extra driver-specific columns of
information - though it's recommended that they start at column
index 50 to leave room for expansion of the DBI/ODBC specification.</p>
<p>The <code>type_info_all()</code> method is not normally used directly.
The <a href="#type_info">type_info</a> method provides a more usable and useful interface
to the data.</p>
<p>
</p>
<h3><a name="type_info"><code>type_info</code></a></h3>
<pre>
  <span class="variable">@type_info</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">type_info</span><span class="operator">(</span><span class="variable">$data_type</span><span class="operator">);</span>
</pre>
<p>Returns a list of hash references holding information about one or more
variants of $data_type. The list is ordered by <a href="#data_type"><code>DATA_TYPE</code></a> first and
then by how closely each type maps to the corresponding ODBC SQL data
type, closest first.  If called in a scalar context then only the first
(best) element is returned.</p>
<p>If $data_type is undefined or <code>SQL_ALL_TYPES</code>, then the list will
contain hashes for all data type variants supported by the database and driver.</p>
<p>If $data_type is an array reference then <code>type_info</code> returns the
information for the <em>first</em> type in the array that has any matches.</p>
<p>The keys of the hash follow the same letter case conventions as the
rest of the DBI (see <a href="#naming_conventions_and_name_space">Naming Conventions and Name Space</a>). The
following uppercase items should always exist, though may be undef:</p>
<dl>
<dt><strong><a name="type_name" class="item">TYPE_NAME (string)</a></strong>

<dd>
<p>Data type name for use in CREATE TABLE statements etc.</p>
</dd>
</li>
<dt><strong><a name="data_type" class="item">DATA_TYPE (integer)</a></strong>

<dd>
<p>SQL data type number.</p>
</dd>
</li>
<dt><strong><a name="column_size" class="item">COLUMN_SIZE (integer)</a></strong>

<dd>
<p>For numeric types, this is either the total number of digits (if the
NUM_PREC_RADIX value is 10) or the total number of bits allowed in the
column (if NUM_PREC_RADIX is 2).</p>
</dd>
<dd>
<p>For string types, this is the maximum size of the string in characters.</p>
</dd>
<dd>
<p>For date and interval types, this is the maximum number of characters
needed to display the value.</p>
</dd>
</li>
<dt><strong><a name="literal_prefix" class="item">LITERAL_PREFIX (string)</a></strong>

<dd>
<p>Characters used to prefix a literal. A typical prefix is &quot;<code>'</code>&quot; for characters,
or possibly &quot;<code>0x</code>&quot; for binary values passed as hexadecimal.  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is
returned for data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="literal_suffix" class="item">LITERAL_SUFFIX (string)</a></strong>

<dd>
<p>Characters used to suffix a literal. Typically &quot;<code>'</code>&quot; for characters.
NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned for data types where this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="create_params" class="item">CREATE_PARAMS (string)</a></strong>

<dd>
<p>Parameter names for data type definition. For example, <a href="#create_params"><code>CREATE_PARAMS</code></a> for a
<code>DECIMAL</code> would be &quot;<code>precision,scale</code>&quot; if the DECIMAL type should be
declared as <code>DECIMAL(</code><em>precision,scale</em><code>)</code> where <em>precision</em> and <em>scale</em>
are integer values.  For a <code>VARCHAR</code> it would be &quot;<code>max length</code>&quot;.
NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned for data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="nullable" class="item">NULLABLE (integer)</a></strong>

<dd>
<p>Indicates whether the data type accepts a NULL value:
<code>0</code> or an empty string = no, <code>1</code> = yes, <code>2</code> = unknown.</p>
</dd>
</li>
<dt><strong><a name="case_sensitive" class="item">CASE_SENSITIVE (boolean)</a></strong>

<dd>
<p>Indicates whether the data type is case sensitive in collations and
comparisons.</p>
</dd>
</li>
<dt><strong><a name="searchable" class="item">SEARCHABLE (integer)</a></strong>

<dd>
<p>Indicates how the data type can be used in a WHERE clause, as
follows:</p>
</dd>
<dd>
<pre>
  0 - Cannot be used in a WHERE clause
  1 - Only with a LIKE predicate
  2 - All comparison operators except LIKE
  3 - Can be used in a WHERE clause with any comparison operator</pre>
</dd>
</li>
<dt><strong><a name="unsigned_attribute" class="item">UNSIGNED_ATTRIBUTE (boolean)</a></strong>

<dd>
<p>Indicates whether the data type is unsigned.  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned
for data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="fixed_prec_scale" class="item">FIXED_PREC_SCALE (boolean)</a></strong>

<dd>
<p>Indicates whether the data type always has the same precision and scale
(such as a money type).  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned for data types
for which
this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="auto_unique_value" class="item">AUTO_UNIQUE_VALUE (boolean)</a></strong>

<dd>
<p>Indicates whether a column of this data type is automatically set to a
unique value whenever a new row is inserted.  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned
for data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="local_type_name" class="item">LOCAL_TYPE_NAME (string)</a></strong>

<dd>
<p>Localized version of the <a href="#type_name"><code>TYPE_NAME</code></a> for use in dialog with users.
NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned if a localized name is not available (in which
case <a href="#type_name"><code>TYPE_NAME</code></a> should be used).</p>
</dd>
</li>
<dt><strong><a name="minimum_scale" class="item">MINIMUM_SCALE (integer)</a></strong>

<dd>
<p>The minimum scale of the data type. If a data type has a fixed scale,
then <a href="#maximum_scale"><code>MAXIMUM_SCALE</code></a> holds the same value.  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned for
data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="maximum_scale" class="item">MAXIMUM_SCALE (integer)</a></strong>

<dd>
<p>The maximum scale of the data type. If a data type has a fixed scale,
then <a href="#minimum_scale"><code>MINIMUM_SCALE</code></a> holds the same value.  NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned for
data types for which this is not applicable.</p>
</dd>
</li>
<dt><strong><a name="sql_data_type" class="item">SQL_DATA_TYPE (integer)</a></strong>

<dd>
<p>This column is the same as the <a href="#data_type"><code>DATA_TYPE</code></a> column, except for interval
and datetime data types.  For interval and datetime data types, the
<a href="#sql_data_type"><code>SQL_DATA_TYPE</code></a> field will return <code>SQL_INTERVAL</code> or <code>SQL_DATETIME</code>, and the
<a href="#sql_datetime_sub"><code>SQL_DATETIME_SUB</code></a> field below will return the subcode for the specific
interval or datetime data type. If this field is NULL, then the driver
does not support or report on interval or datetime subtypes.</p>
</dd>
</li>
<dt><strong><a name="sql_datetime_sub" class="item">SQL_DATETIME_SUB (integer)</a></strong>

<dd>
<p>For interval or datetime data types, where the <a href="#sql_data_type"><code>SQL_DATA_TYPE</code></a>
field above is <code>SQL_INTERVAL</code> or <code>SQL_DATETIME</code>, this field will
hold the <em>subcode</em> for the specific interval or datetime data type.
Otherwise it will be NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>).</p>
</dd>
<dd>
<p>Although not mentioned explicitly in the standards, it seems there
is a simple relationship between these values:</p>
</dd>
<dd>
<pre>
  DATA_TYPE == (10 * SQL_DATA_TYPE) + SQL_DATETIME_SUB</pre>
</dd>
</li>
<dt><strong><a name="num_prec_radix" class="item">NUM_PREC_RADIX (integer)</a></strong>

<dd>
<p>The radix value of the data type. For approximate numeric types,
<a href="#num_prec_radix"><code>NUM_PREC_RADIX</code></a>
contains the value 2 and <a href="#column_size"><code>COLUMN_SIZE</code></a> holds the number of bits. For
exact numeric types, <a href="#num_prec_radix"><code>NUM_PREC_RADIX</code></a> contains the value 10 and <a href="#column_size"><code>COLUMN_SIZE</code></a> holds
the number of decimal digits. NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) is returned either for data types
for which this is not applicable or if the driver cannot report this information.</p>
</dd>
</li>
<dt><strong><a name="interval_precision" class="item">INTERVAL_PRECISION (integer)</a></strong>

<dd>
<p>The interval leading precision for interval types. NULL is returned
either for data types for which this is not applicable or if the driver
cannot report this information.</p>
</dd>
</li>
</dl>
<p>For example, to find the type name for the fields in a select statement
you can do:</p>
<pre>
  <span class="variable">@names</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="keyword">scalar</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">type_info</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">TYPE_NAME</span><span class="operator">}</span> <span class="operator">}</span> <span class="variable">@</span><span class="operator">{</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">TYPE</span><span class="operator">}</span> <span class="operator">}</span>
</pre>
<p>Since DBI and ODBC drivers vary in how they map their types into the
ISO standard types you may need to search for more than one type.
Here's an example looking for a usable type to store a date:</p>
<pre>
  <span class="variable">$my_date_type</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">type_info</span><span class="operator">(</span> <span class="operator">[</span> <span class="variable">SQL_DATE</span><span class="operator">,</span> <span class="variable">SQL_TIMESTAMP</span> <span class="operator">]</span> <span class="operator">);</span>
</pre>
<p>Similarly, to more reliably find a type to store small integers, you could
use a list starting with <code>SQL_SMALLINT</code>, <code>SQL_INTEGER</code>, <code>SQL_DECIMAL</code>, etc.</p>
<p>See also <a href="#standards_reference_information">Standards Reference Information</a>.</p>
<p>
</p>
<h3><a name="quote"><code>quote</code></a></h3>
<pre>
  <span class="variable">$sql</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">);</span>
  <span class="variable">$sql</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote</span><span class="operator">(</span><span class="variable">$value</span><span class="operator">,</span> <span class="variable">$data_type</span><span class="operator">);</span>
</pre>
<p>Quote a string literal for use as a literal value in an SQL statement,
by escaping any special characters (such as quotation marks)
contained within the string and adding the required type of outer
quotation marks.</p>
<pre>
  <span class="variable">$sql</span> <span class="operator">=</span> <span class="keyword">sprintf</span> <span class="string">"SELECT foo FROM bar WHERE baz = %s"</span><span class="operator">,</span>
                <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote</span><span class="operator">(</span><span class="string">"Don't"</span><span class="operator">);</span>
</pre>
<p>For most database types, at least those that conform to SQL standards, quote
would return <code>'Don''t'</code> (including the outer quotation marks). For others it
may return something like <code>'Don\'t'</code></p>
<p>An undefined <code>$value</code> value will be returned as the string <code>NULL</code> (without
single quotation marks) to match how NULLs are represented in SQL.</p>
<p>If <code>$data_type</code> is supplied, it is used to try to determine the required
quoting behaviour by using the information returned by <a href="#type_info">type_info</a>.
As a special case, the standard numeric types are optimized to return
<code>$value</code> without calling <code>type_info</code>.</p>
<p>Quote will probably <em>not</em> be able to deal with all possible input
(such as binary data or data containing newlines), and is not related in
any way with escaping or quoting shell meta-characters.</p>
<p>It is valid for the <code>quote()</code> method to return an SQL expression that
evaluates to the desired string. For example:</p>
<pre>
  $quoted = $dbh-&gt;quote(&quot;one\ntwo\0three&quot;)</pre>
<p>may return something like:</p>
<pre>
  CONCAT('one', CHAR(12), 'two', CHAR(0), 'three')</pre>
<p>The <code>quote()</code> method should <em>not</em> be used with <a href="#placeholders_and_bind_values">Placeholders and Bind Values</a>.</p>
<p>
</p>
<h3><a name="quote_identifier"><code>quote_identifier</code></a></h3>
<pre>
  <span class="variable">$sql</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote_identifier</span><span class="operator">(</span> <span class="variable">$name</span> <span class="operator">);</span>
  <span class="variable">$sql</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote_identifier</span><span class="operator">(</span> <span class="variable">$catalog</span><span class="operator">,</span> <span class="variable">$schema</span><span class="operator">,</span> <span class="variable">$table</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span> <span class="operator">);</span>
</pre>
<p>Quote an identifier (table name etc.) for use in an SQL statement,
by escaping any special characters (such as double quotation marks)
it contains and adding the required type of outer quotation marks.</p>
<p>Undefined names are ignored and the remainder are quoted and then
joined together, typically with a dot (<code>.</code>) character. For example:</p>
<pre>
  <span class="variable">$id</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote_identifier</span><span class="operator">(</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="string">'Her schema'</span><span class="operator">,</span> <span class="string">'My table'</span> <span class="operator">);</span>
</pre>
<p>would, for most database types, return <code>&quot;Her schema&quot;.&quot;My table&quot;</code>
(including all the double quotation marks).</p>
<p>If three names are supplied then the first is assumed to be a
catalog name and special rules may be applied based on what <a href="#get_info">get_info</a>
returns for SQL_CATALOG_NAME_SEPARATOR (41) and SQL_CATALOG_LOCATION (114).
For example, for Oracle:</p>
<pre>
  <span class="variable">$id</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">quote_identifier</span><span class="operator">(</span> <span class="string">'link'</span><span class="operator">,</span> <span class="string">'schema'</span><span class="operator">,</span> <span class="string">'table'</span> <span class="operator">);</span>
</pre>
<p>would return <code>&quot;schema&quot;.&quot;table&quot;@&quot;link&quot;</code>.</p>
<p>
</p>
<h3><a name="take_imp_data"><code>take_imp_data</code></a></h3>
<pre>
  <span class="variable">$imp_data</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">take_imp_data</span><span class="operator">;</span>
</pre>
<p>Leaves the $dbh in an almost dead, zombie-like, state and returns
a binary string of raw implementation data from the driver which
describes the current database connection. Effectively it detaches
the underlying database API connection data from the DBI handle.
After calling <code>take_imp_data()</code>, all other methods except <code>DESTROY</code>
will generate a warning and return undef.</p>
<p>Why would you want to do this? You don't, forget I even mentioned it.
Unless, that is, you're implementing something advanced like a
multi-threaded connection pool. See <a href="../DBI/Pool.html">the DBI::Pool manpage</a>.</p>
<p>The returned $imp_data can be passed as a <code>dbi_imp_data</code> attribute
to a later <a href="../lib/pods/perlfunc.html#connect"><code>connect()</code></a> call, even in a separate thread in the same
process, where the driver can use it to 'adopt' the existing
connection that the implementation data was taken from.</p>
<p>Some things to keep in mind...</p>
<p><strong>*</strong> the $imp_data holds the only reference to the underlying
database API connection data. That connection is still 'live' and
won't be cleaned up properly unless the $imp_data is used to create
a new $dbh which is then allowed to <code>disconnect()</code> normally.</p>
<p><strong>*</strong> using the same $imp_data to create more than one other new
$dbh at a time may well lead to unpleasant problems. Don't do that.</p>
<p>Any child statement handles are effectively destroyed when <code>take_imp_data()</code> is
called.</p>
<p>The <code>take_imp_data</code> method was added in DBI 1.36 but wasn't useful till 1.49.</p>
<p>
</p>
<h2><a name="database_handle_attributes">Database Handle Attributes</a></h2>
<p>This section describes attributes specific to database handles.</p>
<p>Changes to these database handle attributes do not affect any other
existing or future database handles.</p>
<p>Attempting to set or get the value of an unknown attribute generates a warning,
except for private driver-specific attributes (which all have names
starting with a lowercase letter).</p>
<p>Example:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AutoCommit</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">...;</span>       <span class="comment"># set/write</span>
  <span class="operator">...</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AutoCommit</span><span class="operator">}</span><span class="operator">;</span>       <span class="comment"># get/read</span>
</pre>
<p>
</p>
<h3><a name="autocommit__boolean_"><code>AutoCommit</code>  (boolean)</a></h3>
<p>If true, then database changes cannot be rolled-back (undone).  If false,
then database changes automatically occur within a &quot;transaction&quot;, which
must either be committed or rolled back using the <code>commit</code> or <code>rollback</code>
methods.</p>
<p>Drivers should always default to <code>AutoCommit</code> mode (an unfortunate
choice largely forced on the DBI by ODBC and JDBC conventions.)</p>
<p>Attempting to set <code>AutoCommit</code> to an unsupported value is a fatal error.
This is an important feature of the DBI. Applications that need
full transaction behaviour can set <code>$dbh-&gt;{AutoCommit} = 0</code> (or
set <code>AutoCommit</code> to 0 via <a href="../lib/pods/perlfunc.html#connect">connect</a>)
without having to check that the value was assigned successfully.</p>
<p>For the purposes of this description, we can divide databases into three
categories:</p>
<pre>
  Databases which don't support transactions at all.
  Databases in which a transaction is always active.
  Databases in which a transaction must be explicitly started (C&lt;'BEGIN WORK'&gt;).</pre>
<p><strong>* Databases which don't support transactions at all</strong></p>
<p>For these databases, attempting to turn <code>AutoCommit</code> off is a fatal error.
<code>commit</code> and <code>rollback</code> both issue warnings about being ineffective while
<code>AutoCommit</code> is in effect.</p>
<p><strong>* Databases in which a transaction is always active</strong></p>
<p>These are typically mainstream commercial relational databases with
&quot;ANSI standard&quot; transaction behaviour.
If <code>AutoCommit</code> is off, then changes to the database won't have any
lasting effect unless <a href="#commit">commit</a> is called (but see also
<a href="#disconnect">disconnect</a>). If <a href="#rollback">rollback</a> is called then any changes since the
last commit are undone.</p>
<p>If <code>AutoCommit</code> is on, then the effect is the same as if the DBI
called <code>commit</code> automatically after every successful database
operation. So calling <code>commit</code> or <code>rollback</code> explicitly while
<code>AutoCommit</code> is on would be ineffective because the changes would
have already been commited.</p>
<p>Changing <code>AutoCommit</code> from off to on will trigger a <a href="#commit">commit</a>.</p>
<p>For databases which don't support a specific auto-commit mode, the
driver has to commit each statement automatically using an explicit
<code>COMMIT</code> after it completes successfully (and roll it back using an
explicit <code>ROLLBACK</code> if it fails).  The error information reported to the
application will correspond to the statement which was executed, unless
it succeeded and the commit or rollback failed.</p>
<p><strong>* Databases in which a transaction must be explicitly started</strong></p>
<p>For these databases, the intention is to have them act like databases in
which a transaction is always active (as described above).</p>
<p>To do this, the driver will automatically begin an explicit transaction
when <code>AutoCommit</code> is turned off, or after a <a href="#commit">commit</a> or
<a href="#rollback">rollback</a> (or when the application issues the next database
operation after one of those events).</p>
<p>In this way, the application does not have to treat these databases
as a special case.</p>
<p>See <a href="#commit">commit</a>, <a href="#disconnect">disconnect</a> and <a href="#transactions">Transactions</a> for other important
notes about transactions.</p>
<p>
</p>
<h3><a name="driver__handle_"><code>Driver</code>  (handle)</a></h3>
<p>Holds the handle of the parent driver. The only recommended use for this
is to find the name of the driver using:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Driver</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Name</span><span class="operator">}</span>
</pre>
<p>
</p>
<h3><a name="name__string_"><code>Name</code>  (string)</a></h3>
<p>Holds the &quot;name&quot; of the database. Usually (and recommended to be) the
same as the &quot;<code>dbi:DriverName:...</code>&quot; string used to connect to the database,
but with the leading &quot;<code>dbi:DriverName:</code>&quot; removed.</p>
<p>
</p>
<h3><a name="statement__string__read_only_"><code>Statement</code>  (string, read-only)</a></h3>
<p>Returns the statement string passed to the most recent <a href="#prepare">prepare</a> method
called in this database handle, even if that method failed. This is especially
useful where <code>RaiseError</code> is enabled and the exception handler checks $@
and sees that a 'prepare' method call failed.</p>
<p>
</p>
<h3><a name="rowcachesize__integer_"><code>RowCacheSize</code>  (integer)</a></h3>
<p>A hint to the driver indicating the size of the local row cache that the
application would like the driver to use for future <code>SELECT</code> statements.
If a row cache is not implemented, then setting <code>RowCacheSize</code> is ignored
and getting the value returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.</p>
<p>Some <code>RowCacheSize</code> values have special meaning, as follows:</p>
<pre>
  0 - Automatically determine a reasonable cache size for each C&lt;SELECT&gt;
  1 - Disable the local row cache
 &gt;1 - Cache this many rows
 &lt;0 - Cache as many rows that will fit into this much memory for each C&lt;SELECT&gt;.</pre>
<p>Note that large cache sizes may require a very large amount of memory
(<em>cached rows * maximum size of row</em>). Also, a large cache will cause
a longer delay not only for the first fetch, but also whenever the
cache needs refilling.</p>
<p>See also the <a href="#rowsincache">RowsInCache</a> statement handle attribute.</p>
<p>
</p>
<h3><a name="username__string_"><code>Username</code>  (string)</a></h3>
<p>Returns the username used to connect to the database.</p>
<p>
</p>
<hr />
<h1><a name="dbi_statement_handle_objects">DBI STATEMENT HANDLE OBJECTS</a></h1>
<p>This section lists the methods and attributes associated with DBI
statement handles.</p>
<p>
</p>
<h2><a name="statement_handle_methods">Statement Handle Methods</a></h2>
<p>The DBI defines the following methods for use on DBI statement handles:</p>
<p>
</p>
<h3><a name="bind_param"><code>bind_param</code></a></h3>
<pre>
  $sth-&gt;bind_param($p_num, $bind_value)
  $sth-&gt;bind_param($p_num, $bind_value, \%attr)
  $sth-&gt;bind_param($p_num, $bind_value, $bind_type)</pre>
<p>The <code>bind_param</code> method takes a copy of $bind_value and associates it
(binds it) with a placeholder, identified by $p_num, embedded in
the prepared statement. Placeholders are indicated with question
mark character (<code>?</code>). For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">RaiseError</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>        <span class="comment"># save having to check each method call</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"SELECT name, age FROM people WHERE name LIKE ?"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="string">"John%"</span><span class="operator">);</span>  <span class="comment"># placeholders are numbered from 1</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">DBI::dump_results</span><span class="operator">(</span><span class="variable">$sth</span><span class="operator">);</span>
</pre>
<p>See <a href="#placeholders_and_bind_values">Placeholders and Bind Values</a> for more information.</p>
<p><strong>Data Types for Placeholders</strong></p>
<p>The <code>\%attr</code> parameter can be used to hint at the data type the
placeholder should have. This is rarely needed. Typically, the driver is only
interested in knowing if the placeholder should be bound as a number or a string.</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_INTEGER</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>As a short-cut for the common case, the data type can be passed
directly, in place of the <code>\%attr</code> hash reference. This example is
equivalent to the one above:</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">,</span> <span class="variable">SQL_INTEGER</span><span class="operator">);</span>
</pre>
<p>The <code>TYPE</code> value indicates the standard (non-driver-specific) type for
this parameter. To specify the driver-specific type, the driver may
support a driver-specific attribute, such as <code>{ ora_type =&gt; 97 }</code>.</p>
<p>The SQL_INTEGER and other related constants can be imported using</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(:sql_types)</span><span class="operator">;</span>
</pre>
<p>See <a href="#dbi_constants">DBI Constants</a> for more information.</p>
<p>The data type for a placeholder cannot be changed after the first
<code>bind_param</code> call. In fact the whole \%attr parameter is 'sticky'
in the sense that a driver only needs to consider the \%attr parameter
for the first call, for a given $sth and parameter. After that the driver
may ignore the \%attr parameter for that placeholder.</p>
<p>Perl only has string and number scalar data types. All database types
that aren't numbers are bound as strings and must be in a format the
database will understand except where the <code>bind_param()</code> TYPE attribute
specifies a type that implies a particular format. For example, given:</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="variable">$value</span><span class="operator">,</span> <span class="variable">SQL_DATETIME</span><span class="operator">);</span>
</pre>
<p>the driver should expect $value to be in the ODBC standard SQL_DATETIME
format, which is 'YYYY-MM-DD HH:MM:SS'. Similarly for SQL_DATE, SQL_TIME etc.</p>
<p>As an alternative to specifying the data type in the <code>bind_param</code> call,
you can let the driver pass the value as the default type (<code>VARCHAR</code>).
You can then use an SQL function to convert the type within the statement.
For example:</p>
<pre>
  INSERT INTO price(code, price) VALUES (?, CONVERT(MONEY,?))</pre>
<p>The <code>CONVERT</code> function used here is just an example. The actual function
and syntax will vary between different databases and is non-portable.</p>
<p>See also <a href="#placeholders_and_bind_values">Placeholders and Bind Values</a> for more information.</p>
<p>
</p>
<h3><a name="bind_param_inout"><code>bind_param_inout</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_inout</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$bind_value</span><span class="operator">,</span> <span class="variable">$max_len</span><span class="operator">)</span>  <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_inout</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$bind_value</span><span class="operator">,</span> <span class="variable">$max_len</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">)</span>     <span class="keyword">or</span> <span class="operator">...</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_inout</span><span class="operator">(</span><span class="variable">$p_num</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$bind_value</span><span class="operator">,</span> <span class="variable">$max_len</span><span class="operator">,</span> <span class="variable">$bind_type</span><span class="operator">)</span> <span class="keyword">or</span> <span class="operator">...</span>
</pre>
<p>This method acts like <a href="#bind_param">bind_param</a>, but also enables values to be
updated by the statement. The statement is typically
a call to a stored procedure. The <code>$bind_value</code> must be passed as a
reference to the actual value to be used.</p>
<p>Note that unlike <a href="#bind_param">bind_param</a>, the <code>$bind_value</code> variable is not
copied when <code>bind_param_inout</code> is called. Instead, the value in the
variable is read at the time <a href="#execute">execute</a> is called.</p>
<p>The additional <code>$max_len</code> parameter specifies the minimum amount of
memory to allocate to <code>$bind_value</code> for the new value. If the value
returned from the database is too
big to fit, then the execution should fail. If unsure what value to use,
pick a generous length, i.e., a length larger than the longest value that would ever be
returned.  The only cost of using a larger value than needed is wasted memory.</p>
<p>Undefined values or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> are used to indicate null values.
See also <a href="#placeholders_and_bind_values">Placeholders and Bind Values</a> for more information.</p>
<p>
</p>
<h3><a name="bind_param_array"><code>bind_param_array</code></a></h3>
<pre>
  $rc = $sth-&gt;bind_param_array($p_num, $array_ref_or_value)
  $rc = $sth-&gt;bind_param_array($p_num, $array_ref_or_value, \%attr)
  $rc = $sth-&gt;bind_param_array($p_num, $array_ref_or_value, $bind_type)</pre>
<p>The <code>bind_param_array</code> method is used to bind an array of values
to a placeholder embedded in the prepared statement which is to be executed
with <a href="#execute_array">execute_array</a>. For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">RaiseError</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>        <span class="comment"># save having to check each method call</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"INSERT INTO staff (first_name, last_name, dept) VALUES(?, ?, ?)"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_array</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="operator">[</span> <span class="string">'John'</span><span class="operator">,</span> <span class="string">'Mary'</span><span class="operator">,</span> <span class="string">'Tim'</span> <span class="operator">]</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_array</span><span class="operator">(</span><span class="number">2</span><span class="operator">,</span> <span class="operator">[</span> <span class="string">'Booth'</span><span class="operator">,</span> <span class="string">'Todd'</span><span class="operator">,</span> <span class="string">'Robinson'</span> <span class="operator">]</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_param_array</span><span class="operator">(</span><span class="number">3</span><span class="operator">,</span> <span class="string">"SALES"</span><span class="operator">);</span> <span class="comment"># scalar will be reused for each row</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(</span> <span class="operator">{</span> <span class="string">ArrayTupleStatus</span> <span class="operator">=&gt;</span> <span class="operator">\</span><span class="keyword">my</span> <span class="variable">@tuple_status</span> <span class="operator">}</span> <span class="operator">);</span>
</pre>
<p>The <code>%attr</code> ($bind_type) argument is the same as defined for <a href="#bind_param">bind_param</a>.
Refer to <a href="#bind_param">bind_param</a> for general details on using placeholders.</p>
<p>(Note that <code>bind_param_array()</code> can <em>not</em> be used to expand a
placeholder into a list of values for a statement like &quot;SELECT foo
WHERE bar IN (?)&quot;.  A placeholder can only ever represent one value
per execution.)</p>
<p>Scalar values, including <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>, may also be bound by
<code>bind_param_array</code>. In which case the same value will be used for each
<a href="#execute">execute</a> call. Driver-specific implementations may behave
differently, e.g., when binding to a stored procedure call, some
databases may permit mixing scalars and arrays as arguments.</p>
<p>The default implementation provided by DBI (for drivers that have
not implemented array binding) is to iteratively call <a href="#execute">execute</a> for
each parameter tuple provided in the bound arrays.  Drivers may
provide more optimized implementations using whatever bulk operation
support the database API provides. The default driver behaviour should
match the default DBI behaviour, but always consult your driver
documentation as there may be driver specific issues to consider.</p>
<p>Note that the default implementation currently only supports non-data
returning statements (INSERT, UPDATE, but not SELECT). Also,
<code>bind_param_array</code> and <a href="#bind_param">bind_param</a> cannot be mixed in the same
statement execution, and <code>bind_param_array</code> must be used with
<a href="#execute_array">execute_array</a>; using <code>bind_param_array</code> will have no effect
for <a href="#execute">execute</a>.</p>
<p>The <code>bind_param_array</code> method was added in DBI 1.22.</p>
<p>
</p>
<h3><a name="execute"><code>execute</code></a></h3>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span>                <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">@bind_values</span><span class="operator">)</span>  <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Perform whatever processing is necessary to execute the prepared
statement.  An <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> is returned if an error occurs.  A successful
<code>execute</code> always returns true regardless of the number of rows affected,
even if it's zero (see below). It is always important to check the
return status of <code>execute</code> (and most other DBI methods) for errors
if you're not using <a href="#raiseerror">RaiseError</a>.</p>
<p>For a <em>non</em>-<code>SELECT</code> statement, <code>execute</code> returns the number of rows
affected, if known. If no rows were affected, then <code>execute</code> returns
&quot;<code>0E0</code>&quot;, which Perl will treat as 0 but will regard as true. Note that it
is <em>not</em> an error for no rows to be affected by a statement. If the
number of rows affected is not known, then <code>execute</code> returns -1.</p>
<p>For <code>SELECT</code> statements, execute simply &quot;starts&quot; the query within the
database engine. Use one of the fetch methods to retrieve the data after
calling <code>execute</code>.  The <code>execute</code> method does <em>not</em> return the number of
rows that will be returned by the query (because most databases can't
tell in advance), it simply returns a true value.</p>
<p>You can tell if the statement was a <code>SELECT</code> statement by checking if
<code>$sth-&gt;{NUM_OF_FIELDS}</code> is greater than zero after calling <code>execute</code>.</p>
<p>If any arguments are given, then <code>execute</code> will effectively call
<a href="#bind_param">bind_param</a> for each value before executing the statement.  Values
bound in this way are usually treated as <code>SQL_VARCHAR</code> types unless
the driver can determine the correct type (which is rare), or unless
<code>bind_param</code> (or <code>bind_param_inout</code>) has already been used to
specify the type.</p>
<p>Note that passing <code>execute</code> an empty array is the same as passing no arguments
at all, which will execute the statement with previously bound values.
That's probably not what you want.</p>
<p>If <code>execute()</code> is called on a statement handle that's still active
($sth-&gt;{Active} is true) then it should effectively call <a href="#finish"><code>finish()</code></a>
to tidy up the previous execution results before starting this new
execution.</p>
<p>
</p>
<h3><a name="execute_array"><code>execute_array</code></a></h3>
<pre>
  <span class="variable">$tuples</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="variable">$tuples</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<pre>
  <span class="operator">(</span><span class="variable">$tuples</span><span class="operator">,</span> <span class="variable">$rows</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
  <span class="operator">(</span><span class="variable">$tuples</span><span class="operator">,</span> <span class="variable">$rows</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(\</span><span class="variable">%attr</span><span class="operator">,</span> <span class="variable">@bind_values</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>Execute the prepared statement once for each parameter tuple
(group of values) provided either in the @bind_values, or by prior
calls to <a href="#bind_param_array">bind_param_array</a>, or via a reference passed in \%attr.</p>
<p>When called in scalar context the <code>execute_array()</code> method returns the
number of tuples executed, or <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> if an error occured.  Like
<code>execute()</code>, a successful <code>execute_array()</code> always returns true regardless
of the number of tuples executed, even if it's zero. If there were any
errors the ArrayTupleStatus array can be used to discover which tuples
failed and with what errors.</p>
<p>When called in list context the <code>execute_array()</code> method returns two scalars;
$tuples is the same as calling <code>execute_array()</code> in scalar context and $rows is
the sum of the number of rows affected for each tuple, if available or
-1 if the driver cannot determine this.
If you are doing an update operation the returned rows affected may not be what
you expect if, for instance, one or more of the tuples affected the same row
multiple times.  Some drivers may not yet support list context, in which case
$rows will be undef, or may not be able to provide the number of rows affected
when performing this batch operation, in which case $rows will be -1.</p>
<p>Bind values for the tuples to be executed may be supplied row-wise
by an <code>ArrayTupleFetch</code> attribute, or else column-wise in the
<code>@bind_values</code> argument, or else column-wise by prior calls to
<a href="#bind_param_array">bind_param_array</a>.</p>
<p>Where column-wise binding is used (via the <code>@bind_values</code> argument
or calls to bind_param_array()) the maximum number of elements in
any one of the bound value arrays determines the number of tuples
executed. Placeholders with fewer values in their parameter arrays
are treated as if padded with undef (NULL) values.</p>
<p>If a scalar value is bound, instead of an array reference, it is
treated as a <em>variable</em> length array with all elements having the
same value. It's does not influence the number of tuples executed,
so if all bound arrays have zero elements then zero tuples will
be executed. If <em>all</em> bound values are scalars then one tuple
will be executed, making <code>execute_array()</code> act just like <code>execute()</code>.</p>
<p>The <code>ArrayTupleFetch</code> attribute can be used to specify a reference
to a subroutine that will be called to provide the bind values for
each tuple execution. The subroutine should return an reference to
an array which contains the appropriate number of bind values, or
return an undef if there is no more data to execute.</p>
<p>As a convienience, the <code>ArrayTupleFetch</code> attribute can also be
used to specify a statement handle. In which case the <code>fetchrow_arrayref()</code>
method will be called on the given statement handle in order to
provide the bind values for each tuple execution.</p>
<p>The values specified via <code>bind_param_array()</code> or the @bind_values
parameter may be either scalars, or arrayrefs.  If any <code>@bind_values</code>
are given, then <code>execute_array</code> will effectively call <a href="#bind_param_array">bind_param_array</a>
for each value before executing the statement.  Values bound in
this way are usually treated as <code>SQL_VARCHAR</code> types unless the
driver can determine the correct type (which is rare), or unless
<code>bind_param</code>, <code>bind_param_inout</code>, <code>bind_param_array</code>, or
<code>bind_param_inout_array</code> has already been used to specify the type.
See <a href="#bind_param_array">bind_param_array</a> for details.</p>
<p>The <code>ArrayTupleStatus</code> attribute can be used to specify a
reference to an array which will receive the execute status of each
executed parameter tuple. Note the <code>ArrayTupleStatus</code> attribute was
mandatory until DBI 1.38.</p>
<p>For tuples which are successfully executed, the element at the same
ordinal position in the status array is the resulting rowcount.
If the execution of a tuple causes an error, then the corresponding
status array element will be set to a reference to an array containing
the error code and error string set by the failed execution.</p>
<p>If <strong>any</strong> tuple execution returns an error, <code>execute_array</code> will
return <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>. In that case, the application should inspect the
status array to determine which parameter tuples failed.
Some databases may not continue executing tuples beyond the first
failure. In this case the status array will either hold fewer
elements, or the elements beyond the failure will be undef.</p>
<p>If all parameter tuples are successfully executed, <code>execute_array</code>
returns the number tuples executed.  If no tuples were executed,
then <code>execute_array()</code> returns &quot;<code>0E0</code>&quot;, just like <code>execute()</code> does,
which Perl will treat as 0 but will regard as true.</p>
<p>For example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"INSERT INTO staff (first_name, last_name) VALUES (?, ?)"</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">$tuples</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(</span>
      <span class="operator">{</span> <span class="string">ArrayTupleStatus</span> <span class="operator">=&gt;</span> <span class="operator">\</span><span class="keyword">my</span> <span class="variable">@tuple_status</span> <span class="operator">}</span><span class="operator">,</span>
      <span class="operator">\</span><span class="variable">@first_names</span><span class="operator">,</span>
      <span class="operator">\</span><span class="variable">@last_names</span><span class="operator">,</span>
  <span class="operator">);</span>
  <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$tuples</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">print</span> <span class="string">"Successfully inserted </span><span class="variable">$tuples</span><span class="string"> records\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
  <span class="keyword">else</span> <span class="operator">{</span>
      <span class="keyword">for</span> <span class="keyword">my</span> <span class="variable">$tuple</span> <span class="operator">(</span><span class="number">0</span><span class="operator">..</span><span class="variable">@last_names</span><span class="operator">-</span><span class="number">1</span><span class="operator">)</span> <span class="operator">{</span>
          <span class="keyword">my</span> <span class="variable">$status</span> <span class="operator">=</span> <span class="variable">$tuple_status</span><span class="operator">[</span><span class="variable">$tuple</span><span class="operator">]</span><span class="operator">;</span>
          <span class="variable">$status</span> <span class="operator">=</span> <span class="operator">[</span><span class="number">0</span><span class="operator">,</span> <span class="string">"Skipped"</span><span class="operator">]</span> <span class="keyword">unless</span> <span class="keyword">defined</span> <span class="variable">$status</span><span class="operator">;</span>
          <span class="keyword">next</span> <span class="keyword">unless</span> <span class="keyword">ref</span> <span class="variable">$status</span><span class="operator">;</span>
          <span class="keyword">printf</span> <span class="string">"Failed to insert (%s, %s): %s\n"</span><span class="operator">,</span>
              <span class="variable">$first_names</span><span class="operator">[</span><span class="variable">$tuple</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$last_names</span><span class="operator">[</span><span class="variable">$tuple</span><span class="operator">]</span><span class="operator">,</span> <span class="variable">$status</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">1</span><span class="operator">]</span><span class="operator">;</span>
      <span class="operator">}</span>
  <span class="operator">}</span>
</pre>
<p>Support for data returning statements such as SELECT is driver-specific
and subject to change. At present, the default implementation
provided by DBI only supports non-data returning statements.</p>
<p>Transaction semantics when using array binding are driver and
database specific.  If <code>AutoCommit</code> is on, the default DBI
implementation will cause each parameter tuple to be inidividually
committed (or rolled back in the event of an error). If <code>AutoCommit</code>
is off, the application is responsible for explicitly committing
the entire set of bound parameter tuples.  Note that different
drivers and databases may have different behaviours when some
parameter tuples cause failures. In some cases, the driver or
database may automatically rollback the effect of all prior parameter
tuples that succeeded in the transaction; other drivers or databases
may retain the effect of prior successfully executed parameter
tuples. Be sure to check your driver and database for its specific
behaviour.</p>
<p>Note that, in general, performance will usually be better with
<code>AutoCommit</code> turned off, and using explicit <code>commit</code> after each
<code>execute_array</code> call.</p>
<p>The <code>execute_array</code> method was added in DBI 1.22, and ArrayTupleFetch
was added in 1.36.</p>
<p>
</p>
<h3><a name="execute_for_fetch"><code>execute_for_fetch</code></a></h3>
<pre>
  <span class="variable">$tuples</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span><span class="variable">$fetch_tuple_sub</span><span class="operator">);</span>
  <span class="variable">$tuples</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span><span class="variable">$fetch_tuple_sub</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">@tuple_status</span><span class="operator">);</span>
</pre>
<pre>
  <span class="operator">(</span><span class="variable">$tuples</span><span class="operator">,</span> <span class="variable">$rows</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span><span class="variable">$fetch_tuple_sub</span><span class="operator">);</span>
  <span class="operator">(</span><span class="variable">$tuples</span><span class="operator">,</span> <span class="variable">$rows</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span><span class="variable">$fetch_tuple_sub</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">@tuple_status</span><span class="operator">);</span>
</pre>
<p>The <code>execute_for_fetch()</code> method is used to perform bulk operations
and is most often used via the <code>execute_array()</code> method, not directly.</p>
<p>The fetch subroutine, referenced by $fetch_tuple_sub, is expected
to return a reference to an array (known as a 'tuple') or undef.</p>
<p>The <code>execute_for_fetch()</code> method calls $fetch_tuple_sub, without any
parameters, until it returns a false value. Each tuple returned is
used to provide bind values for an $sth-&gt;<code>execute(@$tuple)</code> call.</p>
<p>In scalar context <code>execute_for_fetch()</code> returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> if there were any
errors and the number of tuples executed otherwise. Like <code>execute()</code> and
<code>execute_array()</code> a zero is returned as &quot;0E0&quot; so <code>execute_for_fetch()</code> is
only false on error.  If there were any errors the @tuple_status array
can be used to discover which tuples failed and with what errors.</p>
<p>When called in list context <code>execute_for_fetch()</code> returns two scalars;
$tuples is the same as calling <code>execute_for_fetch()</code> in scalar context and $rows is
the sum of the number of rows affected for each tuple, if available or -1
if the driver cannot determine this.
If you are doing an update operation the returned rows affected may not be what
you expect if, for instance, one or more of the tuples affected the same row
multiple times.  Some drivers may not yet support list context, in which case
$rows will be undef, or may not be able to provide the number of rows affected
when performing this batch operation, in which case $rows will be -1.</p>
<p>If \@tuple_status is passed then the execute_for_fetch method uses
it to return status information. The tuple_status array holds one
element per tuple. If the corresponding <code>execute()</code> did not fail then
the element holds the return value from <code>execute()</code>, which is typically
a row count. If the <code>execute()</code> did fail then the element holds a
reference to an array containing ($sth-&gt;err, $sth-&gt;errstr, $sth-&gt;state).</p>
<p>If the driver detects an error that it knows means no further tuples can be
executed then it may return, with an error status, even though $fetch_tuple_sub
may still have more tuples to be executed.</p>
<p>Although each tuple returned by $fetch_tuple_sub is effectively used
to call $sth-&gt;<code>execute(@$tuple_array_ref)</code> the exact timing may vary.
Drivers are free to accumulate sets of tuples to pass to the
database server in bulk group operations for more efficient execution.
However, the $fetch_tuple_sub is specifically allowed to return
the same array reference each time (which is what <code>fetchrow_arrayref()</code>
usually does).</p>
<p>For example:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$sel</span> <span class="operator">=</span> <span class="variable">$dbh1</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"select foo, bar from table1"</span><span class="operator">);</span>
  <span class="variable">$sel</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$ins</span> <span class="operator">=</span> <span class="variable">$dbh2</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"insert into table2 (foo, bar) values (?,?)"</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">$fetch_tuple_sub</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$sel</span><span class="operator">-&gt;</span><span class="variable">fetchrow_arrayref</span> <span class="operator">};</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">@tuple_status</span><span class="operator">;</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$ins</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span><span class="variable">$fetch_tuple_sub</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">@tuple_status</span><span class="operator">);</span>
  <span class="keyword">my</span> <span class="variable">@errors</span> <span class="operator">=</span> <span class="keyword">grep</span> <span class="operator">{</span> <span class="keyword">ref</span> <span class="variable">$_</span> <span class="operator">}</span> <span class="variable">@tuple_status</span><span class="operator">;</span>
</pre>
<p>Similarly, if you already have an array containing the data rows
to be processed you'd use a subroutine to shift off and return
each array ref in turn:</p>
<pre>
  <span class="variable">$ins</span><span class="operator">-&gt;</span><span class="variable">execute_for_fetch</span><span class="operator">(</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">shift</span> <span class="variable">@array_of_arrays</span> <span class="operator">},</span> <span class="operator">\</span><span class="variable">@tuple_status</span><span class="operator">);</span>
</pre>
<p>The <code>execute_for_fetch</code> method was added in DBI 1.38.</p>
<p>
</p>
<h3><a name="fetchrow_arrayref"><code>fetchrow_arrayref</code></a></h3>
<pre>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_arrayref</span><span class="operator">;</span>
  <span class="variable">$ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">;</span>    <span class="comment"># alias</span>
</pre>
<p>Fetches the next row of data and returns a reference to an array
holding the field values.  Null fields are returned as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>
values in the array.
This is the fastest way to fetch data, particularly if used with
<code>$sth-&gt;bind_columns</code>.</p>
<p>If there are no more rows or if an error occurs, then <code>fetchrow_arrayref</code>
returns an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>. You should check <code>$sth-&gt;err</code> afterwards (or use the
<code>RaiseError</code> attribute) to discover if the <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> returned was due to an
error.</p>
<p>Note that the same array reference is returned for each fetch, so don't
store the reference and then use it after a later fetch.  Also, the
elements of the array are also reused for each row, so take care if you
want to take a reference to an element. See also <a href="#bind_columns">bind_columns</a>.</p>
<p>
</p>
<h3><a name="fetchrow_array"><code>fetchrow_array</code></a></h3>
<pre>
 <span class="variable">@ary</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span><span class="operator">;</span>
</pre>
<p>An alternative to <code>fetchrow_arrayref</code>. Fetches the next row of data
and returns it as a list containing the field values.  Null fields
are returned as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> values in the list.</p>
<p>If there are no more rows or if an error occurs, then <code>fetchrow_array</code>
returns an empty list. You should check <code>$sth-&gt;err</code> afterwards (or use
the <code>RaiseError</code> attribute) to discover if the empty list returned was
due to an error.</p>
<p>If called in a scalar context for a statement handle that has more
than one column, it is undefined whether the driver will return
the value of the first column or the last. So don't do that.
Also, in a scalar context, an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> is returned if there are no
more rows or if an error occurred. That <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> can't be distinguished
from an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> returned because the first field value was NULL.
For these reasons you should exercise some caution if you use
<code>fetchrow_array</code> in a scalar context.</p>
<p>
</p>
<h3><a name="fetchrow_hashref"><code>fetchrow_hashref</code></a></h3>
<pre>
 <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_hashref</span><span class="operator">;</span>
 <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_hashref</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">);</span>
</pre>
<p>An alternative to <code>fetchrow_arrayref</code>. Fetches the next row of data
and returns it as a reference to a hash containing field name and field
value pairs.  Null fields are returned as <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> values in the hash.</p>
<p>If there are no more rows or if an error occurs, then <code>fetchrow_hashref</code>
returns an <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>. You should check <code>$sth-&gt;err</code> afterwards (or use the
<code>RaiseError</code> attribute) to discover if the <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> returned was due to an
error.</p>
<p>The optional <code>$name</code> parameter specifies the name of the statement handle
attribute. For historical reasons it defaults to &quot;<a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a>&quot;, however using either
&quot;<code>NAME_lc</code>&quot; or &quot;<code>NAME_uc</code>&quot; is recomended for portability.</p>
<p>The keys of the hash are the same names returned by <code>$sth-&gt;{$name}</code>. If
more than one field has the same name, there will only be one entry in
the returned hash for those fields.</p>
<p>Because of the extra work <code>fetchrow_hashref</code> and Perl have to perform, it
is not as efficient as <code>fetchrow_arrayref</code> or <code>fetchrow_array</code>.</p>
<p>By default a reference to a new hash is returned for each row.
It is likely that a future version of the DBI will support an
attribute which will enable the same hash to be reused for each
row. This will give a significant performance boost, but it won't
be enabled by default because of the risk of breaking old code.</p>
<p>
</p>
<h3><a name="fetchall_arrayref"><code>fetchall_arrayref</code></a></h3>
<pre>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">;</span>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span> <span class="variable">$slice</span> <span class="operator">);</span>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span> <span class="variable">$slice</span><span class="operator">,</span> <span class="variable">$max_rows</span>  <span class="operator">);</span>
</pre>
<p>The <code>fetchall_arrayref</code> method can be used to fetch all the data to be
returned from a prepared and executed statement handle. It returns a
reference to an array that contains one reference per row.</p>
<p>If there are no rows to return, <code>fetchall_arrayref</code> returns a reference
to an empty array. If an error occurs, <code>fetchall_arrayref</code> returns the
data fetched thus far, which may be none.  You should check <code>$sth-&gt;err</code>
afterwards (or use the <code>RaiseError</code> attribute) to discover if the data is
complete or was truncated due to an error.</p>
<p>If $slice is an array reference, <code>fetchall_arrayref</code> uses <a href="#fetchrow_arrayref">fetchrow_arrayref</a>
to fetch each row as an array ref. If the $slice array is not empty
then it is used as a slice to select individual columns by perl array
index number (starting at 0, unlike column and parameter numbers which
start at 1).</p>
<p>With no parameters, or if $slice is undefined, <code>fetchall_arrayref</code>
acts as if passed an empty array ref.</p>
<p>If $slice is a hash reference, <code>fetchall_arrayref</code> uses <a href="#fetchrow_hashref">fetchrow_hashref</a>
to fetch each row as a hash reference. If the $slice hash is empty then
<code>fetchrow_hashref()</code> is simply called in a tight loop and the keys in the hashes
have whatever name lettercase is returned by default from fetchrow_hashref.
(See <a href="#fetchhashkeyname">FetchHashKeyName</a> attribute.) If the $slice hash is not
empty, then it is used as a slice to select individual columns by
name.  The values of the hash should be set to 1.  The key names
of the returned hashes match the letter case of the names in the
parameter hash, regardless of the <a href="#fetchhashkeyname">FetchHashKeyName</a> attribute.</p>
<p>For example, to fetch just the first column of every row:</p>
<pre>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">);</span>
</pre>
<p>To fetch the second to last and last column of every row:</p>
<pre>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span><span class="operator">[</span><span class="operator">-</span><span class="number">2</span><span class="operator">,-</span><span class="number">1</span><span class="operator">]</span><span class="operator">);</span>
</pre>
<p>To fetch all fields of every row as a hash ref:</p>
<pre>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span><span class="operator">{}</span><span class="operator">);</span>
</pre>
<p>To fetch only the fields called &quot;foo&quot; and &quot;bar&quot; of every row as a hash ref
(with keys named &quot;foo&quot; and &quot;BAR&quot;):</p>
<pre>
  <span class="variable">$tbl_ary_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span><span class="operator">{</span> <span class="string">foo</span><span class="operator">=&gt;</span><span class="number">1</span><span class="operator">,</span> <span class="string">BAR</span><span class="operator">=&gt;</span><span class="number">1</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>The first two examples return a reference to an array of array refs.
The third and forth return a reference to an array of hash refs.</p>
<p>If $max_rows is defined and greater than or equal to zero then it
is used to limit the number of rows fetched before returning.
<code>fetchall_arrayref()</code> can then be called again to fetch more rows.
This is especially useful when you need the better performance of
<code>fetchall_arrayref()</code> but don't have enough memory to fetch and return
all the rows in one go.</p>
<p>Here's an example (assumes RaiseError is enabled):</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$rows</span> <span class="operator">=</span> <span class="operator">[]</span><span class="operator">;</span> <span class="comment"># cache for batches of rows</span>
  <span class="keyword">while</span><span class="operator">(</span> <span class="keyword">my</span> <span class="variable">$row</span> <span class="operator">=</span> <span class="operator">(</span> <span class="keyword">shift</span><span class="operator">(</span><span class="variable">@$rows</span><span class="operator">)</span> <span class="operator">||</span> <span class="comment"># get row from cache, or reload cache:</span>
                     <span class="keyword">shift</span><span class="operator">(</span><span class="variable">@</span><span class="operator">{</span><span class="variable">$rows</span><span class="operator">=</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_arrayref</span><span class="operator">(</span><span class="keyword">undef</span><span class="operator">,</span><span class="number">10_000</span><span class="operator">)||</span><span class="operator">[]}</span><span class="operator">)</span> <span class="operator">)</span>
  <span class="operator">)</span> <span class="operator">{</span>
    <span class="operator">...</span>
  <span class="operator">}</span>
</pre>
<p>That <em>might</em> be the fastest way to fetch and process lots of rows using the DBI,
but it depends on the relative cost of method calls vs memory allocation.</p>
<p>A standard <code>while</code> loop with column binding is often faster because
the cost of allocating memory for the batch of rows is greater than
the saving by reducing method calls. It's possible that the DBI may
provide a way to reuse the memory of a previous batch in future, which
would then shift the balance back towards <code>fetchall_arrayref()</code>.</p>
<p>
</p>
<h3><a name="fetchall_hashref"><code>fetchall_hashref</code></a></h3>
<pre>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_hashref</span><span class="operator">(</span><span class="variable">$key_field</span><span class="operator">);</span>
</pre>
<p>The <code>fetchall_hashref</code> method can be used to fetch all the data to be
returned from a prepared and executed statement handle. It returns a reference
to a hash containing a key for each distinct value of the $key_field column
that was fetched. For each key the corresponding value is a reference to a hash
containing all the selected columns and their values, as returned by <code>fetchrow_hashref()</code>.</p>
<p>If there are no rows to return, <code>fetchall_hashref</code> returns a reference
to an empty hash. If an error occurs, <code>fetchall_hashref</code> returns the
data fetched thus far, which may be none.  You should check
<code>$sth-&gt;err</code> afterwards (or use the <code>RaiseError</code> attribute) to
discover if the data is complete or was truncated due to an error.</p>
<p>The $key_field parameter provides the name of the field that holds the
value to be used for the key for the returned hash.  For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">FetchHashKeyName</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">'NAME_lc'</span><span class="operator">;</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"SELECT FOO, BAR, ID, NAME, BAZ FROM TABLE"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_hashref</span><span class="operator">(</span><span class="string">'id'</span><span class="operator">);</span>
  <span class="keyword">print</span> <span class="string">"Name for id 42 is </span><span class="variable">$hash_ref</span><span class="string">-&gt;{42}-&gt;{name}\n"</span><span class="operator">;</span>
</pre>
<p>The $key_field parameter can also be specified as an integer column
number (counting from 1).  If $key_field doesn't match any column in
the statement, as a name first then as a number, then an error is
returned.</p>
<p>For queries returing more than one 'key' column, you can specify
multiple column names by passing $key_field as a reference to an
array containing one or more key column names (or index numbers).
For example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"SELECT foo, bar, baz FROM table"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">$hash_ref</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchall_hashref</span><span class="operator">(</span> <span class="operator">[</span> <span class="string">qw(foo bar)</span> <span class="operator">]</span> <span class="operator">);</span>
  <span class="keyword">print</span> <span class="string">"For foo 42 and bar 38, baz is </span><span class="variable">$hash_ref</span><span class="string">-&gt;{42}-&gt;{38}-&gt;{baz}\n"</span><span class="operator">;</span>
</pre>
<p>The <code>fetchall_hashref()</code> method is normally used only where the key
fields values for each row are unique.  If multiple rows are returned
with the same values for the key fields then later rows overwrite
earlier ones.</p>
<p>
</p>
<h3><a name="finish"><a href="#finish"><code>finish</code></a></a></h3>
<pre>
  <span class="variable">$rc</span>  <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">finish</span><span class="operator">;</span>
</pre>
<p>Indicate that no more data will be fetched from this statement handle
before it is either executed again or destroyed.  The <a href="#finish"><code>finish</code></a> method
is rarely needed, and frequently overused, but can sometimes be
helpful in a few very specific situations to allow the server to free
up resources (such as sort buffers).</p>
<p>When all the data has been fetched from a <code>SELECT</code> statement, the
driver should automatically call <a href="#finish"><code>finish</code></a> for you. So you should
<em>not</em> normally need to call it explicitly <em>except</em> when you know
that you've not fetched all the data from a statement handle.
The most common example is when you only want to fetch one row,
but in that case the <code>selectrow_*</code> methods are usually better anyway.
Adding calls to <a href="#finish"><code>finish</code></a> after each fetch loop is a common mistake,
don't do it, it can mask genuine problems like uncaught fetch errors.</p>
<p>Consider a query like:</p>
<pre>
  SELECT foo FROM table WHERE bar=? ORDER BY foo</pre>
<p>where you want to select just the first (smallest) &quot;foo&quot; value from a
very large table. When executed, the database server will have to use
temporary buffer space to store the sorted rows. If, after executing
the handle and selecting one row, the handle won't be re-executed for
some time and won't be destroyed, the <a href="#finish"><code>finish</code></a> method can be used to tell
the server that the buffer space can be freed.</p>
<p>Calling <a href="#finish"><code>finish</code></a> resets the <a href="#active">Active</a> attribute for the statement.  It
may also make some statement handle attributes (such as <a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a> and <code>TYPE</code>)
unavailable if they have not already been accessed (and thus cached).</p>
<p>The <a href="#finish"><code>finish</code></a> method does not affect the transaction status of the
database connection.  It has nothing to do with transactions. It's mostly an
internal &quot;housekeeping&quot; method that is rarely needed.
See also <a href="#disconnect">disconnect</a> and the <a href="#active">Active</a> attribute.</p>
<p>The <a href="#finish"><code>finish</code></a> method should have been called <code>discard_pending_rows</code>.</p>
<p>
</p>
<h3><a name="rows"><code>rows</code></a></h3>
<pre>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">rows</span><span class="operator">;</span>
</pre>
<p>Returns the number of rows affected by the last row affecting command,
or -1 if the number of rows is not known or not available.</p>
<p>Generally, you can only rely on a row count after a <em>non</em>-<code>SELECT</code>
<code>execute</code> (for some specific operations like <code>UPDATE</code> and <code>DELETE</code>), or
after fetching all the rows of a <code>SELECT</code> statement.</p>
<p>For <code>SELECT</code> statements, it is generally not possible to know how many
rows will be returned except by fetching them all.  Some drivers will
return the number of rows the application has fetched so far, but
others may return -1 until all rows have been fetched.  So use of the
<code>rows</code> method or <code>$DBI::rows</code> with <code>SELECT</code> statements is not
recommended.</p>
<p>One alternative method to get a row count for a <code>SELECT</code> is to execute a
&quot;SELECT COUNT(*) FROM ...&quot; SQL statement with the same &quot;...&quot; as your
query and then fetch the row count from that.</p>
<p>
</p>
<h3><a name="bind_col"><code>bind_col</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="variable">$column_number</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$var_to_bind</span><span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="variable">$column_number</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$var_to_bind</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span> <span class="operator">);</span>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="variable">$column_number</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$var_to_bind</span><span class="operator">,</span> <span class="variable">$bind_type</span> <span class="operator">);</span>
</pre>
<p>Binds a Perl variable and/or some attributes to an output column
(field) of a <code>SELECT</code> statement.  Column numbers count up from 1.
You do not need to bind output columns in order to fetch data.
For maximum portability between drivers, <code>bind_col()</code> should be called
after <code>execute()</code> and not before.
See also <code>bind_columns</code> for an example.</p>
<p>The binding is performed at a low level using Perl aliasing.
Whenever a row is fetched from the database $var_to_bind appears
to be automatically updated simply because it now refers to the same
memory location as the corresponding column value.  This makes using
bound variables very efficient.
Binding a tied variable doesn't work, currently.</p>
<p>The <a href="#bind_param">bind_param</a> method
performs a similar, but opposite, function for input variables.</p>
<p><strong>Data Types for Column Binding</strong></p>
<p>The <code>\%attr</code> parameter can be used to hint at the data type
formatting the column should have. For example, you can use:</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="operator">{</span> <span class="string">TYPE</span> <span class="operator">=&gt;</span> <span class="variable">SQL_DATETIME</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>to specify that you'd like the column (which presumably is some
kind of datetime type) to be returned in the standard format for
SQL_DATETIME, which is 'YYYY-MM-DD HH:MM:SS', rather than the
native formatting the database would normally use.</p>
<p>There's no $var_to_bind in that example to emphasize the point
that <code>bind_col()</code> works on the underlying column value and not just
a particular bound variable.</p>
<p>As a short-cut for the common case, the data type can be passed
directly, in place of the <code>\%attr</code> hash reference. This example is
equivalent to the one above:</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_col</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="variable">SQL_DATETIME</span><span class="operator">);</span>
</pre>
<p>The <code>TYPE</code> value indicates the standard (non-driver-specific) type for
this parameter. To specify the driver-specific type, the driver may
support a driver-specific attribute, such as <code>{ ora_type =&gt; 97 }</code>.</p>
<p>The SQL_DATETIME and other related constants can be imported using</p>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span> <span class="string">qw(:sql_types)</span><span class="operator">;</span>
</pre>
<p>See <a href="#dbi_constants">DBI Constants</a> for more information.</p>
<p>The data type for a bind variable cannot be changed after the first
<code>bind_col</code> call. In fact the whole \%attr parameter is 'sticky'
in the sense that a driver only needs to consider the \%attr parameter
for the first call for a given $sth and column.</p>
<p>The TYPE attribute for <code>bind_col()</code> was first specified in DBI 1.41.</p>
<p>
</p>
<h3><a name="bind_columns"><code>bind_columns</code></a></h3>
<pre>
  <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_columns</span><span class="operator">(</span><span class="variable">@list_of_refs_to_vars_to_bind</span><span class="operator">);</span>
</pre>
<p>Calls <a href="#bind_col">bind_col</a> for each column of the <code>SELECT</code> statement.</p>
<p>The list of references should have the same number of elements as the number of
columns in the <code>SELECT</code> statement. If it doesn't then <code>bind_columns</code> will
bind the elements given, upto the number of columns, and then return an error.</p>
<p>For maximum portability between drivers, <code>bind_columns()</code> should be called
after <code>execute()</code> and not before.</p>
<p>For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">RaiseError</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span> <span class="comment"># do this, or check every call for errors</span>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">q{ SELECT region, sales FROM sales_by_region }</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$region</span><span class="operator">,</span> <span class="variable">$sales</span><span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># Bind Perl variables to columns:</span>
  <span class="variable">$rv</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_columns</span><span class="operator">(\</span><span class="variable">$region</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$sales</span><span class="operator">);</span>
</pre>
<pre>
  <span class="comment"># you can also use Perl's \(...) syntax (see perlref docs):</span>
  <span class="comment">#     $sth-&gt;bind_columns(\($region, $sales));</span>
</pre>
<pre>
  <span class="comment"># Column binding is the most efficient way to fetch data</span>
  <span class="keyword">while</span> <span class="operator">(</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">print</span> <span class="string">"</span><span class="variable">$region</span><span class="string">: </span><span class="variable">$sales</span><span class="string">\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>For compatibility with old scripts, the first parameter will be
ignored if it is <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> or a hash reference.</p>
<p>Here's a more fancy example that binds columns to the values <em>inside</em>
a hash (thanks to H.Merijn Brand):</p>
<pre>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="variable">%row</span><span class="operator">;</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">bind_columns</span><span class="operator">(</span> <span class="operator">\(</span> <span class="variable">@row</span><span class="operator">{</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NAME_lc</span><span class="operator">}</span> <span class="operator">}</span> <span class="operator">}</span> <span class="operator">));</span>
  <span class="keyword">while</span> <span class="operator">(</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">print</span> <span class="string">"</span><span class="variable">$row</span><span class="string">{region}: </span><span class="variable">$row</span><span class="string">{sales}\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>
</p>
<h3><a name="dump_results"><code>dump_results</code></a></h3>
<pre>
  <span class="variable">$rows</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">dump_results</span><span class="operator">(</span><span class="variable">$maxlen</span><span class="operator">,</span> <span class="variable">$lsep</span><span class="operator">,</span> <span class="variable">$fsep</span><span class="operator">,</span> <span class="variable">$fh</span><span class="operator">);</span>
</pre>
<p>Fetches all the rows from <code>$sth</code>, calls <code>DBI::neat_list</code> for each row, and
prints the results to <code>$fh</code> (defaults to <code>STDOUT</code>) separated by <code>$lsep</code>
(default <a href="../lib/pods/perlrun.html#n"><code>&quot;\n&quot;</code></a>). <code>$fsep</code> defaults to <code>&quot;, &quot;</code> and <code>$maxlen</code> defaults to 35.</p>
<p>This method is designed as a handy utility for prototyping and
testing queries. Since it uses <a href="#neat_list">neat_list</a> to
format and edit the string for reading by humans, it is not recomended
for data transfer applications.</p>
<p>
</p>
<h2><a name="statement_handle_attributes">Statement Handle Attributes</a></h2>
<p>This section describes attributes specific to statement handles. Most
of these attributes are read-only.</p>
<p>Changes to these statement handle attributes do not affect any other
existing or future statement handles.</p>
<p>Attempting to set or get the value of an unknown attribute generates a warning,
except for private driver specific attributes (which all have names
starting with a lowercase letter).</p>
<p>Example:</p>
<pre>
  <span class="operator">...</span> <span class="operator">=</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NUM_OF_FIELDS</span><span class="operator">}</span><span class="operator">;</span>    <span class="comment"># get/read</span>
</pre>
<p>Some drivers cannot provide valid values for some or all of these
attributes until after <code>$sth-&gt;execute</code> has been successfully
called. Typically the attribute will be <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> in these situations.</p>
<p>Some attributes, like NAME, are not appropriate to some types of
statement, like SELECT. Typically the attribute will be <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>
in these situations.</p>
<p>For drivers which support stored procedures and multiple result sets
(see <a href="#more_results">more_results</a>) these attributes relate to the <em>current</em> result set.</p>
<p>See also <a href="#finish">finish</a> to learn more about the effect it
may have on some attributes.</p>
<p>
</p>
<h3><a name="num_of_fields__integer__read_only_"><code>NUM_OF_FIELDS</code>  (integer, read-only)</a></h3>
<p>Number of fields (columns) in the data the prepared statement may return.
Statements that don't return rows of data, like <code>DELETE</code> and <code>CREATE</code>
set <code>NUM_OF_FIELDS</code> to 0 (though it may be undef in some drivers).</p>
<p>
</p>
<h3><a name="num_of_params__integer__read_only_"><code>NUM_OF_PARAMS</code>  (integer, read-only)</a></h3>
<p>The number of parameters (placeholders) in the prepared statement.
See SUBSTITUTION VARIABLES below for more details.</p>
<p>
</p>
<h3><a name="name__array_ref__read_only_"><a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a>  (array-ref, read-only)</a></h3>
<p>Returns a reference to an array of field names for each column. The
names may contain spaces but should not be truncated or have any
trailing space. Note that the names have the letter case (upper, lower
or mixed) as returned by the driver being used. Portable applications
should use <a href="#name_lc">NAME_lc</a> or <a href="#name_uc">NAME_uc</a>.</p>
<pre>
  <span class="keyword">print</span> <span class="string">"First column name: </span><span class="variable">$sth</span><span class="string">-&gt;{NAME}-&gt;[0]\n"</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="name_lc__array_ref__read_only_"><code>NAME_lc</code>  (array-ref, read-only)</a></h3>
<p>Like <a href="../lib/pods/perlfunc.html#name">NAME</a> but always returns lowercase names.</p>
<p>
</p>
<h3><a name="name_uc__array_ref__read_only_"><code>NAME_uc</code>  (array-ref, read-only)</a></h3>
<p>Like <a href="../lib/pods/perlfunc.html#name">NAME</a> but always returns uppercase names.</p>
<p>
</p>
<h3><a name="name_hash__hash_ref__read_only_"><code>NAME_hash</code>  (hash-ref, read-only)</a></h3>
<p>
</p>
<h3><a name="name_lc_hash__hash_ref__read_only_"><code>NAME_lc_hash</code>  (hash-ref, read-only)</a></h3>
<p>
</p>
<h3><a name="name_uc_hash__hash_ref__read_only_"><code>NAME_uc_hash</code>  (hash-ref, read-only)</a></h3>
<p>The <code>NAME_hash</code>, <code>NAME_lc_hash</code>, and <code>NAME_uc_hash</code> attributes
return column name information as a reference to a hash.</p>
<p>The keys of the hash are the names of the columns.  The letter case of
the keys corresponds to the letter case returned by the <a href="../lib/pods/perlfunc.html#name"><code>NAME</code></a>,
<code>NAME_lc</code>, and <code>NAME_uc</code> attributes respectively (as described above).</p>
<p>The value of each hash entry is the perl index number of the
corresponding column (counting from 0). For example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"select Id, Name from table"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">;</span>
  <span class="variable">@row</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="string">"Name </span><span class="variable">$row</span><span class="string">[ </span><span class="variable">$sth</span><span class="string">-&gt;{NAME_lc_hash}{name} ]\n"</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="type__array_ref__read_only_"><code>TYPE</code>  (array-ref, read-only)</a></h3>
<p>Returns a reference to an array of integer values for each
column. The value indicates the data type of the corresponding column.</p>
<p>The values correspond to the international standards (ANSI X3.135
and ISO/IEC 9075) which, in general terms, means ODBC. Driver-specific
types that don't exactly match standard types should generally return
the same values as an ODBC driver supplied by the makers of the
database. That might include private type numbers in ranges the vendor
has officially registered with the ISO working group:</p>
<pre>
  <a href="ftp://sqlstandards.org/SC32/SQL_Registry/">ftp://sqlstandards.org/SC32/SQL_Registry/</a></pre>
<p>Where there's no vendor-supplied ODBC driver to be compatible with,
the DBI driver can use type numbers in the range that is now
officially reserved for use by the DBI: -9999 to -9000.</p>
<p>All possible values for <code>TYPE</code> should have at least one entry in the
output of the <code>type_info_all</code> method (see <a href="#type_info_all">type_info_all</a>).</p>
<p>
</p>
<h3><a name="precision__array_ref__read_only_"><code>PRECISION</code>  (array-ref, read-only)</a></h3>
<p>Returns a reference to an array of integer values for each column.</p>
<p>For numeric columns, the value is the maximum number of digits
(without considering a sign character or decimal point). Note that
the &quot;display size&quot; for floating point types (REAL, FLOAT, DOUBLE)
can be up to 7 characters greater than the precision (for the
sign + decimal point + the letter E + a sign + 2 or 3 digits).</p>
<p>For any character type column the value is the OCTET_LENGTH,
in other words the number of bytes, not characters.</p>
<p>(More recent standards refer to this as COLUMN_SIZE but we stick
with PRECISION for backwards compatibility.)</p>
<p>
</p>
<h3><a name="scale__array_ref__read_only_"><code>SCALE</code>  (array-ref, read-only)</a></h3>
<p>Returns a reference to an array of integer values for each column.
NULL (<a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) values indicate columns where scale is not applicable.</p>
<p>
</p>
<h3><a name="nullable__array_ref__read_only_"><a href="#nullable"><code>NULLABLE</code></a>  (array-ref, read-only)</a></h3>
<p>Returns a reference to an array indicating the possibility of each
column returning a null.  Possible values are <code>0</code>
(or an empty string) = no, <code>1</code> = yes, <code>2</code> = unknown.</p>
<pre>
  <span class="keyword">print</span> <span class="string">"First column may return NULL\n"</span> <span class="keyword">if</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">NULLABLE</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
</pre>
<p>
</p>
<h3><a name="cursorname__string__read_only_"><code>CursorName</code>  (string, read-only)</a></h3>
<p>Returns the name of the cursor associated with the statement handle, if
available. If not available or if the database driver does not support the
<code>&quot;where current of ...&quot;</code> SQL syntax, then it returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.</p>
<p>
</p>
<h3><a name="database__dbh__read_only_"><code>Database</code>  (dbh, read-only)</a></h3>
<p>Returns the parent $dbh of the statement handle.</p>
<p>
</p>
<h3><a name="paramvalues__hash_ref__read_only_"><code>ParamValues</code>  (hash ref, read-only)</a></h3>
<p>Returns a reference to a hash containing the values currently bound
to placeholders.  The keys of the hash are the 'names' of the
placeholders, typically integers starting at 1.  Returns undef if
not supported by the driver.</p>
<p>See <a href="#showerrorstatement">ShowErrorStatement</a> for an example of how this is used.</p>
<p>If the driver supports <code>ParamValues</code> but no values have been bound
yet then the driver should return a hash with placeholders names
in the keys but all the values undef, but some drivers may return
a ref to an empty hash.</p>
<p>It is possible that the values in the hash returned by <code>ParamValues</code>
are not <em>exactly</em> the same as those passed to <code>bind_param()</code> or <code>execute()</code>.
The driver may have slightly modified values in some way based on the
TYPE the value was bound with. For example a floating point value
bound as an SQL_INTEGER type may be returned as an integer.
The values returned by <code>ParamValues</code> can be passed to another
<code>bind_param()</code> method with the same TYPE and will be seen by the
database as the same value.</p>
<p>It is also possible that the keys in the hash returned by <code>ParamValues</code>
are not exactly the same as those implied by the prepared statement.
For example, DBD::Oracle translates '<code>?</code>' placeholders into '<code>:pN</code>'
where N is a sequence number starting at 1.</p>
<p>The <code>ParamValues</code> attribute was added in DBI 1.28.</p>
<p>
</p>
<h3><a name="paramarrays__hash_ref__read_only_"><code>ParamArrays</code>  (hash ref, read-only)</a></h3>
<p>Returns a reference to a hash containing the values currently bound to
placeholders with <a href="#execute_array">execute_array</a> or <a href="#bind_param_array">bind_param_array</a>.  The
keys of the hash are the 'names' of the placeholders, typically
integers starting at 1.  Returns undef if not supported by the driver
or no arrays of parameters are bound.</p>
<p>Each key value is an array reference containing a list of the bound
parameters for that column.</p>
<p>For example:</p>
<pre>
  <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span><span class="string">"INSERT INTO staff (id, name) values (?,?)"</span><span class="operator">);</span>
  <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute_array</span><span class="operator">(</span><span class="operator">{}</span><span class="operator">,</span><span class="operator">[</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="operator">]</span><span class="operator">,</span> <span class="operator">[</span><span class="string">'fred'</span><span class="operator">,</span><span class="string">'dave'</span><span class="operator">]</span><span class="operator">);</span>
  <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ParamArrays</span><span class="operator">}</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">foreach</span> <span class="variable">$param</span> <span class="operator">(</span><span class="keyword">keys</span> <span class="variable">%</span><span class="operator">{</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ParamArrays</span><span class="operator">}}</span><span class="operator">)</span> <span class="operator">{</span>
          <span class="keyword">printf</span> <span class="string">"Parameters for %s : %s\n"</span><span class="operator">,</span> <span class="variable">$param</span><span class="operator">,</span>
          <span class="keyword">join</span><span class="operator">(</span><span class="string">","</span><span class="operator">,</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">ParamArrays</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="variable">$param</span><span class="operator">}}</span><span class="operator">);</span>
      <span class="operator">}</span>
  <span class="operator">}</span>
</pre>
<p>It is possible that the values in the hash returned by <code>ParamArrays</code>
are not <em>exactly</em> the same as those passed to <a href="#bind_param_array">bind_param_array</a> or
<a href="#execute_array">execute_array</a>.  The driver may have slightly modified values in some
way based on the TYPE the value was bound with. For example a floating
point value bound as an SQL_INTEGER type may be returned as an
integer.</p>
<p>It is also possible that the keys in the hash returned by
<code>ParamArrays</code> are not exactly the same as those implied by the
prepared statement.  For example, DBD::Oracle translates '<code>?</code>'
placeholders into '<code>:pN</code>' where N is a sequence number starting at 1.</p>
<p>
</p>
<h3><a name="paramtypes__hash_ref__read_only_"><code>ParamTypes</code>  (hash ref, read-only)</a></h3>
<p>Returns a reference to a hash containing the type information
currently bound to placeholders.  The keys of the hash are the
'names' of the placeholders: either integers starting at 1, or,
for drivers that support named placeholders, the actual parameter
name string. The hash values are hashrefs of type information in
the same form as that provided to the various <code>bind_param()</code> methods
(See <a href="#bind_param">bind_param</a> for the format and values),
plus anything else that was passed as the third argument to <code>bind_param()</code>.
Returns undef if not supported by the driver.</p>
<p>If the driver supports <code>ParamTypes</code>, but no values have been bound
yet, then the driver should return a hash with the placeholder name
keys, but all the values undef; however, some drivers may return
a ref to an empty hash, or, alternately, may provide type
information supplied by the database (only a few databases can do that).</p>
<p>It is possible that the values in the hash returned by <code>ParamTypes</code>
are not <em>exactly</em> the same as those passed to <code>bind_param()</code> or <code>execute()</code>.
The driver may have modified the type information in some way based
on the bound values, other hints provided by the prepare()'d
SQL statement, or alternate type mappings required by the driver or target
database system.</p>
<p>It is also possible that the keys in the hash returned by <code>ParamTypes</code>
are not exactly the same as those implied by the prepared statement.
For example, DBD::Oracle translates '<code>?</code>' placeholders into '<code>:pN</code>'
where N is a sequence number starting at 1.</p>
<p>The <code>ParamTypes</code> attribute was added in DBI 1.49. Implementation
is the responsibility of individual drivers; the DBI layer default
implementation simply returns undef.</p>
<p>
</p>
<h3><a name="statement__string__read_only_"><code>Statement</code>  (string, read-only)</a></h3>
<p>Returns the statement string passed to the <a href="#prepare">prepare</a> method.</p>
<p>
</p>
<h3><a name="rowsincache__integer__read_only_"><code>RowsInCache</code>  (integer, read-only)</a></h3>
<p>If the driver supports a local row cache for <code>SELECT</code> statements, then
this attribute holds the number of un-fetched rows in the cache. If the
driver doesn't, then it returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>. Note that some drivers pre-fetch
rows on execute, whereas others wait till the first fetch.</p>
<p>See also the <a href="#rowcachesize">RowCacheSize</a> database handle attribute.</p>
<p>
</p>
<hr />
<h1><a name="further_information">FURTHER INFORMATION</a></h1>
<p>
</p>
<h2><a name="catalog_methods">Catalog Methods</a></h2>
<p>An application can retrieve metadata information from the DBMS by issuing
appropriate queries on the views of the Information Schema. Unfortunately,
<code>INFORMATION_SCHEMA</code> views are seldom supported by the DBMS.
Special methods (catalog methods) are available to return result sets
for a small but important portion of that metadata:</p>
<pre>
  column_info
  foreign_key_info
  primary_key_info
  table_info
  statistics_info</pre>
<p>All catalog methods accept arguments in order to restrict the result sets.
Passing <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a> to an optional argument does not constrain the search for
that argument.
However, an empty string ('') is treated as a regular search criteria
and will only match an empty value.</p>
<p><strong>Note</strong>: SQL/CLI and ODBC differ in the handling of empty strings. An
empty string will not restrict the result set in SQL/CLI.</p>
<p>Most arguments in the catalog methods accept only <em>ordinary values</em>, e.g.
the arguments of <code>primary_key_info()</code>.
Such arguments are treated as a literal string, i.e. the case is significant
and quote characters are taken literally.</p>
<p>Some arguments in the catalog methods accept <em>search patterns</em> (strings
containing '_' and/or '%'), e.g. the <code>$table</code> argument of <code>column_info()</code>.
Passing '%' is equivalent to leaving the argument <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>.</p>
<p><strong>Caveat</strong>: The underscore ('_') is valid and often used in SQL identifiers.
Passing such a value to a search pattern argument may return more rows than
expected!
To include pattern characters as literals, they must be preceded by an
escape character which can be achieved with</p>
<pre>
  <span class="variable">$esc</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">get_info</span><span class="operator">(</span> <span class="number">14</span> <span class="operator">);</span>  <span class="comment"># SQL_SEARCH_PATTERN_ESCAPE</span>
  <span class="variable">$search_pattern</span> <span class="operator">=~</span> <span class="regex">s/([_%])/$esc$1/g</span><span class="operator">;</span>
</pre>
<p>The ODBC and SQL/CLI specifications define a way to change the default
behaviour described above: All arguments (except <em>list value arguments</em>)
are treated as <em>identifier</em> if the <code>SQL_ATTR_METADATA_ID</code> attribute is
set to <code>SQL_TRUE</code>.
<em>Quoted identifiers</em> are very similar to <em>ordinary values</em>, i.e. their
body (the string within the quotes) is interpreted literally.
<em>Unquoted identifiers</em> are compared in UPPERCASE.</p>
<p>The DBI (currently) does not support the <code>SQL_ATTR_METADATA_ID</code> attribute,
i.e. it behaves like an ODBC driver where <code>SQL_ATTR_METADATA_ID</code> is set to
<code>SQL_FALSE</code>.</p>
<p>
</p>
<h2><a name="transactions">Transactions</a></h2>
<p>Transactions are a fundamental part of any robust database system. They
protect against errors and database corruption by ensuring that sets of
related changes to the database take place in atomic (indivisible,
all-or-nothing) units.</p>
<p>This section applies to databases that support transactions and where
<code>AutoCommit</code> is off.  See <a href="#autocommit">AutoCommit</a> for details of using <code>AutoCommit</code>
with various types of databases.</p>
<p>The recommended way to implement robust transactions in Perl
applications is to use <code>RaiseError</code> and <a&nbsp;href="../lib/pods/perlfunc.html#eval"><code>eval&nbsp;{&nbsp;...&nbsp;}</code></a>
(which is very fast, unlike <a&nbsp;href="../lib/pods/perlfunc.html#eval"><code>eval&nbsp;&quot;...&quot;</code></a>). For example:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">AutoCommit</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">0</span><span class="operator">;</span>  <span class="comment"># enable transactions, if possible</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">RaiseError</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
  <span class="keyword">eval</span> <span class="operator">{</span>
      <span class="variable">foo</span><span class="operator">(...)</span>        <span class="comment"># do lots of work here</span>
      <span class="variable">bar</span><span class="operator">(...)</span>        <span class="comment"># including inserts</span>
      <span class="variable">baz</span><span class="operator">(...)</span>        <span class="comment"># and updates</span>
      <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span><span class="operator">;</span>   <span class="comment"># commit the changes if we get this far</span>
  <span class="operator">};</span>
  <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$@</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">warn</span> <span class="string">"Transaction aborted because $@"</span><span class="operator">;</span>
      <span class="comment"># now rollback to undo the incomplete changes</span>
      <span class="comment"># but do it in an eval{} as it may also fail</span>
      <span class="keyword">eval</span> <span class="operator">{</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">rollback</span> <span class="operator">};</span>
      <span class="comment"># add other application on-error-clean-up code here</span>
  <span class="operator">}</span>
</pre>
<p>If the <code>RaiseError</code> attribute is not set, then DBI calls would need to be
manually checked for errors, typically like this:</p>
<pre>
  <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">method</span><span class="operator">(</span><span class="variable">@args</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="variable">errstr</span><span class="operator">;</span>
</pre>
<p>With <code>RaiseError</code> set, the DBI will automatically <a href="../lib/pods/perlfunc.html#die"><code>die</code></a> if any DBI method
call on that handle (or a child handle) fails, so you don't have to
test the return value of each method call. See <a href="#raiseerror">RaiseError</a> for more
details.</p>
<p>A major advantage of the <a href="../lib/pods/perlfunc.html#eval"><code>eval</code></a> approach is that the transaction will be
properly rolled back if <em>any</em> code (not just DBI calls) in the inner
application dies for any reason. The major advantage of using the
<code>$h-&gt;{RaiseError}</code> attribute is that all DBI calls will be checked
automatically. Both techniques are strongly recommended.</p>
<p>After calling <code>commit</code> or <code>rollback</code> many drivers will not let you
fetch from a previously active <code>SELECT</code> statement handle that's a child
of the same database handle. A typical way round this is to connect the
the database twice and use one connection for <code>SELECT</code> statements.</p>
<p>See <a href="#autocommit">AutoCommit</a> and <a href="#disconnect">disconnect</a> for other important information
about transactions.</p>
<p>
</p>
<h2><a name="handling_blob___long___memo_fields">Handling BLOB / LONG / Memo Fields</a></h2>
<p>Many databases support &quot;blob&quot; (binary large objects), &quot;long&quot;, or similar
datatypes for holding very long strings or large amounts of binary
data in a single field. Some databases support variable length long
values over 2,000,000,000 bytes in length.</p>
<p>Since values of that size can't usually be held in memory, and because
databases can't usually know in advance the length of the longest long
that will be returned from a <code>SELECT</code> statement (unlike other data
types), some special handling is required.</p>
<p>In this situation, the value of the <code>$h-&gt;{LongReadLen}</code>
attribute is used to determine how much buffer space to allocate
when fetching such fields.  The <code>$h-&gt;{LongTruncOk}</code> attribute
is used to determine how to behave if a fetched value can't fit
into the buffer.</p>
<p>See the description of <a href="#longreadlen">LongReadLen</a> for more information.</p>
<p>When trying to insert long or binary values, placeholders should be used
since there are often limits on the maximum size of an <code>INSERT</code>
statement and the <a href="#quote">quote</a> method generally can't cope with binary
data.  See <a href="#placeholders_and_bind_values">Placeholders and Bind Values</a>.</p>
<p>
</p>
<h2><a name="simple_examples">Simple Examples</a></h2>
<p>Here's a complete example program to select and fetch some data:</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$data_source</span> <span class="operator">=</span> <span class="string">"dbi::DriverName:db_name"</span><span class="operator">;</span>
  <span class="keyword">my</span> <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="variable">$data_source</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">)</span>
      <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Can't connect to </span><span class="variable">$data_source</span><span class="string">: </span><span class="variable">$DBI</span><span class="string">::errstr"</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span> <span class="string">q{
          SELECT name, phone
          FROM mytelbook
  }</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Can't prepare statement: </span><span class="variable">$DBI</span><span class="string">::errstr"</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$rc</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span>
      <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Can't execute statement: </span><span class="variable">$DBI</span><span class="string">::errstr"</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">print</span> <span class="string">"Query will return </span><span class="variable">$sth</span><span class="string">-&gt;{NUM_OF_FIELDS} fields.\n\n"</span><span class="operator">;</span>
  <span class="keyword">print</span> <span class="string">"Field names: @{ </span><span class="variable">$sth</span><span class="string">-&gt;{NAME} }\n"</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">while</span> <span class="operator">((</span><span class="variable">$name</span><span class="operator">,</span> <span class="variable">$phone</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_array</span><span class="operator">)</span> <span class="operator">{</span>
      <span class="keyword">print</span> <span class="string">"</span><span class="variable">$name</span><span class="string">: </span><span class="variable">$phone</span><span class="string">\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
  <span class="comment"># check for problems which may have terminated the fetch early</span>
  <span class="keyword">die</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">errstr</span> <span class="keyword">if</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">err</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">disconnect</span><span class="operator">;</span>
</pre>
<p>Here's a complete example program to insert some data from a file.
(This example uses <code>RaiseError</code> to avoid needing to check each call).</p>
<pre>
  <span class="keyword">my</span> <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="string">"dbi:DriverName:db_name"</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span> <span class="operator">{</span>
      <span class="string">RaiseError</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span> <span class="string">AutoCommit</span> <span class="operator">=&gt;</span> <span class="number">0</span>
  <span class="operator">}</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">prepare</span><span class="operator">(</span> <span class="string">q{
      INSERT INTO table (name, phone) VALUES (?, ?)
  }</span><span class="operator">);</span>
</pre>
<pre>
  <span class="keyword">open</span> <span class="variable">FH</span><span class="operator">,</span> <span class="string">"&lt;phone.csv"</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Unable to open phone.csv: $!"</span><span class="operator">;</span>
  <span class="keyword">while</span> <span class="operator">(&lt;</span><span class="variable">FH</span><span class="operator">&gt;)</span> <span class="operator">{</span>
      <span class="keyword">chomp</span><span class="operator">;</span>
      <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$name</span><span class="operator">,</span> <span class="variable">$phone</span><span class="operator">)</span> <span class="operator">=</span> <span class="keyword">split</span> <span class="regex">/,/</span><span class="operator">;</span>
      <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">execute</span><span class="operator">(</span><span class="variable">$name</span><span class="operator">,</span> <span class="variable">$phone</span><span class="operator">);</span>
  <span class="operator">}</span>
  <span class="keyword">close</span> <span class="variable">FH</span><span class="operator">;</span>
</pre>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">commit</span><span class="operator">;</span>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">disconnect</span><span class="operator">;</span>
</pre>
<p>Here's how to convert fetched NULLs (undefined values) into empty strings:</p>
<pre>
  <span class="keyword">while</span><span class="operator">(</span><span class="variable">$row</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">fetchrow_arrayref</span><span class="operator">)</span> <span class="operator">{</span>
    <span class="comment"># this is a fast and simple way to deal with nulls:</span>
    <span class="keyword">foreach</span> <span class="operator">(</span><span class="variable">@$row</span><span class="operator">)</span> <span class="operator">{</span> <span class="variable">$_</span> <span class="operator">=</span> <span class="string">''</span> <span class="keyword">unless</span> <span class="keyword">defined</span> <span class="operator">}</span>
    <span class="keyword">print</span> <span class="string">"@</span><span class="variable">$row</span><span class="string">\n"</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>The <code>q{...}</code> style quoting used in these examples avoids clashing with
quotes that may be used in the SQL statement. Use the double-quote like
<code>qq{...}</code> operator if you want to interpolate variables into the string.
See <a href="../lib/pods/perlop.html#quote_and_quote_like_operators">Quote and Quote-like Operators in the perlop manpage</a> for more details.</p>
<p>
</p>
<h2><a name="threads_and_thread_safety">Threads and Thread Safety</a></h2>
<p>Perl 5.7 and later support a new threading model called iThreads.
(The old &quot;5.005 style&quot; threads are not supported by the DBI.)</p>
<p>In the iThreads model each thread has it's own copy of the perl
interpreter.  When a new thread is created the original perl
interpreter is 'cloned' to create a new copy for the new thread.</p>
<p>If the DBI and drivers are loaded and handles created before the
thread is created then it will get a cloned copy of the DBI, the
drivers and the handles.</p>
<p>However, the internal pointer data within the handles will refer
to the DBI and drivers in the original interpreter. Using those
handles in the new interpreter thread is not safe, so the DBI detects
this and croaks on any method call using handles that don't belong
to the current thread (except for DESTROY).</p>
<p>Because of this (possibly temporary) restriction, newly created
threads must make their own connctions to the database. Handles
can't be shared across threads.</p>
<p>But BEWARE, some underlying database APIs (the code the DBD driver
uses to talk to the database, often supplied by the database vendor)
are not thread safe. If it's not thread safe, then allowing more
than one thread to enter the code at the same time may cause
subtle/serious problems. In some cases allowing more than
one thread to enter the code, even if <em>not</em> at the same time,
can cause problems. You have been warned.</p>
<p>Using DBI with perl threads is not yet recommended for production
environments. For more information see
<a href="http://www.perlmonks.org/index.pl?node_id=288022">http://www.perlmonks.org/index.pl</a></p>
<p>Note: There is a bug in perl 5.8.2 when configured with threads
and debugging enabled (bug #24463) which causes a DBI test to fail.</p>
<p>
</p>
<h2><a name="signal_handling_and_canceling_operations">Signal Handling and Canceling Operations</a></h2>
<p>[The following only applies to systems with unix-like signal handling.
I'd welcome additions for other systems, especially Windows.]</p>
<p>The first thing to say is that signal handling in Perl versions less
than 5.8 is <em>not</em> safe. There is always a small risk of Perl
crashing and/or core dumping when, or after, handling a signal
because the signal could arrive and be handled while internal data
structures are being changed. If the signal handling code
used those same internal data structures it could cause all manner
of subtle and not-so-subtle problems.  The risk was reduced with
5.4.4 but was still present in all perls up through 5.8.0.</p>
<p>Beginning in perl 5.8.0 perl implements 'safe' signal handling if
your system has the POSIX <code>sigaction()</code> routine. Now when a signal
is delivered perl just makes a note of it but does <em>not</em> run the
%SIG handler. The handling is 'defered' until a 'safe' moment.</p>
<p>Although this change made signal handling safe, it also lead to
a problem with signals being defered for longer than you'd like.
If a signal arrived while executing a system call, such as waiting
for data on a network connection, the signal is noted and then the
system call that was executing returns with an EINTR error code
to indicate that it was interrupted. All fine so far.</p>
<p>The problem comes when the code that made the system call sees the
EINTR code and decides it's going to call it again. Perl doesn't
do that, but database code sometimes does. If that happens then the
signal handler doesn't get called untill later. Maybe much later.</p>
<p>Fortunately there are ways around this which we'll discuss below.
Unfortunately they make signals unsafe again.</p>
<p>The two most common uses of signals in relation to the DBI are for
canceling operations when the user types Ctrl-C (interrupt), and for
implementing a timeout using <a href="../lib/pods/perlfunc.html#alarm"><code>alarm()</code></a> and <code>$SIG{ALRM}</code>.</p>
<dl>
<dt><strong><a name="cancel" class="item">Cancel</a></strong>

<dd>
<p>The DBI provides a <code>cancel</code> method for statement handles. The
<code>cancel</code> method should abort the current operation and is designed
to be called from a signal handler.  For example:</p>
</dd>
<dd>
<pre>
  <span class="variable">$SIG</span><span class="operator">{</span><span class="string">INT</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">cancel</span> <span class="operator">};</span>
</pre>
</dd>
<dd>
<p>However, few drivers implement this (the DBI provides a default
method that just returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>) and, even if implemented, there
is still a possibility that the statement handle, and even the
parent database handle, will not be usable afterwards.</p>
</dd>
<dd>
<p>If <code>cancel</code> returns true, then it has successfully
invoked the database engine's own cancel function.  If it returns false,
then <code>cancel</code> failed. If it returns <a href="../lib/pods/perlfunc.html#undef"><code>undef</code></a>, then the database
driver does not have cancel implemented - very few do.</p>
</dd>
</li>
<dt><strong><a name="timeout" class="item">Timeout</a></strong>

<dd>
<p>The traditional way to implement a timeout is to set <code>$SIG{ALRM}</code>
to refer to some code that will be executed when an ALRM signal
arrives and then to call <a href="../lib/pods/perlfunc.html#alarm"><code>alarm($seconds)</code></a> to schedule an ALRM signal
to be delivered $seconds in the future. For example:</p>
</dd>
<dd>
<pre>
  <span class="keyword">eval</span> <span class="operator">{</span>
    <span class="keyword">local</span> <span class="variable">$SIG</span><span class="operator">{</span><span class="string">ALRM</span><span class="operator">}</span> <span class="operator">=</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">die</span> <span class="string">"TIMEOUT\n"</span> <span class="operator">};</span>
    <span class="keyword">alarm</span><span class="operator">(</span><span class="variable">$seconds</span><span class="operator">);</span>
    <span class="operator">...</span> <span class="variable">code</span> <span class="variable">to</span> <span class="variable">execute</span> <span class="variable">with</span> <span class="variable">timeout</span> <span class="variable">here</span> <span class="operator">...</span>
    <span class="keyword">alarm</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span>  <span class="comment"># cancel alarm (if code ran fast)</span>
  <span class="operator">};</span>
  <span class="keyword">alarm</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span>    <span class="comment"># cancel alarm (if eval failed)</span>
  <span class="keyword">if</span> <span class="operator">(</span> <span class="variable">$@</span> <span class="keyword">eq</span> <span class="string">"TIMEOUT\n"</span> <span class="operator">)</span> <span class="operator">{</span> <span class="operator">...</span> <span class="operator">}</span>
</pre>
</dd>
<dd>
<p>Unfortunately, as described above, this won't always work as expected,
depending on your perl version and the underlying database code.</p>
</dd>
<dd>
<p>With Oracle for instance (DBD::Oracle), if the system which hosts
the database is down the DBI-&gt;<a href="../lib/pods/perlfunc.html#connect"><code>connect()</code></a> call will hang for several
minutes before returning an error.</p>
</dd>
</li>
</dl>
<p>The solution on these systems is to use the <code>POSIX::sigaction()</code>
routine to gain low level access to how the signal handler is installed.</p>
<p>The code would look something like this (for the DBD-Oracle connect()):</p>
<pre>
   <span class="keyword">use</span> <span class="variable">POSIX</span> <span class="string">':signal_h'</span><span class="operator">;</span>
</pre>
<pre>
   <span class="keyword">my</span> <span class="variable">$mask</span> <span class="operator">=</span> <span class="variable">POSIX::SigSet</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span> <span class="variable">SIGALRM</span> <span class="operator">);</span> <span class="comment"># signals to mask in the handler</span>
   <span class="keyword">my</span> <span class="variable">$action</span> <span class="operator">=</span> <span class="variable">POSIX::SigAction</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span>
       <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span> <span class="keyword">die</span> <span class="string">"connect timeout"</span> <span class="operator">},</span>        <span class="comment"># the handler code ref</span>
       <span class="variable">$mask</span><span class="operator">,</span>
       <span class="comment"># not using (perl 5.8.2 and later) 'safe' switch or sa_flags</span>
   <span class="operator">);</span>
   <span class="keyword">my</span> <span class="variable">$oldaction</span> <span class="operator">=</span> <span class="variable">POSIX::SigAction</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
   <span class="variable">sigaction</span><span class="operator">(</span> <span class="string">'ALRM'</span><span class="operator">,</span> <span class="variable">$action</span><span class="operator">,</span> <span class="variable">$oldaction</span> <span class="operator">);</span>
   <span class="keyword">my</span> <span class="variable">$dbh</span><span class="operator">;</span>
   <span class="keyword">eval</span> <span class="operator">{</span>
      <span class="keyword">alarm</span><span class="operator">(</span><span class="number">5</span><span class="operator">);</span> <span class="comment"># seconds before time out</span>
      <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(</span><span class="string">"dbi:Oracle:</span><span class="variable">$dsn</span><span class="string">"</span> <span class="operator">...</span> <span class="operator">);</span>
      <span class="keyword">alarm</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span> <span class="comment"># cancel alarm (if connect worked fast)</span>
   <span class="operator">};</span>
   <span class="keyword">alarm</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span>    <span class="comment"># cancel alarm (if eval failed)</span>
   <span class="variable">sigaction</span><span class="operator">(</span> <span class="string">'ALRM'</span><span class="operator">,</span> <span class="variable">$oldaction</span> <span class="operator">);</span>  <span class="comment"># restore original signal handler</span>
   <span class="keyword">if</span> <span class="operator">(</span> <span class="variable">$@</span> <span class="operator">)</span> <span class="operator">....</span>
</pre>
<p>Similar techniques can be used for canceling statement execution.</p>
<p>Unfortunately, this solution is somewhat messy, and it does <em>not</em> work with
perl versions less than perl 5.8 where <code>POSIX::sigaction()</code> appears to be broken.</p>
<p>For a cleaner implementation that works across perl versions, see Lincoln Baxter's
Sys::SigAction module at <a href="http://search.cpan.org/~lbaxter/Sys-SigAction/">http://search.cpan.org/~lbaxter/Sys-SigAction/</a>.
The documentation for Sys::SigAction includes an longer discussion
of this problem, and a DBD::Oracle test script.</p>
<p>Be sure to read all the signal handling sections of the <a href="../lib/pods/perlipc.html">the perlipc manpage</a> manual.</p>
<p>And finally, two more points to keep firmly in mind. Firstly,
remember that what we've done here is essentially revert to old
style <em>unsafe</em> handling of these signals. So do as little as
possible in the handler.  Ideally just <a href="../lib/pods/perlfunc.html#die"><code>die()</code></a>. Secondly, the handles
in use at the time the signal is handled may not be safe to use
afterwards.</p>
<p>
</p>
<h2><a name="subclassing_the_dbi">Subclassing the DBI</a></h2>
<p>DBI can be subclassed and extended just like any other object
oriented module.  Before we talk about how to do that, it's important
to be clear about the various DBI classes and how they work together.</p>
<p>By default <a href="../lib/pods/perlfunc.html#connect"><code>$dbh = DBI-&gt;connect(...)</code></a> returns a $dbh blessed
into the <code>DBI::db</code> class.  And the <code>$dbh-&gt;prepare</code> method
returns an $sth blessed into the <code>DBI::st</code> class (actually it
simply changes the last four characters of the calling handle class
to be <code>::st</code>).</p>
<p>The leading '<code>DBI</code>' is known as the 'root class' and the extra
'<code>::db</code>' or '<code>::st</code>' are the 'handle type suffixes'. If you want
to subclass the DBI you'll need to put your overriding methods into
the appropriate classes.  For example, if you want to use a root class
of <code>MySubDBI</code> and override the <a href="../lib/pods/perlfunc.html#do"><code>do()</code></a>, <code>prepare()</code> and <code>execute()</code> methods,
then your <a href="../lib/pods/perlfunc.html#do"><code>do()</code></a> and <code>prepare()</code> methods should be in the <code>MySubDBI::db</code>
class and the <code>execute()</code> method should be in the <code>MySubDBI::st</code> class.</p>
<p>To setup the inheritance hierarchy the @ISA variable in <code>MySubDBI::db</code>
should include <code>DBI::db</code> and the @ISA variable in <code>MySubDBI::st</code>
should include <code>DBI::st</code>.  The <code>MySubDBI</code> root class itself isn't
currently used for anything visible and so, apart from setting @ISA
to include <code>DBI</code>, it can be left empty.</p>
<p>So, having put your overriding methods into the right classes, and
setup the inheritance hierarchy, how do you get the DBI to use them?
You have two choices, either a static method call using the name
of your subclass:</p>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">MySubDBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(...);</span>
</pre>
<p>or specifying a <code>RootClass</code> attribute:</p>
<pre>
  <span class="variable">$dbh</span> <span class="operator">=</span> <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">connect</span><span class="operator">(...,</span> <span class="operator">{</span> <span class="string">RootClass</span> <span class="operator">=&gt;</span> <span class="string">'MySubDBI'</span> <span class="operator">}</span><span class="operator">);</span>
</pre>
<p>If both forms are used then the attribute takes precedence.</p>
<p>The only differences between the two are that using an explicit
RootClass attribute will a) make the DBI automatically attempt to load
a module by that name if the class doesn't exist, and b) won't call
your MySubDBI::connect() method, if you have one.</p>
<p>When subclassing is being used then, after a successful new
connect, the DBI-&gt;connect method automatically calls:</p>
<pre>
  <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">connected</span><span class="operator">(</span><span class="variable">$dsn</span><span class="operator">,</span> <span class="variable">$user</span><span class="operator">,</span> <span class="variable">$pass</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">%attr</span><span class="operator">);</span>
</pre>
<p>The default method does nothing. The call is made just to simplify
any post-connection setup that your subclass may want to perform.
The parameters are the same as passed to DBI-&gt;connect.
If your subclass supplies a connected method, it should be part of the
MySubDBI::db package.</p>
<p>One more thing to note: you must let the DBI do the handle creation.  If you
want to override the <a href="../lib/pods/perlfunc.html#connect"><code>connect()</code></a> method in your *::dr class then it must still
call SUPER::connect to get a $dbh to work with. Similarly, an overridden
<code>prepare()</code> method in *::db must still call SUPER::prepare to get a $sth.
If you try to create your own handles using <a href="../lib/pods/perlfunc.html#bless"><code>bless()</code></a> then you'll find the DBI
will reject them with an &quot;is not a DBI handle (has no magic)&quot; error.</p>
<p>Here's a brief example of a DBI subclass.  A more thorough example
can be found in <em class="file">t/subclass.t</em> in the DBI distribution.</p>
<pre>
  <span class="keyword">package</span> <span class="variable">MySubDBI</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">use</span> <span class="variable">strict</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">use</span> <span class="variable">DBI</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">vars</span> <span class="string">qw(@ISA)</span><span class="operator">;</span>
  <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI)</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">package</span> <span class="variable">MySubDBI::db</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">vars</span> <span class="string">qw(@ISA)</span><span class="operator">;</span>
  <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::db)</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">sub</span><span class="variable"> prepare </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$dbh</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$sth</span> <span class="operator">=</span> <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">SUPER::prepare</span><span class="operator">(</span><span class="variable">@args</span><span class="operator">)</span>
        <span class="keyword">or</span> <span class="keyword">return</span><span class="operator">;</span>
    <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">private_mysubdbi_info</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">{</span> <span class="string">foo</span> <span class="operator">=&gt;</span> <span class="string">'bar'</span> <span class="operator">}</span><span class="operator">;</span>
    <span class="keyword">return</span> <span class="variable">$sth</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<pre>
  <span class="keyword">package</span> <span class="variable">MySubDBI::st</span><span class="operator">;</span>
  <span class="keyword">use</span> <span class="variable">vars</span> <span class="string">qw(@ISA)</span><span class="operator">;</span>
  <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(DBI::st)</span><span class="operator">;</span>
</pre>
<pre>
  <span class="keyword">sub</span><span class="variable"> fetch </span><span class="operator">{</span>
    <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$sth</span><span class="operator">,</span> <span class="variable">@args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$row</span> <span class="operator">=</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">SUPER::fetch</span><span class="operator">(</span><span class="variable">@args</span><span class="operator">)</span>
        <span class="keyword">or</span> <span class="keyword">return</span><span class="operator">;</span>
    <span class="variable">do_something_magical_with_row_data</span><span class="operator">(</span><span class="variable">$row</span><span class="operator">)</span>
        <span class="keyword">or</span> <span class="keyword">return</span> <span class="variable">$sth</span><span class="operator">-&gt;</span><span class="variable">set_err</span><span class="operator">(</span><span class="number">1234</span><span class="operator">,</span> <span class="string">"The magic failed"</span><span class="operator">,</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="string">"fetch"</span><span class="operator">);</span>
    <span class="keyword">return</span> <span class="variable">$row</span><span class="operator">;</span>
  <span class="operator">}</span>
</pre>
<p>When calling a SUPER::method that returns a handle, be careful to
check the return value before trying to do other things with it in
your overridden method. This is especially important if you want to
set a hash attribute on the handle, as Perl's autovivification will
bite you by (in)conveniently creating an unblessed hashref, which your
method will then return with usually baffling results later on like
the error &quot;dbih_getcom handle HASH(0xa4451a8) is not a DBI handle (has
no magic&quot;.  It's best to check right after the call and return undef
immediately on error, just like DBI would and just like the example
above.</p>
<p>If your method needs to record an error it should call the <code>set_err()</code>
method with the error code and error string, as shown in the example
above. The error code and error string will be recorded in the
handle and available via <code>$h-&gt;err</code> and <code>$DBI::errstr</code> etc.
The <code>set_err()</code> method always returns an undef or empty list as
approriate. Since your method should nearly always return an undef
or empty list as soon as an error is detected it's handy to simply
return what <code>set_err()</code> returns, as shown in the example above.</p>
<p>If the handle has <code>RaiseError</code>, <code>PrintError</code>, or <code>HandleError</code>
etc. set then the <code>set_err()</code> method will honour them. This means
that if <code>RaiseError</code> is set then <code>set_err()</code> won't return in the
normal way but will 'throw an exception' that can be caught with
an <a href="../lib/pods/perlfunc.html#eval"><code>eval</code></a> block.</p>
<p>You can stash private data into DBI handles
via <code>$h-&gt;{private_..._*}</code>.  See the entry under <a href="#attributes_common_to_all_handles">ATTRIBUTES COMMON TO ALL HANDLES</a> for info and important caveats.</p>
<p>
</p>
<hr />
<h1><a name="tracing">TRACING</a></h1>
<p>The DBI has a powerful tracing mechanism built in. It enables you
to see what's going on 'behind the scenes', both within the DBI and
the drivers you're using.</p>
<p>
</p>
<h2><a name="trace_settings">Trace Settings</a></h2>
<p>Which details are written to the trace output is controlled by a
combination of a <em>trace level</em>, an integer from 0 to 15, and a set
of <em>trace flags</em> that are either on or off. Together these are known
as the <em>trace settings</em> and are stored together in a single integer.
For normal use you only need to set the trace level, and generally
only to a value between 1 and 4.</p>
<p>Each handle has it's own trace settings, and so does the DBI.
When you call a method the DBI merges the handles settings into its
own for the duration of the call: the trace flags of the handle are
OR'd into the trace flags of the DBI, and if the handle has a higher
trace level then the DBI trace level is raised to match it.
The previous DBI trace setings are restored when the called method
returns.</p>
<p>
</p>
<h2><a name="trace_levels">Trace Levels</a></h2>
<p>Trace <em>levels</em> are as follows:</p>
<pre>
  0 - Trace disabled.
  1 - Trace top-level DBI method calls returning with results or errors.
  2 - As above, adding tracing of top-level method entry with parameters.
  3 - As above, adding some high-level information from the driver
      and some internal information from the DBI.
  4 - As above, adding more detailed information from the driver.
      This is the first level to trace all the rows being fetched.
  5 to 15 - As above but with more and more internal information.</pre>
<p>Trace level 1 is best for a simple overview of what's happening.
Trace levels 2 thru 4 a good choice for general purpose tracing.
Levels 5 and above are best reserved for investigating a specific
problem, when you need to see &quot;inside&quot; the driver and DBI.</p>
<p>The trace output is detailed and typically very useful. Much of the
trace output is formatted using the <a href="#neat">neat</a> function, so strings
in the trace output may be edited and truncated by that function.</p>
<p>
</p>
<h2><a name="trace_flags">Trace Flags</a></h2>
<p>Trace <em>flags</em> are used to enable tracing of specific activities
within the DBI and drivers. The DBI defines some trace flags and
drivers can define others. DBI trace flag names begin with a capital
letter and driver specific names begin with a lowercase letter, as
usual.</p>
<p>Curently the DBI only defines two trace flags:</p>
<pre>
  ALL - turn on all DBI and driver flags (not recommended)
  SQL - trace SQL statements executed (not yet implemented)</pre>
<p>The <a href="#parse_trace_flags">parse_trace_flags</a> and <a href="#parse_trace_flag">parse_trace_flag</a> methods are used
to convert trace flag names into the coresponding integer bit flags.</p>
<p>
</p>
<h2><a name="enabling_trace">Enabling Trace</a></h2>
<p>The <code>$h-&gt;trace</code> method sets the trace settings for a handle
and <code>DBI-&gt;trace</code> does the same for the DBI.</p>
<p>In addition to the <a href="#trace">trace</a> method, you can enable the same trace
information, and direct the output to a file, by setting the
<code>DBI_TRACE</code> environment variable before starting Perl.
See <a href="#dbi_trace">DBI_TRACE</a> for more information.</p>
<p>Finally, you can set, or get, the trace settings for a handle using
the <code>TraceLevel</code> attribute.</p>
<p>All of those methods use <code>parse_trace_flags()</code> and so allow you set
both the trace level and multiple trace flags by using a string
containing the trace level and/or flag names separated by vertical
bar (&quot;<code>|</code>&quot;) or comma (&quot;<code>,</code>&quot;) characters. For example:</p>
<pre>
  <span class="keyword">local</span> <span class="variable">$h</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">TraceLevel</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"3|SQL|foo"</span><span class="operator">;</span>
</pre>
<p>
</p>
<h2><a name="trace_output">Trace Output</a></h2>
<p>Initially trace output is written to <code>STDERR</code>.  Both the
<code>$h-&gt;trace</code> and <code>DBI-&gt;trace</code> methods take an optional
$trace_file parameter, which may be either the name of a file to be
openned by DBI in append mode, or a reference to an existing writable
(possibly layered) filehandle. If $trace_file is a filename,
and can be opened in append mode, or $trace_file is a writable
filehandle, then <em>all</em> trace output (currently including that from
other handles) is redirected to that file. A warning is generated
if $trace_file can't be opened or is not writable.</p>
<p>Further calls to <code>trace()</code> without $trace_file do not alter where
the trace output is sent. If $trace_file is undefined, then
trace output is sent to <code>STDERR</code> and, if the prior trace was openned with
$trace_file as a filename, the previous trace file is closed; if $trace_file was
a filehandle, the filehandle is <strong>not</strong> closed.</p>
<p><strong>NOTE</strong>: If $trace_file is specified as a filehandle, the filehandle
should not be closed until all DBI operations are completed, or the
application has reset the trace file via another call to
<code>trace()</code> that changes the trace file.</p>
<p>
</p>
<h2><a name="tracing_to_layered_filehandles">Tracing to Layered Filehandles</a></h2>
<p><strong>NOTE</strong>:</p>
<ul>
<li><strong><a name="tied_filehandles_are_not_currently_supported_as_tie_operations_are_not_available_to_the_perlio_methods_used_by_the_dbi" class="item">Tied filehandles are not currently supported, as
tie operations are not available to the PerlIO
methods used by the DBI.</a></strong>

<li><strong><a name="perlio_layer_support_requires_perl_version_5_8_or_higher" class="item">PerlIO layer support requires Perl version 5.8 or higher.</a></strong>

</ul>
<p>As of version 5.8, Perl provides the ability to layer various
&quot;disciplines&quot; on an open filehandle via the <a href="../lib/PerlIO.html">the PerlIO manpage</a> module.</p>
<p>A simple example of using PerlIO layers is to use a scalar as the output:</p>
<pre>
    <span class="keyword">my</span> <span class="variable">$scalar</span> <span class="operator">=</span> <span class="string">''</span><span class="operator">;</span>
    <span class="keyword">open</span><span class="operator">(</span> <span class="keyword">my</span> <span class="variable">$fh</span><span class="operator">,</span> <span class="string">"+&gt;:scalar"</span><span class="operator">,</span> <span class="operator">\</span><span class="variable">$scalar</span> <span class="operator">);</span>
    <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span> <span class="number">2</span><span class="operator">,</span> <span class="variable">$fh</span> <span class="operator">);</span>
</pre>
<p>Now all trace output is simply appended to $scalar.</p>
<p>A more complex application of tracing to a layered filehandle is the
use of a custom layer (<em>Refer to </em><a href="../Perlio/via.html">the Perlio::via manpage</a> <em>for details
on creating custom PerlIO layers.</em>). Consider an application with the
following logger module:</p>
<pre>
    <span class="keyword">package</span> <span class="variable">MyFancyLogger</span><span class="operator">;</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> new
    </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="operator">{}</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$fh</span><span class="operator">;</span>
        <span class="keyword">open</span> <span class="variable">$fh</span><span class="operator">,</span> <span class="string">'&gt;'</span><span class="operator">,</span> <span class="string">'fancylog.log'</span><span class="operator">;</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$fh</span><span class="operator">;</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">''</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">bless</span> <span class="variable">$self</span><span class="operator">,</span> <span class="keyword">shift</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> log
    </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">unless</span> <span class="keyword">exists</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$fh</span> <span class="operator">=</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span><span class="operator">;</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span> <span class="operator">.=</span> <span class="keyword">shift</span><span class="operator">;</span>
    <span class="comment">#</span>
    <span class="comment"># DBI feeds us pieces at a time, so accumulate a complete line</span>
    <span class="comment"># before outputing</span>
    <span class="comment">#</span>
        <span class="keyword">print</span> <span class="variable">$fh</span> <span class="string">"At "</span><span class="operator">,</span> <span class="keyword">scalar</span> <span class="keyword">localtime</span><span class="operator">(),</span> <span class="string">':'</span><span class="operator">,</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span> <span class="keyword">and</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">''</span>
            <span class="keyword">if</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span><span class="operator">=~</span><span class="regex">tr/\n//</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> close </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">unless</span> <span class="keyword">exists</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$fh</span> <span class="operator">=</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">print</span> <span class="variable">$fh</span> <span class="string">"At "</span><span class="operator">,</span> <span class="keyword">scalar</span> <span class="keyword">localtime</span><span class="operator">(),</span> <span class="string">':'</span><span class="operator">,</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span> <span class="keyword">and</span>
        <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">''</span>
            <span class="keyword">if</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_buf</span><span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">close</span> <span class="variable">$fh</span><span class="operator">;</span>
        <span class="keyword">delete</span> <span class="variable">$self</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_fh</span><span class="operator">}</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="number">1</span><span class="operator">;</span>
</pre>
<p>To redirect DBI traces to this logger requires creating
a package for the layer:</p>
<pre>
    <span class="keyword">package</span> <span class="variable">PerlIO::via::MyFancyLogLayer</span><span class="operator">;</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> PUSHED
    </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$class</span><span class="operator">,</span><span class="variable">$mode</span><span class="operator">,</span><span class="variable">$fh</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$logger</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">bless</span> <span class="operator">\</span><span class="variable">$logger</span><span class="operator">,</span><span class="variable">$class</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> OPEN </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$path</span><span class="operator">,</span> <span class="variable">$mode</span><span class="operator">,</span> <span class="variable">$fh</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
        <span class="comment">#</span>
        <span class="comment"># $path is actually our logger object</span>
        <span class="comment">#</span>
        <span class="variable">$$self</span> <span class="operator">=</span> <span class="variable">$path</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="number">1</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> WRITE
    </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span> <span class="variable">$buf</span><span class="operator">,</span> <span class="variable">$fh</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
        <span class="variable">$$self</span><span class="operator">-&gt;</span><span class="variable">log</span><span class="operator">(</span><span class="variable">$buf</span><span class="operator">);</span>
        <span class="keyword">return</span> <span class="keyword">length</span><span class="operator">(</span><span class="variable">$buf</span><span class="operator">);</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="keyword">sub</span><span class="variable"> CLOSE </span><span class="operator">{</span>
        <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
        <span class="variable">$$self</span><span class="operator">-&gt;</span><span class="variable">close</span><span class="operator">();</span>
        <span class="keyword">return</span> <span class="number">0</span><span class="operator">;</span>
    <span class="operator">}</span>
</pre>
<pre>
    <span class="number">1</span><span class="operator">;</span>
</pre>
<p>The application can then cause DBI traces to be routed to the
logger using</p>
<pre>
    <span class="keyword">use</span> <span class="variable">PerlIO::via::MyFancyLogLayer</span><span class="operator">;</span>
</pre>
<pre>
    <span class="keyword">open</span> <span class="keyword">my</span> <span class="variable">$fh</span><span class="operator">,</span> <span class="string">'&gt;:via(MyFancyLogLayer)'</span><span class="operator">,</span> <span class="variable">MyFancyLogger</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">();</span>
</pre>
<pre>
    <span class="variable">$dbh</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="string">'SQL'</span><span class="operator">,</span> <span class="variable">$fh</span><span class="operator">);</span>
</pre>
<p>Now all trace output will be processed by MyFancyLogger's
<a href="../lib/pods/perlfunc.html#log"><code>log()</code></a> method.</p>
<p>
</p>
<h2><a name="trace_content">Trace Content</a></h2>
<p>Many of the values embeded in trace output are formatted using the <code>neat()</code>
utility function. This means they may be quoted, sanitized, and possibly
truncated if longer than <code>$DBI::neat_maxlen</code>. See <a href="#neat">neat</a> for more details.</p>
<p>
</p>
<h2><a name="tracing_tips">Tracing Tips</a></h2>
<p>You can add tracing to your own application code using the <a href="#trace_msg">trace_msg</a> method.</p>
<p>It can sometimes be handy to compare trace files from two different runs of the
same script. However using a tool like <code>diff</code> on the original log output
doesn't work well because the trace file is full of object addresses that may
differ on each run.</p>
<p>The DBI includes a handy utility called dbilogstrip that can be used to
'normalize' the log content. It can be used as a filter like this:</p>
<pre>
    DBI_TRACE=2 perl yourscript.pl ...args1... 2&gt;&amp;1 | dbilogstrip &gt; dbitrace1.log
    DBI_TRACE=2 perl yourscript.pl ...args2... 2&gt;&amp;1 | dbilogstrip &gt; dbitrace2.log
    diff -u dbitrace1.log dbitrace2.log</pre>
<p>See <a href="../bin/dbilogstrip.html">the dbilogstrip manpage</a> for more information.</p>
<p>
</p>
<hr />
<h1><a name="dbi_environment_variables">DBI ENVIRONMENT VARIABLES</a></h1>
<p>The DBI module recognizes a number of environment variables, but most of
them should not be used most of the time.
It is better to be explicit about what you are doing to avoid the need
for environment variables, especially in a web serving system where web
servers are stingy about which environment variables are available.</p>
<p>
</p>
<h2><a name="dbi_dsn">DBI_DSN</a></h2>
<p>The DBI_DSN environment variable is used by DBI-&gt;connect if you do not
specify a data source when you issue the connect.
It should have a format such as &quot;dbi:Driver:databasename&quot;.</p>
<p>
</p>
<h2><a name="dbi_driver">DBI_DRIVER</a></h2>
<p>The DBI_DRIVER environment variable is used to fill in the database
driver name in DBI-&gt;connect if the data source string starts &quot;dbi::&quot;
(thereby omitting the driver).
If DBI_DSN omits the driver name, DBI_DRIVER can fill the gap.</p>
<p>
</p>
<h2><a name="dbi_autoproxy">DBI_AUTOPROXY</a></h2>
<p>The DBI_AUTOPROXY environment variable takes a string value that starts
&quot;dbi:Proxy:&quot; and is typically followed by &quot;hostname=...;port=...&quot;.
It is used to alter the behaviour of DBI-&gt;connect.
For full details, see DBI::Proxy documentation.</p>
<p>
</p>
<h2><a name="dbi_user">DBI_USER</a></h2>
<p>The DBI_USER environment variable takes a string value that is used as
the user name if the DBI-&gt;connect call is given undef (as distinct from
an empty string) as the username argument.
Be wary of the security implications of using this.</p>
<p>
</p>
<h2><a name="dbi_pass">DBI_PASS</a></h2>
<p>The DBI_PASS environment variable takes a string value that is used as
the password if the DBI-&gt;connect call is given undef (as distinct from
an empty string) as the password argument.
Be extra wary of the security implications of using this.</p>
<p>
</p>
<h2><a name="dbi_dbname__obsolete_">DBI_DBNAME (obsolete)</a></h2>
<p>The DBI_DBNAME environment variable takes a string value that is used only when the
obsolescent style of DBI-&gt;connect (with driver name as fourth parameter) is used, and
when no value is provided for the first (database name) argument.</p>
<p>
</p>
<h2><a name="dbi_trace">DBI_TRACE</a></h2>
<p>The DBI_TRACE environment variable specifies the global default
trace settings for the DBI at startup. Can also be used to direct
trace output to a file. When the DBI is loaded it does:</p>
<pre>
  <span class="variable">DBI</span><span class="operator">-&gt;</span><span class="variable">trace</span><span class="operator">(</span><span class="keyword">split</span> <span class="regex">/=/</span><span class="operator">,</span> <span class="variable">$ENV</span><span class="operator">{</span><span class="string">DBI_TRACE</span><span class="operator">}</span><span class="operator">,</span> <span class="number">2</span><span class="operator">)</span> <span class="keyword">if</span> <span class="variable">$ENV</span><span class="operator">{</span><span class="string">DBI_TRACE</span><span class="operator">}</span><span class="operator">;</span>
</pre>
<p>So if <code>DBI_TRACE</code> contains an &quot;<code>=</code>&quot; character then what follows
it is used as the name of the file to append the trace to.</p>
<p>output appended to that file. If the name begins with a number
followed by an equal sign (<code>=</code>), then the number and the equal sign are
stripped off from the name, and the number is used to set the trace
level. For example:</p>
<pre>
  DBI_TRACE=1=dbitrace.log perl your_test_script.pl</pre>
<p>On Unix-like systems using a Bourne-like shell, you can do this easily
on the command line:</p>
<pre>
  DBI_TRACE=2 perl your_test_script.pl</pre>
<p>See <a href="#tracing">TRACING</a> for more information.</p>
<p>
</p>
<h2><a name="perl_dbi_debug__obsolete_">PERL_DBI_DEBUG (obsolete)</a></h2>
<p>An old variable that should no longer be used; equivalent to DBI_TRACE.</p>
<p>
</p>
<h2><a name="dbi_profile">DBI_PROFILE</a></h2>
<p>The DBI_PROFILE environment variable can be used to enable profiling
of DBI method calls. See <a href="../lib/DBI/Profile.html">the DBI::Profile manpage</a> for more information.</p>
<p>
</p>
<h2><a name="dbi_pureperl">DBI_PUREPERL</a></h2>
<p>The DBI_PUREPERL environment variable can be used to enable the
use of DBI::PurePerl.  See <a href="../lib/DBI/PurePerl.html">the DBI::PurePerl manpage</a> for more information.</p>
<p>
</p>
<hr />
<h1><a name="warning_and_error_messages">WARNING AND ERROR MESSAGES</a></h1>
<p>
</p>
<h2><a name="fatal_errors">Fatal Errors</a></h2>
<dl>
<dt><strong><a name="can_t_call_method_prepare_without_a_package_or_object_reference" class="item">Can't call method &quot;prepare&quot; without a package or object reference</a></strong>

<dd>
<p>The <code>$dbh</code> handle you're using to call <code>prepare</code> is probably undefined because
the preceding <a href="../lib/pods/perlfunc.html#connect"><code>connect</code></a> failed. You should always check the return status of
DBI methods, or use the <a href="#raiseerror">RaiseError</a> attribute.</p>
</dd>
</li>
<dt><strong><a name="can_t_call_method_execute_without_a_package_or_object_reference" class="item">Can't call method &quot;execute&quot; without a package or object reference</a></strong>

<dd>
<p>The <code>$sth</code> handle you're using to call <code>execute</code> is probably undefined because
the preceeding <code>prepare</code> failed. You should always check the return status of
DBI methods, or use the <a href="#raiseerror">RaiseError</a> attribute.</p>
</dd>
</li>
<dt><strong><a name="dbi_dbd_internal_version_mismatch" class="item">DBI/DBD internal version mismatch</a></strong>

<dd>
<p>The DBD driver module was built with a different version of DBI than
the one currently being used.  You should rebuild the DBD module under
the current version of DBI.</p>
</dd>
<dd>
<p>(Some rare platforms require &quot;static linking&quot;. On those platforms, there
may be an old DBI or DBD driver version actually embedded in the Perl
executable being used.)</p>
</dd>
</li>
<dt><strong><a name="dbd_driver_has_not_implemented_the_autocommit_attribute" class="item">DBD driver has not implemented the AutoCommit attribute</a></strong>

<dd>
<p>The DBD driver implementation is incomplete. Consult the author.</p>
</dd>
</li>
<dt><strong><a name="can_t_sg_et_s_s_unrecognised_attribute" class="item">Can't [sg]et %s-&gt;{%s}: unrecognised attribute</a></strong>

<dd>
<p>You attempted to set or get an unknown attribute of a handle.  Make
sure you have spelled the attribute name correctly; case is significant
(e.g., &quot;Autocommit&quot; is not the same as &quot;AutoCommit&quot;).</p>
</dd>
</li>
</dl>
<p>
</p>
<hr />
<h1><a name="pure_perl_dbi">Pure-Perl DBI</a></h1>
<p>A pure-perl emulation of the DBI is included in the distribution
for people using pure-perl drivers who, for whatever reason, can't
install the compiled DBI. See <a href="../lib/DBI/PurePerl.html">the DBI::PurePerl manpage</a>.</p>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>
</p>
<h2><a name="driver_and_database_documentation">Driver and Database Documentation</a></h2>
<p>Refer to the documentation for the DBD driver that you are using.</p>
<p>Refer to the SQL Language Reference Manual for the database engine that you are using.</p>
<p>
</p>
<h2><a name="odbc_and_sql_cli_standards_reference_information">ODBC and SQL/CLI Standards Reference Information</a></h2>
<p>More detailed information about the semantics of certain DBI methods
that are based on ODBC and SQL/CLI standards is available on-line
via microsoft.com, for ODBC, and www.jtc1sc32.org for the SQL/CLI
standard:</p>
<pre>
 DBI method        ODBC function     SQL/CLI Working Draft
 ----------        -------------     ---------------------
 column_info       SQLColumns        Page 124
 foreign_key_info  SQLForeignKeys    Page 163
 get_info          SQLGetInfo        Page 214
 primary_key_info  SQLPrimaryKeys    Page 254
 table_info        SQLTables         Page 294
 type_info         SQLGetTypeInfo    Page 239
 statistics_info   SQLStatistics</pre>
<p>For example, for ODBC information on SQLColumns you'd visit:</p>
<pre>
  <a href="http://msdn.microsoft.com/library/en-us/odbc/htm/odbcsqlcolumns.asp">http://msdn.microsoft.com/library/en-us/odbc/htm/odbcsqlcolumns.asp</a></pre>
<p>If that URL ceases to work then use the MSDN search facility at:</p>
<pre>
  <a href="http://search.microsoft.com/us/dev/">http://search.microsoft.com/us/dev/</a></pre>
<p>and search for <code>SQLColumns returns</code> using the exact phrase option.
The link you want will probably just be called <code>SQLColumns</code> and will
be part of the Data Access SDK.</p>
<p>And for SQL/CLI standard information on SQLColumns you'd read page 124 of
the (very large) SQL/CLI Working Draft available from:</p>
<pre>
  <a href="http://jtc1sc32.org/doc/N0701-0750/32N0744T.pdf">http://jtc1sc32.org/doc/N0701-0750/32N0744T.pdf</a></pre>
<p>
</p>
<h2><a name="standards_reference_information">Standards Reference Information</a></h2>
<p>A hyperlinked, browsable version of the BNF syntax for SQL92 (plus
Oracle 7 SQL and PL/SQL) is available here:</p>
<pre>
  <a href="http://cui.unige.ch/db-research/Enseignement/analyseinfo/SQL92/BNFindex.html">http://cui.unige.ch/db-research/Enseignement/analyseinfo/SQL92/BNFindex.html</a></pre>
<p>A BNF syntax for SQL3 is available here:</p>
<pre>
  <a href="http://www.sqlstandards.org/SC32/WG3/Progression_Documents/Informal_working_drafts/iso-9075-2-1999.bnf">http://www.sqlstandards.org/SC32/WG3/Progression_Documents/Informal_working_drafts/iso-9075-2-1999.bnf</a></pre>
<p>The following links provide further useful information about SQL.
Some of these are rather dated now but may still be useful.</p>
<pre>
  <a href="http://www.jcc.com/SQLPages/jccs_sql.htm">http://www.jcc.com/SQLPages/jccs_sql.htm</a>
  <a href="http://www.contrib.andrew.cmu.edu/~shadow/sql.html">http://www.contrib.andrew.cmu.edu/~shadow/sql.html</a>
  <a href="http://www.altavista.com/query?q=sql+tutorial">http://www.altavista.com/query?q=sql+tutorial</a></pre>
<p>
</p>
<h2><a name="books_and_articles">Books and Articles</a></h2>
<p>Programming the Perl DBI, by Alligator Descartes and Tim Bunce.
<a href="http://books.perl.org/book/154">http://books.perl.org/book/154</a></p>
<p>Programming Perl 3rd Ed. by Larry Wall, Tom Christiansen &amp; Jon Orwant.
<a href="http://books.perl.org/book/134">http://books.perl.org/book/134</a></p>
<p>Learning Perl by Randal Schwartz.
<a href="http://books.perl.org/book/101">http://books.perl.org/book/101</a></p>
<p>Details of many other books related to perl can be found at <a href="http://books.perl.org">http://books.perl.org</a></p>
<p>
</p>
<h2><a name="perl_modules">Perl Modules</a></h2>
<p>Index of DBI related modules available from CPAN:</p>
<pre>
 <a href="http://search.cpan.org/search?mode=module&amp;query=DBIx%3A%3A">http://search.cpan.org/search?mode=module&amp;query=DBIx%3A%3A</a>
 <a href="http://search.cpan.org/search?mode=doc&amp;query=DBI">http://search.cpan.org/search?mode=doc&amp;query=DBI</a></pre>
<p>For a good comparison of RDBMS-OO mappers and some OO-RDBMS mappers
(including Class::DBI, Alzabo, and DBIx::RecordSet in the former
category and Tangram and SPOPS in the latter) see the Perl
Object-Oriented Persistence project pages at:</p>
<pre>
 <a href="http://poop.sourceforge.net">http://poop.sourceforge.net</a></pre>
<p>A similar page for Java toolkits can be found at:</p>
<pre>
 <a href="http://c2.com/cgi-bin/wiki?ObjectRelationalToolComparison">http://c2.com/cgi-bin/wiki?ObjectRelationalToolComparison</a></pre>
<p>
</p>
<h2><a name="mailing_list">Mailing List</a></h2>
<p>The <em>dbi-users</em> mailing list is the primary means of communication among
users of the DBI and its related modules. For details send email to:</p>
<pre>
 dbi-users-help@perl.org</pre>
<p>There are typically between 700 and 900 messages per month.  You have
to subscribe in order to be able to post. However you can opt for a
'post-only' subscription.</p>
<p>Mailing list archives (of variable quality) are held at:</p>
<pre>
 <a href="http://groups.google.com/groups?group=perl.dbi.users">http://groups.google.com/groups?group=perl.dbi.users</a>
 <a href="http://www.xray.mpe.mpg.de/mailing-lists/dbi/">http://www.xray.mpe.mpg.de/mailing-lists/dbi/</a>
 <a href="http://www.mail-archive.com/dbi-users%40perl.org/">http://www.mail-archive.com/dbi-users%40perl.org/</a></pre>
<p>
</p>
<h2><a name="assorted_related_www_links">Assorted Related WWW Links</a></h2>
<p>The DBI &quot;Home Page&quot;:</p>
<pre>
 <a href="http://dbi.perl.org/">http://dbi.perl.org/</a></pre>
<p>Other DBI related links:</p>
<pre>
 <a href="http://tegan.deltanet.com/~phlip/DBUIdoc.html">http://tegan.deltanet.com/~phlip/DBUIdoc.html</a>
 <a href="http://dc.pm.org/perl_db.html">http://dc.pm.org/perl_db.html</a>
 <a href="http://wdvl.com/Authoring/DB/Intro/toc.html">http://wdvl.com/Authoring/DB/Intro/toc.html</a>
 <a href="http://www.hotwired.com/webmonkey/backend/tutorials/tutorial1.html">http://www.hotwired.com/webmonkey/backend/tutorials/tutorial1.html</a>
 <a href="http://bumppo.net/lists/macperl/1999/06/msg00197.html">http://bumppo.net/lists/macperl/1999/06/msg00197.html</a>
 <a href="http://gmax.oltrelinux.com/dbirecipes.html">http://gmax.oltrelinux.com/dbirecipes.html</a></pre>
<p>Other database related links:</p>
<pre>
 <a href="http://www.jcc.com/sql_stnd.html">http://www.jcc.com/sql_stnd.html</a>
 <a href="http://cuiwww.unige.ch/OSG/info/FreeDB/FreeDB.home.html">http://cuiwww.unige.ch/OSG/info/FreeDB/FreeDB.home.html</a>
 <a href="http://www.connectionstrings.com/">http://www.connectionstrings.com/</a></pre>
<p>Security, especially the &quot;SQL Injection&quot; attack:</p>
<pre>
 <a href="http://www.ngssoftware.com/research/papers.html">http://www.ngssoftware.com/research/papers.html</a>
 <a href="http://www.ngssoftware.com/papers/advanced_sql_injection.pdf">http://www.ngssoftware.com/papers/advanced_sql_injection.pdf</a>
 <a href="http://www.ngssoftware.com/papers/more_advanced_sql_injection.pdf">http://www.ngssoftware.com/papers/more_advanced_sql_injection.pdf</a>
 <a href="http://www.esecurityplanet.com/trends/article.php/2243461">http://www.esecurityplanet.com/trends/article.php/2243461</a>
 <a href="http://www.spidynamics.com/papers/SQLInjectionWhitePaper.pdf">http://www.spidynamics.com/papers/SQLInjectionWhitePaper.pdf</a>
 <a href="http://www.imperva.com/application_defense_center/white_papers/blind_sql_server_injection.html">http://www.imperva.com/application_defense_center/white_papers/blind_sql_server_injection.html</a>
 <a href="http://online.securityfocus.com/infocus/1644">http://online.securityfocus.com/infocus/1644</a></pre>
<p>Commercial and Data Warehouse Links</p>
<pre>
 <a href="http://www.dwinfocenter.org">http://www.dwinfocenter.org</a>
 <a href="http://www.datawarehouse.com">http://www.datawarehouse.com</a>
 <a href="http://www.datamining.org">http://www.datamining.org</a>
 <a href="http://www.olapcouncil.org">http://www.olapcouncil.org</a>
 <a href="http://www.idwa.org">http://www.idwa.org</a>
 <a href="http://www.knowledgecenters.org/dwcenter.asp">http://www.knowledgecenters.org/dwcenter.asp</a></pre>
<p>Recommended Perl Programming Links</p>
<pre>
 <a href="http://language.perl.com/style/">http://language.perl.com/style/</a></pre>
<p>
</p>
<h2><a name="faq">FAQ</a></h2>
<p>See <a href="http://faq.dbi-support.com/">http://faq.dbi-support.com/</a></p>
<p>
</p>
<hr />
<h1><a name="authors">AUTHORS</a></h1>
<p>DBI by Tim Bunce, <a href="http://www.tim.bunce.name">http://www.tim.bunce.name</a></p>
<p>This pod text by Tim Bunce, J. Douglas Dunlop, Jonathan Leffler and others.
Perl by Larry Wall and the <code>perl5-porters</code>.</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<p>The DBI module is Copyright (c) 1994-2008 Tim Bunce. Ireland.
All rights reserved.</p>
<p>You may distribute under the terms of either the GNU General Public
License or the Artistic License, as specified in the Perl README file.</p>
<p>
</p>
<hr />
<h1><a name="support___warranty">SUPPORT / WARRANTY</a></h1>
<p>The DBI is free Open Source software. IT COMES WITHOUT WARRANTY OF ANY KIND.</p>
<p>
</p>
<h2><a name="support">Support</a></h2>
<p>My consulting company, Data Plan Services, offers annual and
multi-annual support contracts for the DBI. These provide sustained
support for DBI development, and sustained value for you in return.
Contact me for details.</p>
<p>
</p>
<h2><a name="sponsor_enhancements">Sponsor Enhancements</a></h2>
<p>The DBI Roadmap is available at <a href="http://search.cpan.org/~timb/DBI/Roadmap.pod">http://search.cpan.org/~timb/DBI/Roadmap.pod</a></p>
<p>If your company would benefit from a specific new DBI feature,
please consider sponsoring its development.  Work is performed
rapidly, and usually on a fixed-price payment-on-delivery basis.
Contact me for details.</p>
<p>Using such targeted financing allows you to contribute to DBI
development, and rapidly get something specific and valuable in return.</p>
<p>
</p>
<hr />
<h1><a name="acknowledgements">ACKNOWLEDGEMENTS</a></h1>
<p>I would like to acknowledge the valuable contributions of the many
people I have worked with on the DBI project, especially in the early
years (1992-1994). In no particular order: Kevin Stock, Buzz Moschetti,
Kurt Andersen, Ted Lemon, William Hails, Garth Kennedy, Michael Peppler,
Neil S. Briscoe, Jeff Urlwin, David J. Hughes, Jeff Stander,
Forrest D Whitcher, Larry Wall, Jeff Fried, Roy Johnson, Paul Hudson,
Georg Rehfeld, Steve Sizemore, Ron Pool, Jon Meek, Tom Christiansen,
Steve Baumgarten, Randal Schwartz, and a whole lot more.</p>
<p>Then, of course, there are the poor souls who have struggled through
untold and undocumented obstacles to actually implement DBI drivers.
Among their ranks are Jochen Wiedmann, Alligator Descartes, Jonathan
Leffler, Jeff Urlwin, Michael Peppler, Henrik Tougaard, Edwin Pratomo,
Davide Migliavacca, Jan Pazdziora, Peter Haworth, Edmund Mergl, Steve
Williams, Thomas Lowery, and Phlip Plumlee. Without them, the DBI would
not be the practical reality it is today.  I'm also especially grateful
to Alligator Descartes for starting work on the first edition of the
&quot;Programming the Perl DBI&quot; book and letting me jump on board.</p>
<p>The DBI and DBD::Oracle were originally developed while I was Technical
Director (CTO) of Ingeneering in the UK (<a href="http://www.ig.co.uk">http://www.ig.co.uk</a>) (formerly known as the
Paul Ingram Group).  So I'd especially like to thank Paul for his generosity
and vision in supporting this work for many years.</p>
<p>A couple of specific DBI features have been sponsored by enlightened companies:</p>
<p>The development of the <code>swap_inner_handle()</code> method was sponsored by BizRate.com (<a href="http://BizRate.com">http://BizRate.com</a>)</p>
<p>The development of DBD::Gofer and related modules was sponsored by
Shopzilla.com (<a href="http://Shopzilla.com">http://Shopzilla.com</a>), where I currently work.</p>
<p>
</p>
<hr />
<h1><a name="contributing">CONTRIBUTING</a></h1>
<p>As you can see above, many people have contributed to the DBI and
drivers in many ways over many years.</p>
<p>If you'd like to help then see <a href="http://dbi.perl.org/contributing">http://dbi.perl.org/contributing</a>
and <a href="http://search.cpan.org/~timb/DBI/Roadmap.pod">http://search.cpan.org/~timb/DBI/Roadmap.pod</a></p>
<p>If you'd like the DBI to do something new or different then a good way
to make that happen is to do it yourself and send me a patch to the
source code that shows the changes. (But read &quot;Speak before you patch&quot;
below.)</p>
<p>
</p>
<h2><a name="browsing_the_source_code_repository">Browsing the source code repository</a></h2>
<p>Use <a href="http://svn.perl.org/modules/dbi/trunk">http://svn.perl.org/modules/dbi/trunk</a> (basic)
or  <a href="http://svn.perl.org/viewcvs/modules/">http://svn.perl.org/viewcvs/modules/</a> (more useful)</p>
<p>
</p>
<h2><a name="how_to_create_a_patch_using_subversion">How to create a patch using Subversion</a></h2>
<p>The DBI source code is maintained using Subversion (a replacement
for CVS, see <a href="http://subversion.tigris.org/">http://subversion.tigris.org/</a>). To access the source
you'll need to install a Subversion client. Then, to get the source
code, do:</p>
<pre>
  svn checkout <a href="http://svn.perl.org/modules/dbi/trunk">http://svn.perl.org/modules/dbi/trunk</a></pre>
<p>If it prompts for a username and password use your perl.org account
if you have one, else just 'guest' and 'guest'. The source code will
be in a new subdirectory called <code>trunk</code>.</p>
<p>To keep informed about changes to the source you can send an empty email
to <a href="mailto:svn-commit-modules-dbi-subscribe@perl.org">svn-commit-modules-dbi-subscribe@perl.org</a> after which you'll get an email
with the change log message and diff of each change checked-in to the source.</p>
<p>After making your changes you can generate a patch file, but before
you do, make sure your source is still upto date using:</p>
<pre>
  svn update</pre>
<p>If you get any conflicts reported you'll need to fix them first.
Then generate the patch file from within the <code>trunk</code> directory using:</p>
<pre>
  svn diff &gt; foo.patch</pre>
<p>Read the patch file, as a sanity check, and then email it to <a href="mailto:dbi-dev@perl.org.">dbi-dev@perl.org.</a></p>
<p>
</p>
<h2><a name="how_to_create_a_patch_without_subversion">How to create a patch without Subversion</a></h2>
<p>Unpack a fresh copy of the distribution:</p>
<pre>
  tar xfz DBI-1.40.tar.gz</pre>
<p>Rename the newly created top level directory:</p>
<pre>
  mv DBI-1.40 DBI-1.40.your_foo</pre>
<p>Edit the contents of DBI-1.40.your_foo/* till it does what you want.</p>
<p>Test your changes and then remove all temporary files:</p>
<pre>
  make test &amp;&amp; make distclean</pre>
<p>Go back to the directory you originally unpacked the distribution:</p>
<pre>
  cd ..</pre>
<p>Unpack <em>another</em> copy of the original distribution you started with:</p>
<pre>
  tar xfz DBI-1.40.tar.gz</pre>
<p>Then create a patch file by performing a recursive <code>diff</code> on the two
top level directories:</p>
<pre>
  diff -r -u DBI-1.40 DBI-1.40.your_foo &gt; DBI-1.40.your_foo.patch</pre>
<p>
</p>
<h2><a name="speak_before_you_patch">Speak before you patch</a></h2>
<p>For anything non-trivial or possibly controversial it's a good idea
to discuss (on <a href="mailto:dbi-dev@perl.org)">dbi-dev@perl.org)</a> the changes you propose before
actually spending time working on them. Otherwise you run the risk
of them being rejected because they don't fit into some larger plans
you may not be aware of.</p>
<p>
</p>
<hr />
<h1><a name="translations">TRANSLATIONS</a></h1>
<p>A German translation of this manual (possibly slightly out of date) is
available, thanks to O'Reilly, at:</p>
<pre>
  <a href="http://www.oreilly.de/catalog/perldbiger/">http://www.oreilly.de/catalog/perldbiger/</a></pre>
<p>Some other translations:</p>
<pre>
 <a href="http://cronopio.net/perl/">http://cronopio.net/perl/</a>                              - Spanish
 <a href="http://member.nifty.ne.jp/hippo2000/dbimemo.htm">http://member.nifty.ne.jp/hippo2000/dbimemo.htm</a>        - Japanese</pre>
<p>
</p>
<hr />
<h1><a name="training">TRAINING</a></h1>
<p>References to DBI related training resources. No recommendation implied.</p>
<pre>
  <a href="http://www.treepax.co.uk/">http://www.treepax.co.uk/</a>
  <a href="http://www.keller.com/dbweb/">http://www.keller.com/dbweb/</a></pre>
<p>(If you offer professional DBI related training services,
please send me your details so I can add them here.)</p>
<p>
</p>
<hr />
<h1><a name="other_related_work_and_perl_modules">OTHER RELATED WORK AND PERL MODULES</a></h1>
<dl>
<dt><strong><a name="apache_dbi_by_e_mergl_bawue_de" class="item">Apache::DBI by <a href="mailto:E.Mergl@bawue.de">E.Mergl@bawue.de</a></a></strong>

<dd>
<p>To be used with the Apache daemon together with an embedded Perl
interpreter like <code>mod_perl</code>. Establishes a database connection which
remains open for the lifetime of the HTTP daemon. This way the CGI
connect and disconnect for every database access becomes superfluous.</p>
</dd>
</li>
<dt><strong><a name="sql_parser" class="item">SQL Parser</a></strong>

<dd>
<p>See also the <a href="../lib/SQL/Statement.html">the SQL::Statement manpage</a> module, SQL parser and engine.</p>
</dd>
</li>
</dl>

</body>

</html>
