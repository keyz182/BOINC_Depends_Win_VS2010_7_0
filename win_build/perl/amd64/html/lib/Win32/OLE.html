<?xml version="1.0" ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- saved from url=(0017)http://localhost/ -->
<script language="JavaScript" src="../../displayToc.js"></script>
<script language="JavaScript" src="../../tocParas.js"></script>
<script language="JavaScript" src="../../tocTab.js"></script>
<link rel="stylesheet" type="text/css" href="../../scineplex.css">
<title>Win32::OLE - OLE Automation extensions</title>
<link rel="stylesheet" href="../../Active.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>


<!-- INDEX BEGIN -->
<div name="index">
<script>writelinks('__top__',2);</script>
<h1><a>Win32::OLE - OLE Automation extensions</a></h1>
<p><a name="__index__"></a></p>


<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#methods">Methods</a></li>
		<li><a href="#object_methods_and_properties">Object methods and properties</a></li>
		<li><a href="#functions">Functions</a></li>
		<li><a href="#overloading">Overloading</a></li>
		<li><a href="#events">Events</a></li>
		<li><a href="#module_options">Module Options</a></li>
	</ul>

	<li><a href="#examples">EXAMPLES</a></li>
	<li><a href="#notes">NOTES</a></li>
	<ul>

		<li><a href="#hints_for_microsoft_office_automation">Hints for Microsoft Office automation</a></li>
		<li><a href="#incompatibilities">Incompatibilities</a></li>
		<li><a href="#bugs_and_limitations">Bugs and Limitations</a></li>
	</ul>

	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#authors">AUTHORS</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
	<li><a href="#version">VERSION</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Win32::OLE - OLE Automation extensions</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
    <span class="variable">$ex</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"oops\n"</span><span class="operator">;</span>
    <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Amethod</span><span class="operator">(</span><span class="string">"arg"</span><span class="operator">)-&gt;</span><span class="variable">Bmethod</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">'Property'</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"foo"</span><span class="operator">;</span>
    <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Cmethod</span><span class="operator">(</span><span class="keyword">undef</span><span class="operator">,</span><span class="keyword">undef</span><span class="operator">,</span><span class="variable">$Arg3</span><span class="operator">);</span>
    <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Dmethod</span><span class="operator">(</span><span class="variable">$RequiredArg1</span><span class="operator">,</span> <span class="operator">{</span><span class="string">NamedArg1</span> <span class="operator">=&gt;</span> <span class="variable">$Value1</span><span class="operator">,</span> <span class="string">NamedArg2</span> <span class="operator">=&gt;</span> <span class="variable">$Value2</span><span class="operator">}</span><span class="operator">);</span>
</pre>
<pre>
    <span class="variable">$wd</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">GetObject</span><span class="operator">(</span><span class="string">"D:\\Data\\Message.doc"</span><span class="operator">);</span>
    <span class="variable">$xl</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">GetActiveObject</span><span class="operator">(</span><span class="string">"Excel.Application"</span><span class="operator">);</span>
</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This module provides an interface to OLE Automation from Perl.
OLE Automation brings VisualBasic like scripting capabilities and
offers powerful extensibility and the ability to control many Win32
applications from Perl scripts.</p>
<p>The Win32::OLE module uses the IDispatch interface exclusively.  It is
not possible to access a custom OLE interface.  OLE events and OCX's are
currently not supported.</p>
<p>Actually, that's no longer strictly true.  This module now contains
<strong>ALPHA</strong> level support for OLE events.  This is largely untested and the
specific interface might still change in the future.</p>
<p>
</p>
<h2><a name="methods">Methods</a></h2>
<dl>
<dt><strong><a name="new" class="item">Win32::OLE-&gt;new(PROGID[, DESTRUCTOR])</a></strong>

<dd>
<p>The <a href="#new"><code>new()</code></a> class method starts a new instance of an OLE Automation object.
It returns a reference to this object or <a href="../../lib/pods/perlfunc.html#undef"><code>undef</code></a> if the creation failed.</p>
</dd>
<dd>
<p>The PROGID argument must be either the OLE <em>program id</em> or the <em>class id</em>
of the required application.  The optional DESTRUCTOR specifies a DESTROY-like
method.  This can be either a CODE reference or a string containing an OLE
method name.  It can be used to cleanly terminate OLE applications in case the
Perl program dies.</p>
</dd>
<dd>
<p>To create an object via DCOM on a remote server you can use an array
reference in place of PROGID.  The referenced array must contain the
machine name and the <em>program id</em> or <em>class id</em>.  For example:</p>
</dd>
<dd>
<pre>
        <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="operator">[</span><span class="string">'my.machine.com'</span><span class="operator">,</span> <span class="string">'Program.Id'</span><span class="operator">]</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>If the PROGID is a <em>program id</em> then Win32::OLE will try to resolve the
corresponding <em>class id</em> locally.  If the <em>program id</em> is not registered
locally then the remote registry is queried.  This will only succeed if
the local process has read access to the remote registry.  The safest
(and fastest) method is to specify the <code>class id</code> directly.</p>
</dd>
</li>
<dt><strong><a name="enumallobjects" class="item">Win32::OLE-&gt;EnumAllObjects([CALLBACK])</a></strong>

<dd>
<p>This class method returns the number Win32::OLE objects currently in
existance.  It will call the optional CALLBACK function for each of
these objects:</p>
</dd>
<dd>
<pre>
        <span class="variable">$Count</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">EnumAllObjects</span><span class="operator">(</span><span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$Object</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="keyword">my</span> <span class="variable">$Class</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">QueryObjectType</span><span class="operator">(</span><span class="variable">$Object</span><span class="operator">);</span>
            <span class="keyword">printf</span> <span class="string">"# Object=%s Class=%s\n"</span><span class="operator">,</span> <span class="variable">$Object</span><span class="operator">,</span> <span class="variable">$Class</span><span class="operator">;</span>
        <span class="operator">});</span>
</pre>
</dd>
<dd>
<p>The <a href="#enumallobjects"><code>EnumAllObjects()</code></a> method is primarily a debugging tool.  It can be
used e.g. in an END block to check if all external connections have
been properly destroyed.</p>
</dd>
</li>
<dt><strong><a name="freeunusedlibraries" class="item">Win32::OLE-&gt;<code>FreeUnusedLibraries()</code></a></strong>

<dd>
<p>The <a href="#freeunusedlibraries"><code>FreeUnusedLibraries()</code></a> class method unloads all unused OLE
resources.  These are the libraries of those classes of which all
existing objects have been destroyed.  The unloading of object
libraries is really only important for long running processes that
might instantiate a huge number of <strong>different</strong> objects over time.</p>
</dd>
<dd>
<p>Be aware that objects implemented in Visual Basic have a buggy
implementation of this functionality: They pretend to be unloadable
while they are actually still running their cleanup code.  Unloading
the DLL at that moment typically produces an access violation.  The
probability for this problem can be reduced by calling the
<a href="#spinmessageloop"><code>SpinMessageLoop()</code></a> method and sleep()ing for a few seconds.</p>
</dd>
</li>
<dt><strong><a name="getactiveobject" class="item">Win32::OLE-&gt;GetActiveObject(CLASS[, DESTRUCTOR])</a></strong>

<dd>
<p>The <a href="#getactiveobject"><code>GetActiveObject()</code></a> class method returns an OLE reference to a
running instance of the specified OLE automation server.  It returns
<a href="../../lib/pods/perlfunc.html#undef"><code>undef</code></a> if the server is not currently active.  It will croak if
the class is not even registered.  The optional DESTRUCTOR method takes
either a method name or a code reference.  It is executed when the last
reference to this object goes away.  It is generally considered <code>impolite</code>
to stop applications that you did not start yourself.</p>
</dd>
</li>
<dt><strong><a name="getobject" class="item">Win32::OLE-&gt;GetObject(MONIKER[, DESTRUCTOR])</a></strong>

<dd>
<p>The <a href="#getobject"><code>GetObject()</code></a> class method returns an OLE reference to the specified
object.  The object is specified by a pathname optionally followed by
additional item subcomponent separated by exclamation marks '!'.  The
optional DESTRUCTOR argument has the same semantics as the DESTRUCTOR in
<a href="#new"><code>new()</code></a> or <a href="#getactiveobject"><code>GetActiveObject()</code></a>.</p>
</dd>
</li>
<dt><strong><a name="initialize" class="item">Win32::OLE-&gt;Initialize([COINIT])</a></strong>

<dd>
<p>The <a href="#initialize"><code>Initialize()</code></a> class method can be used to specify an alternative
apartment model for the Perl thread.  It must be called <strong>before</strong> the
first OLE object is created.  If the <code>Win32::OLE::Const</code> module is
used then the call to the <a href="#initialize"><code>Initialize()</code></a> method must be made from a BEGIN
block before the first <a href="../../lib/pods/perlfunc.html#use"><code>use</code></a> statement for the <code>Win32::OLE::Const</code>
module.</p>
</dd>
<dd>
<p>Valid values for COINIT are:</p>
</dd>
<dd>
<pre>
  Win32::OLE::COINIT_APARTMENTTHREADED  - single threaded
  Win32::OLE::COINIT_MULTITHREADED      - the default
  Win32::OLE::COINIT_OLEINITIALIZE      - single threaded, additional OLE stuff</pre>
</dd>
<dd>
<p>COINIT_OLEINITIALIZE is sometimes needed when an OLE object uses
additional OLE compound document technologies not available from the
normal COM subsystem (for example MAPI.Session seems to require it).
Both COINIT_OLEINITIALIZE and COINIT_APARTMENTTHREADED create a hidden
top level window and a message queue for the Perl process.  This may
create problems with other application, because Perl normally doesn't
process its message queue.  This means programs using synchronous
communication between applications (such as DDE initiation), may hang
until Perl makes another OLE method call/property access or terminates.
This applies to InstallShield setups and many things started to shell
associations.  Please try to utilize the <a href="#spinmessageloop"><code>Win32::OLE-&gt;SpinMessageLoop</code></a>
and <a href="#uninitialize"><code>Win32::OLE-&gt;Uninitialize</code></a> methods if you can not use the default
COINIT_MULTITHREADED model.</p>
</dd>
</li>
<dt><strong><a name="invoke" class="item">OBJECT-&gt;Invoke(METHOD[, ARGS])</a></strong>

<dd>
<p>The <a href="#invoke"><code>Invoke()</code></a> object method is an alternate way to invoke OLE
methods.  It is normally equivalent to <code>$OBJECT-</code>METHOD(@ARGS)&gt;.  This
function must be used if the METHOD name contains characters not valid
in a Perl variable name (like foreign language characters).  It can
also be used to invoke the default method of an object even if the
default method has not been given a name in the type library.  In this
case use &lt;undef&gt; or <code>''</code> as the method name.  To invoke an OLE objects
native <a href="#invoke"><code>Invoke()</code></a> method (if such a thing exists), please use:</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">Invoke</span><span class="operator">(</span><span class="string">'Invoke'</span><span class="operator">,</span> <span class="variable">@Args</span><span class="operator">);</span>
</pre>
</dd>
</li>
<dt><strong><a name="lasterror" class="item">Win32::OLE-&gt;<code>LastError()</code></a></strong>

<dd>
<p>The <a href="#lasterror"><code>LastError()</code></a> class method returns the last recorded OLE
error.  This is a dual value like the <a href="../../lib/pods/perlvar.html#__"><code>$!</code></a> variable: in a numeric
context it returns the error number and in a string context it returns
the error message.  The error number is a signed HRESULT value.  Please
use the <a href="#hresult">HRESULT(ERROR)</a> function to convert an unsigned hexadecimal
constant to a signed HRESULT.</p>
</dd>
<dd>
<p>The last OLE error is automatically reset by a successful OLE
call.  The numeric value can also explicitly be set by a call (which will
discard the string value):</p>
</dd>
<dd>
<pre>
        <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">LastError</span><span class="operator">(</span><span class="number">0</span><span class="operator">);</span>
</pre>
</dd>
</li>
<dt><strong><a name="letproperty" class="item">OBJECT-&gt;LetProperty(NAME,ARGS,VALUE)</a></strong>

<dd>
<p>In Win32::OLE property assignment using the hash syntax is equivalent
to the Visual Basic <code>Set</code> syntax (<em>by reference</em> assignment):</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Property</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$OtherObject</span><span class="operator">;</span>
</pre>
</dd>
<dd>
<p>corresponds to this Visual Basic statement:</p>
</dd>
<dd>
<pre>
        Set Object.Property = OtherObject</pre>
</dd>
<dd>
<p>To get the <em>by value</em> treatment of the Visual Basic <code>Let</code> statement</p>
</dd>
<dd>
<pre>
        Object.Property = OtherObject</pre>
</dd>
<dd>
<p>you have to use the <a href="#letproperty"><code>LetProperty()</code></a> object method in Perl:</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">LetProperty</span><span class="operator">(</span><span class="variable">$Property</span><span class="operator">,</span> <span class="variable">$OtherObject</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p><a href="#letproperty"><code>LetProperty()</code></a> also supports optional arguments for the property assignment.
See <em>OBJECT-</em>SetProperty(NAME,ARGS,VALUE)&gt; for details.</p>
</dd>
</li>
<dt><strong><a name="messageloop" class="item">Win32::OLE-&gt;<code>MessageLoop()</code></a></strong>

<dd>
<p>The <a href="#messageloop"><code>MessageLoop()</code></a> class method will run a standard Windows message
loop, dispatching messages until the <a href="#quitmessageloop"><code>QuitMessageLoop()</code></a> class method is
called.  It is used to wait for OLE events.</p>
</dd>
</li>
<dt><strong><a name="option" class="item">Win32::OLE-&gt;Option(OPTION)</a></strong>

<dd>
<p>The <a href="#option"><code>Option()</code></a> class method can be used to inspect and modify
<a href="#module_options">Module Options</a>.  The single argument form retrieves the value of
an option:</p>
</dd>
<dd>
<pre>
        <span class="keyword">my</span> <span class="variable">$CP</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">'CP'</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>A single call can be used to set multiple options simultaneously:</p>
</dd>
<dd>
<pre>
        <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">CP</span> <span class="operator">=&gt;</span> <span class="variable">CP_ACP</span><span class="operator">,</span> <span class="string">Warn</span> <span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">);</span>
</pre>
</dd>
</li>
<dt><strong><a name="queryobjecttype" class="item">Win32::OLE-&gt;QueryObjectType(OBJECT)</a></strong>

<dd>
<p>The <a href="#queryobjecttype"><code>QueryObjectType()</code></a> class method returns a list of the type library
name and the objects class name.  In a scalar context it returns the
class name only.  It returns <a href="../../lib/pods/perlfunc.html#undef"><code>undef</code></a> when the type information is not
available.</p>
</dd>
</li>
<dt><strong><a name="quitmessageloop" class="item">Win32::OLE-&gt;<code>QuitMessageLoop()</code></a></strong>

<dd>
<p>The <a href="#quitmessageloop"><code>QuitMessageLoop()</code></a> class method posts a (user-level) &quot;Quit&quot; message
to the current threads message loop.  <a href="#quitmessageloop"><code>QuitMessageLoop()</code></a> is typically
called from an event handler.  The <a href="#messageloop"><code>MessageLoop()</code></a> class method will
return when it receives this &quot;Quit&quot; method.</p>
</dd>
</li>
<dt><strong><a name="setproperty" class="item">OBJECT-&gt;SetProperty(NAME,ARGS,VALUE)</a></strong>

<dd>
<p>The <a href="#setproperty"><code>SetProperty()</code></a> method allows to modify properties with arguments,
which is not supported by the hash syntax.  The hash form</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Property</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$Value</span><span class="operator">;</span>
</pre>
</dd>
<dd>
<p>is equivalent to</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">SetProperty</span><span class="operator">(</span><span class="string">'Property'</span><span class="operator">,</span> <span class="variable">$Value</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>Arguments must be specified between the property name and the new value:</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">SetProperty</span><span class="operator">(</span><span class="string">'Property'</span><span class="operator">,</span> <span class="variable">@Args</span><span class="operator">,</span> <span class="variable">$Value</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>It is not possible to use &quot;named argument&quot; syntax with this function
because the new value must be the last argument to <a href="#setproperty"><code>SetProperty()</code></a>.</p>
</dd>
<dd>
<p>This method hides any native OLE object method called <a href="#setproperty"><code>SetProperty()</code></a>.
The native method will still be available through the <a href="#invoke"><code>Invoke()</code></a> method:</p>
</dd>
<dd>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">Invoke</span><span class="operator">(</span><span class="string">'SetProperty'</span><span class="operator">,</span> <span class="variable">@Args</span><span class="operator">);</span>
</pre>
</dd>
</li>
<dt><strong><a name="spinmessageloop" class="item">Win32::OLE-&gt;SpinMessageLoop</a></strong>

<dd>
<p>This class method retrieves all pending messages from the message queue
and dispatches them to their respective window procedures.  Calling this
method is only necessary when not using the COINIT_MULTITHREADED model.
All OLE method calls and property accesses automatically process the
message queue.</p>
</dd>
</li>
<dt><strong><a name="uninitialize" class="item">Win32::OLE-&gt;Uninitialize</a></strong>

<dd>
<p>The <a href="#uninitialize"><code>Uninitialize()</code></a> class method uninitializes the OLE subsystem.  It
also destroys the hidden top level window created by OLE for single
threaded apartments.  All OLE objects will become invalid after this call!
It is possible to call the <a href="#initialize"><code>Initialize()</code></a> class method again with a different
apartment model after shutting down OLE with <a href="#uninitialize"><code>Uninitialize()</code></a>.</p>
</dd>
</li>
<dt><strong><a name="withevents" class="item">Win32::OLE-&gt;WithEvents(OBJECT[, HANDLER[, INTERFACE]])</a></strong>

<dd>
<p>This class method enables and disables the firing of events by the
specified OBJECT.  If no HANDLER is specified, then events are
disconnected.  For some objects Win32::OLE is not able to
automatically determine the correct event interface.  In this case the
INTERFACE argument must contain either the COCLASS name of the OBJECT
or the name of the event DISPATCH interface.  Please read the <em>Events</em>
section below for detailed explanation of the Win32::OLE event
support.</p>
</dd>
</li>
</dl>
<p>Whenever Perl does not find a method name in the Win32::OLE package it
is automatically used as the name of an OLE method and this method call
is dispatched to the OLE server.</p>
<p>There is one special hack built into the module: If a method or property
name could not be resolved with the OLE object, then the default method
of the object is called with the method name as its first parameter.  So</p>
<pre>
        <span class="keyword">my</span> <span class="variable">$Sheet</span> <span class="operator">=</span> <span class="variable">$Worksheets</span><span class="operator">-&gt;</span><span class="variable">Table1</span><span class="operator">;</span>
        <span class="keyword">or</span>
        <span class="keyword">my</span> <span class="variable">$Sheet</span> <span class="operator">=</span> <span class="variable">$Worksheets</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Table1</span><span class="operator">}</span><span class="operator">;</span>
</pre>
<p>is resolved as</p>
<pre>
        <span class="keyword">my</span> <span class="variable">$Sheet</span> <span class="operator">=</span> <span class="variable">$Worksheet</span><span class="operator">-&gt;</span><span class="variable">Item</span><span class="operator">(</span><span class="string">'Table1'</span><span class="operator">);</span>
</pre>
<p>provided that the $Worksheets object doesnot have a <code>Table1</code> method
or property.  This hack has been introduced to call the default method
of collections which did not name the method in their type library.  The
recommended way to call the &quot;unnamed&quot; default method is:</p>
<pre>
        <span class="keyword">my</span> <span class="variable">$Sheet</span> <span class="operator">=</span> <span class="variable">$Worksheets</span><span class="operator">-&gt;</span><span class="variable">Invoke</span><span class="operator">(</span><span class="string">''</span><span class="operator">,</span> <span class="string">'Table1'</span><span class="operator">);</span>
</pre>
<p>This special hack is disabled under <code>use strict 'subs';</code>.</p>
<p>
</p>
<h2><a name="object_methods_and_properties">Object methods and properties</a></h2>
<p>The object returned by the <a href="#new"><code>new()</code></a> method can be used to invoke
methods or retrieve properties in the same fashion as described
in the documentation for the particular OLE class (eg. Microsoft
Excel documentation describes the object hierarchy along with the
properties and methods exposed for OLE access).</p>
<p>Optional parameters on method calls can be omitted by using <a href="../../lib/pods/perlfunc.html#undef"><code>undef</code></a>
as a placeholder.  A better way is to use named arguments, as the
order of optional parameters may change in later versions of the OLE
server application.  Named parameters can be specified in a reference
to a hash as the last parameter to a method call.</p>
<p>Properties can be retrieved or set using hash syntax, while methods
can be invoked with the usual perl method call syntax.  The <a href="../../lib/pods/perlfunc.html#keys"><code>keys</code></a>
and <a href="../../lib/pods/perlfunc.html#each"><code>each</code></a> functions can be used to enumerate an object's properties.
Beware that a property is not always writable or even readable (sometimes
raising exceptions when read while being undefined).</p>
<p>If a method or property returns an embedded OLE object, method
and property access can be chained as shown in the examples below.</p>
<p>
</p>
<h2><a name="functions">Functions</a></h2>
<p>The following functions are not exported by default.</p>
<dl>
<dt><strong><a name="hresult" class="item">HRESULT(ERROR)</a></strong>

<dd>
<p>The <a href="#hresult"><code>HRESULT()</code></a> function converts an unsigned number into a signed HRESULT
error value as used by OLE internally.  This is necessary because Perl
treats all hexadecimal constants as unsigned.  To check if the last OLE
function returned &quot;Member not found&quot; (0x80020003) you can write:</p>
</dd>
<dd>
<pre>
        <span class="keyword">if</span> <span class="operator">(</span><span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">LastError</span> <span class="operator">==</span> <span class="variable">HRESULT</span><span class="operator">(</span><span class="number">0x80020003</span><span class="operator">))</span> <span class="operator">{</span>
            <span class="comment"># your error recovery here</span>
        <span class="operator">}</span>
</pre>
</dd>
</li>
<dt><strong><a name="in" class="item">in(COLLECTION)</a></strong>

<dd>
<p>If COLLECTION is an OLE collection object then <code>in $COLLECTION</code>
returns a list of all members of the collection.  This is a shortcut
for <code>Win32::OLE::Enum-</code>All($COLLECTION)&gt;.  It is most commonly used in
a <code>foreach</code> loop:</p>
</dd>
<dd>
<pre>
        <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$value</span> <span class="operator">(</span><span class="variable">in</span> <span class="variable">$collection</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="comment"># do something with $value here</span>
        <span class="operator">}</span>
</pre>
</dd>
</li>
<dt><strong><a name="valof" class="item">valof(OBJECT)</a></strong>

<dd>
<p>Normal assignment of Perl OLE objects creates just another reference
to the OLE object.  The <a href="#valof"><code>valof()</code></a> function explictly dereferences the
object (through the default method) and returns the value of the object.</p>
</dd>
<dd>
<pre>
        <span class="keyword">my</span> <span class="variable">$RefOf</span> <span class="operator">=</span> <span class="variable">$Object</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$ValOf</span> <span class="operator">=</span> <span class="variable">valof</span> <span class="variable">$Object</span><span class="operator">;</span>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$NewValue</span><span class="operator">;</span>
</pre>
</dd>
<dd>
<p>Now $ValOf still contains the old value wheras $RefOf would
resolve to the $NewValue because it is still a reference to
$Object.</p>
</dd>
<dd>
<p>The <a href="#valof"><code>valof()</code></a> function can also be used to convert Win32::OLE::Variant
objects to Perl values.</p>
</dd>
</li>
<dt><strong><a name="with" class="item">with(OBJECT, PROPERTYNAME =&gt; VALUE, ...)</a></strong>

<dd>
<p>This function provides a concise way to set the values of multiple
properties of an object.  It iterates over its arguments doing
<code>$OBJECT-</code>{PROPERTYNAME} = $VALUE&gt; on each trailing pair.</p>
</dd>
</li>
</dl>
<p>
</p>
<h2><a name="overloading">Overloading</a></h2>
<p>The Win32::OLE objects can be overloaded to automatically convert to
their values whenever they are used in a bool, numeric or string
context.  This is not enabled by default.  You have to request it
through the OVERLOAD pseudoexport:</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span> <span class="string">qw(in valof with OVERLOAD)</span><span class="operator">;</span>
</pre>
<p>You can still get the original string representation of an object
(<code>Win32::OLE=0xDEADBEEF</code>), e.g. for debugging, by using the
<code>overload::StrVal()</code> method:</p>
<pre>
        <span class="keyword">print</span> <span class="variable">overload::StrVal</span><span class="operator">(</span><span class="variable">$object</span><span class="operator">),</span> <span class="string">"\n"</span><span class="operator">;</span>
</pre>
<p>Please note that <code>OVERLOAD</code> is a global setting.  If any module enables
Win32::OLE overloading then it's active everywhere.</p>
<p>
</p>
<h2><a name="events">Events</a></h2>
<p>The Win32::OLE module now contains <strong>ALPHA</strong> level event support.  This
support is only available when Perl is running in a single threaded
apartment.  This can most easily be assured by using the <code>EVENTS</code>
pseudo-import:</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span> <span class="string">qw(EVENTS)</span><span class="operator">;</span>
</pre>
<p>which implicitly does something like:</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span><span class="operator">;</span>
        <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Initialize</span><span class="operator">(</span><span class="variable">Win32::OLE::COINIT_OLEINITIALIZE</span><span class="operator">);</span>
</pre>
<p>The current interface to OLE events should be considered experimental
and is subject to change.  It works as expected for normal OLE
applications, but OLE control events often don't seem to work yet.</p>
<p>Events must be enabled explicitly for an OLE object through the
Win32::OLE-&gt;<a href="#withevents"><code>WithEvents()</code></a> class method.  The Win32::OLE module uses the
IProvideClassInfo2 interface to determine the default event source of
the object.  If this interface is not supported, then the user must
specify the name of the event source explicitly in the <a href="#withevents"><code>WithEvents()</code></a>
method call.  It is also possible to specify the class name of the
object as the third parameter.  In this case Win32::OLE will try to
look up the default source interface for this COCLASS.</p>
<p>The HANDLER argument to Win32::OLE-&gt;<a href="#withevents"><code>WithEvents()</code></a> can either be a CODE
reference or a package name.  In the first case, all events will invoke
this particular function.  The first two arguments to this function will
be the OBJECT itself and the name of the event.  The remaining arguments
will be event specific.</p>
<pre>
        <span class="keyword">sub</span><span class="variable"> Event </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$Obj</span><span class="operator">,</span><span class="variable">$Event</span><span class="operator">,</span><span class="variable">@Args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
            <span class="keyword">print</span> <span class="string">"Event triggered: '</span><span class="variable">$Event</span><span class="string">'\n"</span><span class="operator">;</span>
        <span class="operator">}</span>
        <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">WithEvents</span><span class="operator">(</span><span class="variable">$Obj</span><span class="operator">,</span> <span class="operator">\&amp;</span><span class="variable">Event</span><span class="operator">);</span>
</pre>
<p>Alternatively the HANDLER argument can specify a package name.  When the
OBJECT fires an event, Win32::OLE will try to find a function of the same
name as the event in this package.  This function will be called with the
OBJECT as the first argument followed again by the event specific parameters:</p>
<pre>
        <span class="keyword">package</span> <span class="variable">MyEvents</span><span class="operator">;</span>
        <span class="keyword">sub</span><span class="variable"> EventName1 </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$Obj</span><span class="operator">,</span><span class="variable">@Args</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
            <span class="keyword">print</span> <span class="string">"EventName1 event triggered\n"</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="keyword">package</span> <span class="variable">main</span><span class="operator">;</span>
        <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">WithEvents</span><span class="operator">(</span><span class="variable">$Obj</span><span class="operator">,</span> <span class="string">'MyEvents'</span><span class="operator">,</span> <span class="string">'IEventInterface'</span><span class="operator">);</span>
</pre>
<p>If Win32::OLE doesn't find a function with the name of the event then nothing
happens.</p>
<p>Event parameters passed <em>by reference</em> are handled specially.  They are not
converted to the corresponding Perl datatype but passed as Win32::OLE::Variant
objects.  You can assign a new value to these objects with the help of the
<code>Put()</code> method.  This value will be passed back to the object when the event
function returns:</p>
<pre>
        <span class="keyword">package</span> <span class="variable">MyEvents</span><span class="operator">;</span>
        <span class="keyword">sub</span><span class="variable"> BeforeClose </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="operator">(</span><span class="variable">$self</span><span class="operator">,</span><span class="variable">$Cancel</span><span class="operator">)</span> <span class="operator">=</span> <span class="variable">@_</span><span class="operator">;</span>
            <span class="variable">$Cancel</span><span class="operator">-&gt;</span><span class="variable">Put</span><span class="operator">(</span><span class="number">1</span><span class="operator">)</span> <span class="keyword">unless</span> <span class="variable">$MayClose</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<p>Direct assignment to $Cancel would have no effect on the original value and
would therefore not command the object to abort the closing action.</p>
<p>
</p>
<h2><a name="module_options">Module Options</a></h2>
<p>The following module options can be accessed and modified with the
<code>Win32::OLE-</code>Option&gt; class method.  In earlier versions of the Win32::OLE
module these options were manipulated directly as class variables.  This
practice is now deprecated.</p>
<dl>
<dt><strong><a name="cp" class="item">CP</a></strong>

<dd>
<p>This variable is used to determine the codepage used by all
translations between Perl strings and Unicode strings used by the OLE
interface.  The default value is CP_ACP, which is the default ANSI
codepage.  Other possible values are CP_OEMCP, CP_MACCP, CP_UTF7 and
CP_UTF8.  These constants are not exported by default.</p>
</dd>
</li>
<dt><strong><a name="lcid" class="item">LCID</a></strong>

<dd>
<p>This variable controls the locale idnetifier used for all OLE calls.
It is set to LOCALE_NEUTRAL by default.  Please check the
<a href="../../lib/Win32/OLE/NLS.html">the Win32::OLE::NLS manpage</a> module for other locale related information.</p>
</dd>
</li>
<dt><strong><a name="variant" class="item">Variant</a></strong>

<dd>
<p>This options controls how method calls and property accessors return
values of type VT_CY and VT_DECIMAL are being returned.  By default
VT_CY values are turned into strings and VT_DECIMAL values into
floating point numbers.  If the <a href="#variant"><code>Variant</code></a> option is enabled, these
values are returned as Win32::OLE::Variant objects, just like VT_DATE
and VT_ERROR values.  If the Win32::OLE::Variant module is also
loaded, then all values should still behave as before in string and in
numeric context.</p>
</dd>
<dd>
<p>The only reason that the <a href="#variant"><code>Variant</code></a> behavior is not the default is that
this is an incompatible change that might break existing programs.</p>
</dd>
</li>
<dt><strong><a name="warn" class="item">Warn</a></strong>

<dd>
<p>This variable determines the behavior of the Win32::OLE module when
an error happens.  Valid values are:</p>
</dd>
<dd>
<pre>
        0       Ignore error, return undef
        1       Carp::carp if $^W is set (-w option)
        2       always Carp::carp
        3       Carp::croak</pre>
</dd>
<dd>
<p>The error number and message (without Carp line/module info) are
available through the <code>Win32::OLE-</code>LastError&gt; class method.</p>
</dd>
<dd>
<p>Alternatively the Warn option can be set to a CODE reference.  E.g.</p>
</dd>
<dd>
<pre>
    <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">Warn</span> <span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>is equivalent to</p>
</dd>
<dd>
<pre>
    <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">Warn</span> <span class="operator">=&gt;</span> <span class="operator">\&amp;</span><span class="variable">Carp::croak</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>This can even be used to emulate the VisualBasic <code>On Error Goto
Label</code> construct:</p>
</dd>
<dd>
<pre>
    <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">Warn</span> <span class="operator">=&gt;</span>  <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span><span class="keyword">goto</span> <span class="variable">CheckError</span><span class="operator">});</span>
    <span class="comment"># ... your normal OLE code here ...</span>
</pre>
</dd>
<dd>
<pre>
  CheckError:
    # ... your error handling code here ...</pre>
</dd>
</li>
<dt><strong><a name="newenum" class="item">_NewEnum</a></strong>

<dd>
<p>This option enables additional enumeration support for collection
objects.  When the <a href="#newenum"><code>_NewEnum</code></a> option is set, all collections will
receive one additional property: <a href="#newenum"><code>_NewEnum</code></a>.  The value of this
property will be a reference to an array containing all the elements
of the collection.  This option can be useful when used in conjunction
with an automatic tree traversal program, like <code>Data::Dumper</code> or an
object tree browser.  The value of this option should be either 1
(enabled) or 0 (disabled, default).</p>
</dd>
<dd>
<pre>
    <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">Option</span><span class="operator">(</span><span class="string">_NewEnum</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">);</span>
    <span class="comment"># ...</span>
    <span class="keyword">my</span> <span class="variable">@sheets</span> <span class="operator">=</span> <span class="variable">@</span><span class="operator">{</span><span class="variable">$Excel</span><span class="operator">-&gt;</span><span class="variable">Worksheets</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">_NewEnum</span><span class="operator">}}</span><span class="operator">;</span>
</pre>
</dd>
<dd>
<p>In normal application code, this would be better written as:</p>
</dd>
<dd>
<pre>
    <span class="keyword">use</span> <span class="variable">Win32::OLE</span> <span class="string">qw(in)</span><span class="operator">;</span>
    <span class="comment"># ...</span>
    <span class="keyword">my</span> <span class="variable">@sheets</span> <span class="operator">=</span> <span class="variable">in</span> <span class="variable">$Excel</span><span class="operator">-&gt;</span><span class="variable">Worksheets</span><span class="operator">;</span>
</pre>
</dd>
</li>
<dt><strong><a name="unique" class="item">_Unique</a></strong>

<dd>
<p>The <a href="#unique"><code>_Unique</code></a> options guarantees that Win32::OLE will maintain a
one-to-one mapping between Win32::OLE objects and the native COM/OLE
objects.  Without this option, you can query the same property twice
and get two different Win32::OLE objects for the same underlying COM
object.</p>
</dd>
<dd>
<p>Using a unique proxy makes life easier for tree traversal algorithms
to recognize they already visited a particular node.  This option
comes at a price: Win32::OLE has to maintain a global hash of all
outstanding objects and their corresponding proxies.  Identity checks
on COM objects can also be expensive if the objects reside
out-of-process or even on a different computer.  Therefore this option
is off by default unless the program is being run in the debugger.</p>
</dd>
<dd>
<p>Unfortunately, this option doesn't always help.  Some programs will
return new COM objects for even the same property when asked for it
multiple times (especially for collections).  In this case, there is
nothing Win32::OLE can do to detect that these objects are in fact
identical (because they aren't at the COM level).</p>
</dd>
<dd>
<p>The <a href="#unique"><code>_Unique</code></a> option can be set to either 1 (enabled) or 0 (disabled,
default).</p>
</dd>
</li>
</dl>
<p>
</p>
<hr />
<h1><a name="examples">EXAMPLES</a></h1>
<p>Here is a simple Microsoft Excel application.</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span><span class="operator">;</span>
</pre>
<pre>
        <span class="comment"># use existing instance if Excel is already running</span>
        <span class="keyword">eval</span> <span class="operator">{</span><span class="variable">$ex</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">GetActiveObject</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">)};</span>
        <span class="keyword">die</span> <span class="string">"Excel not installed"</span> <span class="keyword">if</span> <span class="variable">$@</span><span class="operator">;</span>
        <span class="keyword">unless</span> <span class="operator">(</span><span class="keyword">defined</span> <span class="variable">$ex</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="variable">$ex</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">,</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">Quit</span><span class="operator">;})</span>
                    <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Oops, cannot start Excel"</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="comment"># get a new workbook</span>
        <span class="variable">$book</span> <span class="operator">=</span> <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Workbooks</span><span class="operator">-&gt;</span><span class="variable">Add</span><span class="operator">;</span>
</pre>
<pre>
        <span class="comment"># write to a particular cell</span>
        <span class="variable">$sheet</span> <span class="operator">=</span> <span class="variable">$book</span><span class="operator">-&gt;</span><span class="variable">Worksheets</span><span class="operator">(</span><span class="number">1</span><span class="operator">);</span>
        <span class="variable">$sheet</span><span class="operator">-&gt;</span><span class="variable">Cells</span><span class="operator">(</span><span class="number">1</span><span class="operator">,</span><span class="number">1</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"foo"</span><span class="operator">;</span>
</pre>
<pre>
        <span class="comment"># write a 2 rows by 3 columns range</span>
        <span class="variable">$sheet</span><span class="operator">-&gt;</span><span class="variable">Range</span><span class="operator">(</span><span class="string">"A8:C9"</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span> <span class="operator">=</span> <span class="operator">[[</span> <span class="keyword">undef</span><span class="operator">,</span> <span class="string">'Xyzzy'</span><span class="operator">,</span> <span class="string">'Plugh'</span> <span class="operator">]</span><span class="operator">,</span>
                                           <span class="operator">[</span> <span class="number">42</span><span class="operator">,</span>    <span class="string">'Perl'</span><span class="operator">,</span>  <span class="number">3.1415</span>  <span class="operator">]]</span><span class="operator">;</span>
</pre>
<pre>
        <span class="comment"># print "XyzzyPerl"</span>
        <span class="variable">$array</span> <span class="operator">=</span> <span class="variable">$sheet</span><span class="operator">-&gt;</span><span class="variable">Range</span><span class="operator">(</span><span class="string">"A8:C9"</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span><span class="operator">;</span>
        <span class="keyword">for</span> <span class="operator">(</span><span class="variable">@$array</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="keyword">for</span> <span class="operator">(</span><span class="variable">@$_</span><span class="operator">)</span> <span class="operator">{</span>
                <span class="keyword">print</span> <span class="keyword">defined</span><span class="operator">(</span><span class="variable">$_</span><span class="operator">)</span> <span class="operator">?</span> <span class="string">"</span><span class="variable">$_</span><span class="string">|"</span> <span class="operator">:</span> <span class="string">"&lt;undef&gt;|"</span><span class="operator">;</span>
            <span class="operator">}</span>
            <span class="keyword">print</span> <span class="string">"\n"</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="comment"># save and exit</span>
        <span class="variable">$book</span><span class="operator">-&gt;</span><span class="variable">SaveAs</span><span class="operator">(</span> <span class="string">'test.xls'</span> <span class="operator">);</span>
        <span class="keyword">undef</span> <span class="variable">$book</span><span class="operator">;</span>
        <span class="keyword">undef</span> <span class="variable">$ex</span><span class="operator">;</span>
</pre>
<p>Please note the destructor specified on the Win32::OLE-&gt;new method.  It ensures
that Excel will shutdown properly even if the Perl program dies.  Otherwise
there could be a process leak if your application dies after having opened
an OLE instance of Excel.  It is the responsibility of the module user to
make sure that all OLE objects are cleaned up properly!</p>
<p>Here is an example of using Variant data types.</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span><span class="operator">;</span>
        <span class="keyword">use</span> <span class="variable">Win32::OLE::Variant</span><span class="operator">;</span>
        <span class="variable">$ex</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">,</span> <span class="operator">\&amp;</span><span class="variable">OleQuit</span><span class="operator">)</span> <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"oops\n"</span><span class="operator">;</span>
        <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Visible</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
        <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Workbooks</span><span class="operator">-&gt;</span><span class="variable">Add</span><span class="operator">;</span>
        <span class="comment"># should generate a warning under -w</span>
        <span class="variable">$ovR8</span> <span class="operator">=</span> <span class="variable">Variant</span><span class="operator">(</span><span class="variable">VT_R8</span><span class="operator">,</span> <span class="string">"3 is a good number"</span><span class="operator">);</span>
        <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Range</span><span class="operator">(</span><span class="string">"A1"</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$ovR8</span><span class="operator">;</span>
        <span class="variable">$ex</span><span class="operator">-&gt;</span><span class="variable">Range</span><span class="operator">(</span><span class="string">"A2"</span><span class="operator">)-&gt;</span><span class="operator">{</span><span class="string">Value</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">Variant</span><span class="operator">(</span><span class="variable">VT_DATE</span><span class="operator">,</span> <span class="string">'Jan 1,1970'</span><span class="operator">);</span>
</pre>
<pre>
        <span class="keyword">sub</span><span class="variable"> OleQuit </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$self</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="variable">$self</span><span class="operator">-&gt;</span><span class="variable">Quit</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<p>The above will put value &quot;3&quot; in cell A1 rather than the string
&quot;3 is a good number&quot;.  Cell A2 will contain the date.</p>
<p>Similarly, to invoke a method with some binary data, you can
do the following:</p>
<pre>
        <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">Method</span><span class="operator">(</span> <span class="variable">Variant</span><span class="operator">(</span><span class="variable">VT_UI1</span><span class="operator">,</span> <span class="string">"foo\000b\001a\002r"</span><span class="operator">)</span> <span class="operator">);</span>
</pre>
<p>Here is a wrapper class that basically delegates everything but
<a href="#new"><code>new()</code></a> and <code>DESTROY()</code>.  The wrapper class shown here is another way to
properly shut down connections if your application is liable to die
without proper cleanup.  Your own wrappers will probably do something
more specific to the particular OLE object you may be dealing with,
like overriding the methods that you may wish to enhance with your
own.</p>
<pre>
        <span class="keyword">package</span> <span class="variable">Excel</span><span class="operator">;</span>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span><span class="operator">;</span>
</pre>
<pre>
        <span class="keyword">sub</span><span class="variable"> new </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="operator">{}</span><span class="operator">;</span>
            <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$s</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Ex</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">))</span> <span class="operator">{</span>
                <span class="keyword">return</span> <span class="keyword">bless</span> <span class="variable">$s</span><span class="operator">,</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="operator">}</span>
            <span class="keyword">return</span> <span class="keyword">undef</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="keyword">sub</span><span class="variable"> DESTROY </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">exists</span> <span class="variable">$s</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Ex</span><span class="operator">}</span><span class="operator">)</span> <span class="operator">{</span>
                <span class="keyword">print</span> <span class="string">"# closing connection\n"</span><span class="operator">;</span>
                <span class="variable">$s</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Ex</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="variable">Quit</span><span class="operator">;</span>
                <span class="keyword">return</span> <span class="keyword">undef</span><span class="operator">;</span>
            <span class="operator">}</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="keyword">sub</span><span class="variable"> AUTOLOAD </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$s</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="variable">$AUTOLOAD</span> <span class="operator">=~</span> <span class="regex">s/^.*:://</span><span class="operator">;</span>
            <span class="variable">$s</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">Ex</span><span class="operator">}</span><span class="operator">-&gt;</span><span class="variable">$AUTOLOAD</span><span class="operator">(</span><span class="variable">@_</span><span class="operator">);</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="number">1</span><span class="operator">;</span>
</pre>
<p>The above module can be used just like Win32::OLE, except that
it takes care of closing connections in case of abnormal exits.
Note that the effect of this specific example can be easier accomplished
using the optional destructor argument of Win32::OLE::new:</p>
<pre>
        <span class="keyword">my</span> <span class="variable">$Excel</span> <span class="operator">=</span> <span class="variable">Win32::OLE</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">,</span> <span class="keyword">sub</span><span class="variable"> </span><span class="operator">{</span><span class="variable">$_</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">-&gt;</span><span class="variable">Quit</span><span class="operator">;});</span>
</pre>
<p>Note that the delegation shown in the earlier example is not the same as
true subclassing with respect to further inheritance of method calls in your
specialized object.  See <a href="../../lib/pods/perlobj.html">the perlobj manpage</a>, <a href="../../lib/pods/perltoot.html">the perltoot manpage</a> and <a href="../../lib/pods/perlbot.html">the perlbot manpage</a> for details.
True subclassing (available by setting <code>@ISA</code>) is also feasible,
as the following example demonstrates:</p>
<pre>
        <span class="comment">#</span>
        <span class="comment"># Add error reporting to Win32::OLE</span>
        <span class="comment">#</span>
</pre>
<pre>
        <span class="keyword">package</span> <span class="variable">Win32::OLE::Strict</span><span class="operator">;</span>
        <span class="keyword">use</span> <span class="variable">Carp</span><span class="operator">;</span>
        <span class="keyword">use</span> <span class="variable">Win32::OLE</span><span class="operator">;</span>
</pre>
<pre>
        <span class="keyword">use</span> <span class="variable">strict</span> <span class="string">qw(vars)</span><span class="operator">;</span>
        <span class="keyword">use</span> <span class="variable">vars</span> <span class="string">qw($AUTOLOAD @ISA)</span><span class="operator">;</span>
        <span class="variable">@ISA</span> <span class="operator">=</span> <span class="string">qw(Win32::OLE)</span><span class="operator">;</span>
</pre>
<pre>
        <span class="keyword">sub</span><span class="variable"> AUTOLOAD </span><span class="operator">{</span>
            <span class="keyword">my</span> <span class="variable">$obj</span> <span class="operator">=</span> <span class="keyword">shift</span><span class="operator">;</span>
            <span class="variable">$AUTOLOAD</span> <span class="operator">=~</span> <span class="regex">s/^.*:://</span><span class="operator">;</span>
            <span class="keyword">my</span> <span class="variable">$meth</span> <span class="operator">=</span> <span class="variable">$AUTOLOAD</span><span class="operator">;</span>
            <span class="variable">$AUTOLOAD</span> <span class="operator">=</span> <span class="string">"SUPER::"</span> <span class="operator">.</span> <span class="variable">$AUTOLOAD</span><span class="operator">;</span>
            <span class="keyword">my</span> <span class="variable">$retval</span> <span class="operator">=</span> <span class="variable">$obj</span><span class="operator">-&gt;</span><span class="variable">$AUTOLOAD</span><span class="operator">(</span><span class="variable">@_</span><span class="operator">);</span>
            <span class="keyword">unless</span> <span class="operator">(</span><span class="keyword">defined</span><span class="operator">(</span><span class="variable">$retval</span><span class="operator">)</span> <span class="operator">||</span> <span class="variable">$AUTOLOAD</span> <span class="keyword">eq</span> <span class="string">'DESTROY'</span><span class="operator">)</span> <span class="operator">{</span>
                <span class="keyword">my</span> <span class="variable">$err</span> <span class="operator">=</span> <span class="variable">Win32::OLE::LastError</span><span class="operator">();</span>
                <span class="variable">croak</span><span class="operator">(</span><span class="keyword">sprintf</span><span class="operator">(</span><span class="string">"</span><span class="variable">$meth</span><span class="string"> returned OLE error 0x%08x"</span><span class="operator">,</span><span class="variable">$err</span><span class="operator">))</span>
                  <span class="keyword">if</span> <span class="variable">$err</span><span class="operator">;</span>
            <span class="operator">}</span>
            <span class="keyword">return</span> <span class="variable">$retval</span><span class="operator">;</span>
        <span class="operator">}</span>
</pre>
<pre>
        <span class="number">1</span><span class="operator">;</span>
</pre>
<p>This package inherits the constructor <a href="#new"><code>new()</code></a> from the Win32::OLE
package.  It is important to note that you cannot later rebless a
Win32::OLE object as some information about the package is cached by
the object.  Always invoke the <a href="#new"><code>new()</code></a> constructor through the right
package!</p>
<p>Here's how the above class will be used:</p>
<pre>
        <span class="keyword">use</span> <span class="variable">Win32::OLE::Strict</span><span class="operator">;</span>
        <span class="keyword">my</span> <span class="variable">$Excel</span> <span class="operator">=</span> <span class="variable">Win32::OLE::Strict</span><span class="operator">-&gt;</span><span class="variable">new</span><span class="operator">(</span><span class="string">'Excel.Application'</span><span class="operator">,</span> <span class="string">'Quit'</span><span class="operator">);</span>
        <span class="keyword">my</span> <span class="variable">$Books</span> <span class="operator">=</span> <span class="variable">$Excel</span><span class="operator">-&gt;</span><span class="variable">Workbooks</span><span class="operator">;</span>
        <span class="variable">$Books</span><span class="operator">-&gt;</span><span class="variable">UnknownMethod</span><span class="operator">(</span><span class="number">42</span><span class="operator">);</span>
</pre>
<p>In the sample above the call to <code>UnknownMethod()</code> will be caught with</p>
<pre>
        UnknownMethod returned OLE error 0x80020009 at test.pl line 5</pre>
<p>because the Workbooks object inherits the class <code>Win32::OLE::Strict</code> from the
<code>$Excel</code> object.</p>
<p>
</p>
<hr />
<h1><a name="notes">NOTES</a></h1>
<p>
</p>
<h2><a name="hints_for_microsoft_office_automation">Hints for Microsoft Office automation</a></h2>
<dl>
<dt><strong><a name="documentation" class="item">Documentation</a></strong>

<dd>
<p>The object model for the Office applications is defined in the Visual Basic
reference guides for the various applications.  These are typically not
installed by default during the standard installation.  They can be added
later by rerunning the setup program with the custom install option.</p>
</dd>
</li>
<dt><strong><a name="class_method_and_property_names" class="item">Class, Method and Property names</a></strong>

<dd>
<p>The names have been changed between different versions of Office.  For
example <code>Application</code> was a method in Office 95 and is a property in
Office97.  Therefore it will not show up in the list of property names
<code>keys %$object</code> when querying an Office 95 object.</p>
</dd>
<dd>
<p>The class names are not always identical to the method/property names
producing the object.  E.g. the <code>Workbook</code> method returns an object of
type <code>Workbook</code> in Office 95 and <code>_Workbook</code> in Office 97.</p>
</dd>
</li>
<dt><strong><a name="moniker" class="item">Moniker (GetObject support)</a></strong>

<dd>
<p>Office applications seem to implement file monikers only.  For example
it seems to be impossible to retrieve a specific worksheet object through
<a href="#getobject"><code>GetObject(&quot;File.XLS!Sheet&quot;)</code></a>.  Furthermore, in Excel 95 the moniker starts
a Worksheet object and in Excel 97 it returns a Workbook object.  You can use
either the Win32::OLE::QueryObjectType class method or the $object-&gt;{Version}
property to write portable code.</p>
</dd>
</li>
<dt><strong><a name="enumeration_of_collection_objects" class="item">Enumeration of collection objects</a></strong>

<dd>
<p>Enumerations seem to be incompletely implemented.  Office 95 application don't
seem to support neither the <code>Reset()</code> nor the <code>Clone()</code> methods.  The <code>Clone()</code>
method is still unimplemented in Office 97.  A single walk through the
collection similar to Visual Basics <code>for each</code> construct does work however.</p>
</dd>
</li>
<dt><strong><a name="localization" class="item">Localization</a></strong>

<dd>
<p>Starting with Office 97 Microsoft has changed the localized class, method and
property names back into English.  Note that string, date and currency
arguments are still subject to locale specific interpretation.  Perl uses the
system default locale for all OLE transaction whereas Visual Basic uses a
type library specific locale.  A Visual Basic script would use &quot;R1C1&quot; in string
arguments to specify relative references.  A Perl script running on a German
language Windows would have to use &quot;Z1S1&quot;.  Set the LCID module option
to an English locale to write portable scripts.  This variable should
not be changed after creating the OLE objects; some methods seem to randomly
fail if the locale is changed on the fly.</p>
</dd>
</li>
<dt><strong><a name="saveas_method_in_word_97_doesn_t_work" class="item">SaveAs method in Word 97 doesn't work</a></strong>

<dd>
<p>This is an known bug in Word 97.  Search the MS knowledge base for Word /
Foxpro incompatibility.  That problem applies to the Perl OLE interface as
well.  A workaround is to use the WordBasic compatibility object.  It doesn't
support all the options of the native method though.</p>
</dd>
<dd>
<pre>
    <span class="variable">$Word</span><span class="operator">-&gt;</span><span class="variable">WordBasic</span><span class="operator">-&gt;</span><span class="variable">FileSaveAs</span><span class="operator">(</span><span class="variable">$file</span><span class="operator">);</span>
</pre>
</dd>
<dd>
<p>The problem seems to be fixed by applying the Office 97 Service Release 1.</p>
</dd>
</li>
<dt><strong><a name="randomly_failing_method_calls" class="item">Randomly failing method calls</a></strong>

<dd>
<p>It seems like modifying objects that are not selected/activated is sometimes
fragile.  Most of these problems go away if the chart/sheet/document is
selected or activated before being manipulated (just like an interactive
user would automatically do it).</p>
</dd>
</li>
</dl>
<p>
</p>
<h2><a name="incompatibilities">Incompatibilities</a></h2>
<p>There are some incompatibilities with the version distributed by Activeware
(as of build 306).</p>
<ol>
<li>
<p>The package name has changed from &quot;OLE&quot; to &quot;Win32::OLE&quot;.</p>
</li>
<li>
<p>All functions of the form &quot;Win32::OLEFoo&quot; are now &quot;Win32::OLE::Foo&quot;,
though the old names are temporarily accomodated.  Win32::OLECreateObject()
was changed to Win32::OLE::CreateObject(), and is now called
Win32::OLE::new() bowing to established convention for naming constructors.
The old names should be considered deprecated, and will be removed in the
next version.</p>
</li>
<li>
<p>Package &quot;OLE::Variant&quot; is now &quot;Win32::OLE::Variant&quot;.</p>
</li>
<li>
<p>The Variant function is new, and is exported by default.  So are
all the VT_XXX type constants.</p>
</li>
<li>
<p>The support for collection objects has been moved into the package
Win32::OLE::Enum.  The <code>keys %$object</code> method is now used to enumerate
the properties of the object.</p>
</li>
</ol>
<p>
</p>
<h2><a name="bugs_and_limitations">Bugs and Limitations</a></h2>
<ul>
<li>
<p>To invoke a native OLE method with the same name as one of the
Win32::OLE methods (<code>Dispatch</code>, <a href="#invoke"><code>Invoke</code></a>, <a href="#setproperty"><code>SetProperty</code></a>, <code>DESTROY</code>,
etc.), you have to use the <a href="#invoke"><code>Invoke</code></a> method:</p>
<pre>
        <span class="variable">$Object</span><span class="operator">-&gt;</span><span class="variable">Invoke</span><span class="operator">(</span><span class="string">'Dispatch'</span><span class="operator">,</span> <span class="variable">@AdditionalArgs</span><span class="operator">);</span>
</pre>
<p>The same is true for names exported by the Exporter or the Dynaloader
modules, e.g.: <code>export</code>, <code>export_to_level</code>, <a href="../../lib/pods/perlfunc.html#import"><code>import</code></a>,
<code>_push_tags</code>, <code>export_tags</code>, <code>export_ok_tags</code>, <code>export_fail</code>,
<code>require_version</code>, <code>dl_load_flags</code>,
<code>croak</code>, <code>bootstrap</code>, <code>dl_findfile</code>, <code>dl_expandspec</code>,
<code>dl_find_symbol_anywhere</code>, <code>dl_load_file</code>, <code>dl_find_symbol</code>,
<code>dl_undef_symbols</code>, <code>dl_install_xsub</code> and <code>dl_error</code>.</p>
</li>
</ul>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>The documentation for <a href="../../lib/Win32/OLE/Const.html">the Win32::OLE::Const manpage</a>, <a href="../../lib/Win32/OLE/Enum.html">the Win32::OLE::Enum manpage</a>,
<a href="../../lib/Win32/OLE/NLS.html">the Win32::OLE::NLS manpage</a> and <a href="../../lib/Win32/OLE/Variant.html">the Win32::OLE::Variant manpage</a> contains additional
information about OLE support for Perl on Win32.</p>
<p>
</p>
<hr />
<h1><a name="authors">AUTHORS</a></h1>
<p>Originally put together by the kind people at Hip and Activeware.</p>
<p>Gurusamy Sarathy &lt;<a href="mailto:gsar@cpan.org">gsar@cpan.org</a>&gt; subsequently fixed several
major bugs, memory leaks, and reliability problems, along with some
redesign of the code.</p>
<p>Jan Dubois &lt;<a href="mailto:jand@activestate.com">jand@activestate.com</a>&gt; pitched in with yet more massive redesign,
added support for named parameters, and other significant enhancements.
He's been hacking on it ever since.</p>
<p>Please send questions about problems with this module to the
Perl-Win32-Users mailinglist at ActiveState.com.  The mailinglist charter
requests that you put an [OLE] tag somewhere on the subject line (for OLE
related questions only, of course).</p>
<p>
</p>
<hr />
<h1><a name="copyright">COPYRIGHT</a></h1>
<pre>
    (c) 1995 Microsoft Corporation. All rights reserved.
    Developed by ActiveWare Internet Corp., now known as
    ActiveState Tool Corp., <a href="http://www.ActiveState.com">http://www.ActiveState.com</a></pre>
<pre>
    Other modifications Copyright (c) 1997-2006 by Gurusamy Sarathy
    &lt;gsar@cpan.org&gt; and Jan Dubois &lt;jand@activestate.com&gt;</pre>
<pre>
    You may distribute under the terms of either the GNU General Public
    License or the Artistic License, as specified in the README file.</pre>
<p>
</p>
<hr />
<h1><a name="version">VERSION</a></h1>
<p>Version 0.1709	  17 April 2008</p>

</body>

</html>
